const e="... (truncated)";class l{static exportAsXls(l){var a;const o="undefined"!=typeof window?null===window||void 0===window?void 0:window.XLSX:null!==(a=null===globalThis||void 0===globalThis?void 0:globalThis.XLSX)&&void 0!==a?a:null;if(!o)throw new Error("XLSX not available, skipping XLS export");const t=o.utils.book_new();(Array.isArray(l)?l:[l]).forEach(l=>{const a=[l.columns].concat(l.rows.map((a,o)=>a.map((a,t)=>{if("string"!=typeof a)throw new Error(`Invalid cell type at row ${o+1}, column ${l.columns[t]} (${t+1}) of table "${l.header}": expected string but got ${typeof a}`);return a.length>32767?a.substring(0,32752)+e:a}))),i=o.utils.aoa_to_sheet(a);i["!cols"]=l.columns.map((e,l)=>{const o=a.reduce((e,a)=>{var o;return a&&"string"==typeof a[l]?Math.max(e,null===(o=a[l])||void 0===o?void 0:o.length):e},10);return o?{wch:o}:{}});const n=`${l.header} (${l.rows.length})`.substring(0,31);o.utils.book_append_sheet(t,i,n)});const i=o.write(t,{bookType:"xlsx",type:"binary"}),n=new ArrayBuffer(i.length),d=new Uint8Array(n);for(let e=0;e<i.length;e++)d[e]=255&i.charCodeAt(e);return n}}var a,o;!function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL"}(a||(a={})),function(e){e.IDX="index",e.SCR="score",e.TXT="text",e.TXTS="texts",e.NUM="numeric",e.PRC="percentage",e.URL="id",e.URLS="ids",e.CHK="boolean",e.DTM="datetime",e.DEP="dependencies",e.OBJS="objects"}(o||(o={}));class t{static create(e,l){var a,t,d,s,r,u;const v={data:{}},c=null!==(a=e.modifier)&&void 0!==a?a:void 0,p=null!==(t=e.data)&&void 0!==t?t:{};switch(e.type){case o.TXTS:v.data.values=null===(d=i(l,p.values))||void 0===d?void 0:d.map(e=>n({data:e},c));break;case o.OBJS:{const e=null!==(s=p.template)&&void 0!==s?s:()=>"";v.data.values=null===(r=i(l,p.values))||void 0===r?void 0:r.map(l=>n({data:e(l)},c));break}case o.URLS:v.data.values=null===(u=i(l,p.values))||void 0===u?void 0:u.map(e=>{const l={data:{}};return Object.keys(p).filter(e=>"values"!==e).forEach(a=>{l.data[a]=i(e,p[a])}),n(l,c)});break;default:Object.keys(p).forEach(e=>{v.data[e]=i(l,p[e])}),n(v,c)}return v[`typeof${e.type}`]=!0,v}}const i=(e,l)=>{let a=e;return l.split(".").forEach(e=>{a&&(a=a[e])}),a},n=(e,l)=>{if(l){const a="value"in e.data?e.data.value:e.data;void 0!==l.maximumLength&&a&&"string"==typeof a&&a.length>l.maximumLength&&(e.decoration=a.substring(0,l.maximumLength)),void 0!==l.valueIfEmpty&&(null==a||"string"==typeof a&&0===a.trim().length||Array.isArray(a)&&0===a.length)&&(e.decoration=l.valueIfEmpty),!0===l.preformatted&&(e.isPreformatted=!0),void 0!==l.minimum&&void 0!==l.valueBeforeMin&&void 0!==a&&"number"==typeof a&&a<l.minimum&&(e.decoration=l.valueBeforeMin),void 0!==l.maximum&&void 0!==l.valueAfterMax&&void 0!==a&&"number"==typeof a&&a>l.maximum&&(e.decoration=l.valueAfterMax)}return e};var d;!function(e){e[e.DESC=0]="DESC",e[e.ASC=1]="ASC"}(d||(d={}));class s{static create(e,l,a,o){return l.map((l,i)=>{var n;const d={index:i+1,score:l.score,name:null!==(n=l.name)&&void 0!==n?n:l.label,badFields:l.badFields,badReasonIds:l.badReasonIds,cells:e.columns.map((e,a)=>{const n=t.create(e,l);return o(n,!(!e.data||!l.badFields)&&(l.badFields.includes(e.data.value)||l.badFields.includes(e.data.values)),i,a),n}),isVisible:!0};return a&&a(d,l.score>0,i),d})}static sort(e,l,a,t){const i=e.columns[a];if(!i)return;const n=t===d.ASC?1:-1,s=i.type==o.OBJS||i.type==o.TXTS||i.type==o.URLS,r=i.type==o.URL?"label":"value";let u,v,c=0;l.sort((e,l)=>{var o,t,i,d;return!0===s?(u=(null===(t=null===(o=e.cells[a].data)||void 0===o?void 0:o.values)||void 0===t?void 0:t.length)||0,v=(null===(d=null===(i=l.cells[a].data)||void 0===i?void 0:i.values)||void 0===d?void 0:d.length)||0):(u=e.cells[a].data[r],v=l.cells[a].data[r]),u&&u.toUpperCase&&(u=u.toUpperCase()),v&&v.toUpperCase&&(v=v.toUpperCase()),u||0===u?v||0===v?u<v?-n:n:-n:n}).forEach(e=>{!0===e.isVisible&&(e.index=++c)})}static filter(e,l){if((null==l?void 0:l.length)>2){const a=l.toUpperCase();let o=0;e.forEach(e=>{!0===r(e.cells,a)?(e.isVisible=!0,e.index=++o):e.isVisible=!1})}else e.forEach((e,l)=>{e.isVisible=!0,e.index=l+1})}static export(e,l,a,t){const i={header:a,columns:[],rows:[]};return e.columns.forEach(e=>{switch(e.type){case o.SCR:i.columns.push(e.label,"Reasons");break;case o.URL:case o.URLS:i.columns.push(`${e.label} (label)`,`${e.label} (URL)`);break;case o.DEP:i.columns.push("List of used","List of referenced");break;default:i.columns.push(e.label)}}),l.forEach(e=>{var l;const a=[];null===(l=e.cells)||void 0===l||l.forEach(l=>{var o,i,n,d,s,r,v,c,p,m,f,h,b,y,g,x,w;!0===(null==l?void 0:l.typeofindex)?a.push(`${null==e?void 0:e.index}`):!0===(null==l?void 0:l.typeofscore)?a.push(`${null==e?void 0:e.score}`,u(null===(o=null==e?void 0:e.badReasonIds)||void 0===o?void 0:o.map(e=>t(e)))):!0===(null==l?void 0:l.typeofid)?a.push(`${null===(i=null==l?void 0:l.data)||void 0===i?void 0:i.label}`,`${null===(n=l.data)||void 0===n?void 0:n.value}`):!0===(null==l?void 0:l.typeofids)?a.push(u(null===(s=null===(d=l.data)||void 0===d?void 0:d.values)||void 0===s?void 0:s.map(e=>{var l;return`${null===(l=e.data)||void 0===l?void 0:l.label}`})),u(null===(v=null===(r=l.data)||void 0===r?void 0:r.values)||void 0===v?void 0:v.map(e=>{var l;return`${null===(l=e.data)||void 0===l?void 0:l.value}`}))):!0===(null==l?void 0:l.typeofdependencies)?a.push(u(null===(m=null===(p=null===(c=l.data)||void 0===c?void 0:c.value)||void 0===p?void 0:p.using)||void 0===m?void 0:m.map(e=>`${null==e?void 0:e.name} (${null==e?void 0:e.type} - ${null==e?void 0:e.id})`)),u(null===(b=null===(h=null===(f=l.data)||void 0===f?void 0:f.value)||void 0===h?void 0:h.referenced)||void 0===b?void 0:b.map(e=>`${null==e?void 0:e.name} (${null==e?void 0:e.type} - ${null==e?void 0:e.id})`))):!0===(null==l?void 0:l.typeofobjects)||!0===(null==l?void 0:l.typeoftexts)?a.push(u(null===(g=null===(y=null==l?void 0:l.data)||void 0===y?void 0:y.values)||void 0===g?void 0:g.map(e=>`${e.data}`))):a.push(`${null!==(w=null===(x=null==l?void 0:l.data)||void 0===x?void 0:x.value)&&void 0!==w?w:""}`)}),i.rows.push(a)}),i}static createAndExport(e,l,a,o){const t=()=>{},i=s.create(e,l,t,t);return s.export(e,i,a,o)}}const r=(e,l)=>e.findIndex(e=>Object.values(e.data).findIndex(e=>{return Array.isArray(e)?r(e,l):(a=l,String(e).toUpperCase().indexOf(a)>=0);var a})>=0)>=0,u=e=>e?JSON.stringify(e):"";export{t as CellFactory,o as ColumnType,l as Exporter,a as Orientation,s as RowsFactory,d as SortOrder};
