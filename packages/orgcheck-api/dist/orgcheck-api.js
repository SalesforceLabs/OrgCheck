const e=new RegExp("(?:public|global)\\s+(?:interface)\\s+\\w+(\\s+(?:extends)\\s+\\w+)?\\s*\\{","i"),t=new RegExp("(?:public|global)\\s+(?:enum)\\s+\\w+\\s*\\{","i"),i=new RegExp("@IsTest\\s*\\(.*SeeAllData=true.*\\)","i"),o=new RegExp("(System.assert(Equals|NotEquals|)\\s*\\(|Assert\\.[a-zA-Z]*\\s*\\()","ig"),s=new RegExp("\\[\\s*(?:SELECT|FIND)"),r=new RegExp("\\b(?:insert|update|delete)\\s*(?:\\s\\w+|\\(|\\[)"),n=new RegExp("(\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*\\n|\\/\\/[^\\n]*|\\n)","gi"),a=new RegExp("(\x3c!--[\\s\\S]*?--\x3e|\\n)","gi"),l=new RegExp("([A-Za-z0-9-]{1,63}\\.)+[A-Za-z]{2,6}","ig"),d=new RegExp("[,\"'\\s][a-zA-Z0-9]{5}0[a-zA-Z0-9]{9}([a-zA-Z0-9]{3})?[,\"'\\s]","ig"),c=["salesforce.com",".force."],u=new RegExp("(^|[^A-Za-z])[A-Za-z]{1,4}[0-9]{1,4}S{0,1}.","ig");class p{static RemoveCommentsFromCode(e){return(null==e?void 0:e.replaceAll(n," "))||""}static RemoveCommentsFromXML(e){return(null==e?void 0:e.replaceAll(a," "))||""}static IsInterfaceFromApexCode(t){return null!==(null==t?void 0:t.match(e))||!1}static IsEnumFromApexCode(e){return null!==(null==e?void 0:e.match(t))||!1}static FindHardCodedURLs(e){var t,i;return null!==(i=null===(t=null==e?void 0:e.match(l))||void 0===t?void 0:t.filter(e=>c.findIndex(t=>e.indexOf(t)>=0)>=0).sort().filter((e,t,i)=>t===i.indexOf(e)).filter(e=>null!==(null==e?void 0:e.match(u))||!1))&&void 0!==i?i:[]}static FindHardCodedIDs(e){var t;return(null===(t=null==e?void 0:e.match(d))||void 0===t?void 0:t.map(e=>null==e?void 0:e.substring(1,(null==e?void 0:e.length)-1)).sort().filter((e,t,i)=>t===i.indexOf(e)))||[]}static IsTestSeeAllDataFromApexCode(e){return null!==(null==e?void 0:e.match(i))||!1}static CountOfAssertsFromApexCode(e){var t;return(null===(t=null==e?void 0:e.match(o))||void 0===t?void 0:t.length)||0}static HasSOQLFromApexCode(e){return null!==(null==e?void 0:e.match(s))||!1}static HasDMLFromApexCode(e){return null!==(null==e?void 0:e.match(r))||!1}}class g{static create(e,t){var i;if(null===(i=e.errors)||void 0===i?void 0:i.some(e=>t.includes(e)))return{hadError:!0,using:[],referenced:[],referencedByTypes:{}};const o=e.records.filter(e=>t.includes(e.id)).map(e=>({id:e.refId,name:e.refName,type:e.refType,url:e.refUrl})),s={};return{hadError:!1,using:o,referenced:e.records.filter(e=>t.includes(e.refId)).map(e=>(void 0===s[e.type]?s[e.type]=1:s[e.type]++,{id:e.id,name:e.name,type:e.type,url:e.url})),referencedByTypes:s}}}class h{static create(){return new m}}class m{constructor(){this._columnIds=new Set,this._columns=new Map,this._rows=new Map}toDataMatrix(){const e=[];return this._columnIds.forEach(t=>{e.push(this._columns.has(t)?this._columns.get(t):t)}),{columnHeaders:e,rows:Array.from(this._rows.values())}}addValueToProperty(e,t,i){!1===this._rows.has(e)&&this._rows.set(e,{header:{},data:{}});const o=this._rows.get(e);if(void 0===o)throw new Error("Row was not found in method addValueToProperty");o.data[t]=i,this._columnIds.add(t)}hasColumnHeader(e){return this._columns.has(e)}setColumnHeader(e,t){this._columns.set(e,t)}hasRowHeader(e){if(!0===this._rows.has(e)){const t=this._rows.get(e);if(void 0===t)throw new Error("Row was not found in method hasRowHeader");return void 0!==t.header}return!1}setRowHeader(e,t){if(!0===this._rows.has(e)){const i=this._rows.get(e);if(void 0===i)throw new Error("Row was not found in method setRowHeader");i.header=t}else this._rows.set(e,{header:t,data:{}})}}class f{constructor(e,t,i){this.alias=e,this.cacheKey=t,this.parameters=i}}var S,v,E;function I(e,t,i,o){return new(i||(i=Promise))(function(s,r){function n(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,a)}l((o=o.apply(e,t||[])).next())})}!function(e){e.APEXCLASSES="apex-classes",e.APEXTRIGGERS="apex-triggers",e.APPLICATIONS="applications",e.APPPERMISSIONS="app-permissions",e.BROWSERS="browsers",e.CURRENTUSERPERMISSIONS="current-user-permissions",e.CUSTOMFIELDS="custom-fields",e.CUSTOMLABELS="custom-labels",e.CUSTOMTABS="custom-tabs",e.COLLABORATIONGROUPS="collaboration-groups",e.DOCUMENTS="documents",e.DASHBOARDS="dashboards",e.EMAILTEMPLATES="email-templates",e.FIELDPERMISSIONS="field-permissions",e.FLOWS="flows",e.HOMEPAGECOMPONENTS="home-page-components",e.KNOWLEDGEARTICLES="knowledge-articles",e.LIGHTNINGAURACOMPONENTS="lightning-aura-components",e.LIGHTNINGPAGES="lightning-pages",e.LIGHTNINGWEBCOMPONENTS="lightning-web-components",e.OBJECT="object",e.OBJECTPERMISSIONS="object-permissions",e.OBJECTS="objects",e.OBJECTTYPES="object-types",e.ORGANIZATION="org-information",e.PACKAGES="packages",e.PAGELAYOUTS="page-layouts",e.PERMISSIONSETS="permission-sets",e.PERMISSIONSETLICENSES="permission-set-licenses",e.PUBLICGROUPSANDQUEUES="public-groups-and-queues",e.PROFILEPWDPOLICIES="profile-password-policies",e.PROFILERESTRICTIONS="profile-restrictions",e.PROFILES="profiles",e.RECORDTYPES="record-types",e.REPORTS="reports",e.STATICRESOURCES="static-resources",e.USERROLES="user-roles",e.INTERNALACTIVEUSERS="internal-active-users",e.VALIDATIONRULES="validation-rules",e.VISUALFORCECOMPONENTS="visual-force-components",e.VISUALFORCEPAGES="visual-force-pages",e.WEBLINKS="web-links",e.WORKFLOWS="workflows"}(S||(S={})),"function"==typeof SuppressedError&&SuppressedError;class C{static forEach(e,t){if(!e)return Promise.resolve();if("function"!=typeof t)throw new TypeError("Given iteratee is not a proper function.");if(!0===Array.isArray(e))return Promise.all(e.map(e=>I(this,void 0,void 0,function*(){return yield t(e),null}))).then(()=>{});if(e instanceof Map){const i=Array.from(e.keys());return Promise.all(i.map(i=>I(this,void 0,void 0,function*(){return yield t(e.get(i),i),null}))).then(()=>{})}return Promise.reject(new TypeError("Given iterable is not a proper Array nor Map."))}static map(e,t,i){if(!e)return Promise.resolve([]);if(!1===Array.isArray(e))throw new TypeError("Given iterable is not a proper Array.");if("function"!=typeof t)throw new TypeError("Given iteratee is not a proper function.");if(i){if("function"!=typeof i)throw new TypeError("Given filterIteratee is not a proper function.");if("AsyncFunction"===i.constructor.name)throw new TypeError("Given filterIteratee should not be an async function.")}const o=i?e.filter(e=>i(e)):e;return Promise.all(o.map(e=>I(this,void 0,void 0,function*(){return yield t(e)})))}}!function(e){e.APEX_CLASSES="apex-classes",e.APEX_TESTS="apex-tests",e.APEX_TRIGGERS="apex-triggers",e.APEX_UNCOMPILED="apex-uncompiled",e.APP_PERMISSIONS="app-permissions",e.BROWSERS="browsers",e.COLLABORATION_GROUPS="collaboration-groups",e.CURRENT_USER_PERMISSIONS="current-user-permissions",e.CUSTOM_FIELDS="custom-fields",e.CUSTOM_LABELS="custom-labels",e.CUSTOM_TABS="custom-tabs",e.DASHBOARDS="dashboards",e.DOCUMENTS="documents",e.EMAIL_TEMPLATES="email-templates",e.FIELD_PERMISSIONS="field-permissions",e.FLOWS="flows",e.GLOBAL_VIEW="global-view",e.HARDCODED_URLS_VIEW="hardcoded-urls",e.HOME_PAGE_COMPONENTS="home-page-components",e.INTERNAL_ACTIVE_USERS="internal-active-users",e.KNOWLEDGE_ARTICLES="knowledge-articles",e.LIGHTNING_AURA_COMPONENTS="lightning-aura-components",e.LIGHTNING_PAGES="lightning-pages",e.LIGHTNING_WEB_COMPONENTS="lightning-web-components",e.OBJECT="object",e.OBJECT_PERMISSIONS="object-permissions",e.OBJECTS="objects",e.OBJECT_TYPES="object-types",e.ORGANIZATION="org-information",e.PACKAGES="packages",e.PAGE_LAYOUTS="page-layouts",e.PERMISSION_SETS="permission-sets",e.PERMISSION_SET_LICENSES="permission-set-licenses",e.PROCESS_BUILDERS="process-builders",e.PROFILE_PWD_POLICIES="profile-password-policies",e.PROFILE_RESTRICTIONS="profile-restrictions",e.PROFILES="profiles",e.PUBLIC_GROUPS="public-groups",e.QUEUES="queues",e.RECORD_TYPES="record-types",e.REPORTS="reports",e.STATIC_RESOURCES="static-resources",e.USER_ROLES="user-roles",e.VALIDATION_RULES="validation-rules",e.VISUALFORCE_COMPONENTS="visualforce-components",e.VISUALFORCE_PAGES="visualforce-pages",e.WEBLINKS="web-links",e.WORKFLOWS="workflows"}(v||(v={})),function(e){e.ANY_FIELD="Field",e.APEX_CLASS="ApexClass",e.APEX_TRIGGER="ApexTrigger",e.AURA_WEB_COMPONENT="AuraDefinitionBundle",e.COLLABORATION_GROUP="CollaborationGroup",e.CUSTOM_BIG_OBJECT="CustomBigObject",e.CUSTOM_EVENT="CustomEvent",e.CUSTOM_FIELD="CustomField",e.CUSTOM_LABEL="CustomLabel",e.CUSTOM_METADATA_TYPE="CustomMetadataType",e.CUSTOM_OBJECT="CustomObject",e.CUSTOM_SETTING="CustomSetting",e.CUSTOM_SITE="CustomSite",e.CUSTOM_TAB="CustomTab",e.DASHBOARD="Dashboard",e.DOCUMENT="Document",e.EXTERNAL_OBJECT="ExternalObject",e.EMAIL_TEMPLATE="EmailTemplate",e.FIELD_SET="FieldSet",e.FLOW_DEFINITION="FlowDefinition",e.FLOW_VERSION="Flow",e.HOME_PAGE_COMPONENT="HomePageComponent",e.KNOWLEDGE_ARTICLE="KnowledgeArticle",e.KNOWLEDGE_ARTICLE_VERSION="KnowledgeArticleVersion",e.LIGHTNING_PAGE="FlexiPage",e.LIGHTNING_WEB_COMPONENT="LightningComponentBundle",e.PAGE_LAYOUT="Layout",e.PERMISSION_SET="PermissionSet",e.PERMISSION_SET_GROUP="PermissionSetGroup",e.PERMISSION_SET_LICENSE="PermissionSetLicense",e.PROFILE="Profile",e.PUBLIC_GROUP="PublicGroup",e.QUEUE="Queue",e.RECORD_TYPE="RecordType",e.REPORT="Report",e.ROLE="UserRole",e.TECHNICAL_GROUP="TechnicalGroup",e.STANDARD_FIELD="StandardField",e.STANDARD_OBJECT="StandardEntity",e.STATIC_RESOURCE="StaticResource",e.USER="User",e.VALIDATION_RULE="ValidationRule",e.VISUAL_FORCE_COMPONENT="ApexComponent",e.VISUAL_FORCE_PAGE="ApexPage",e.WEB_LINK="WebLink",e.WORKFLOW_RULE="WorkflowRule"}(E||(E={}));class y extends Error{constructor(e,t,i){super(e),this.code=t,this.contextInformation=i}}class P{constructor(){this.currentUsageRatio=0,this.currentUsagePercentage=""}get yellowThresholdPercentage(){return.7}get redThresholdPercentage(){return.9}get isGreenZone(){return this.currentUsageRatio<.7}get isYellowZone(){return this.currentUsageRatio>=.7&&this.currentUsageRatio<.9}get isRedZone(){return this.currentUsageRatio>=.9}}class R{constructor(e){this._apiLimitExtractor=e,this._lastRequestToSalesforce=void 0,this._lastApiUsage=new P}beforeRequest(e){if(this._lastRequestToSalesforce&&Date.now()-this._lastRequestToSalesforce<=6e4&&this._lastApiUsage.isRedZone){const t=new y("The Daily API Request limit has been reached. We cannot continue.","WATCH_DOG",{CurrentUsagePercentage:this._lastApiUsage.currentUsagePercentage,CurrentUsageRatio:this._lastApiUsage.currentUsageRatio,ThresholdPercentage:this._lastApiUsage.redThresholdPercentage});throw e&&e(t),t}}afterRequest(e){const t=this._apiLimitExtractor();t&&(this._lastApiUsage.currentUsageRatio=t.used/t.max,this._lastApiUsage.currentUsagePercentage=A(this._lastApiUsage.currentUsageRatio),this._lastRequestToSalesforce=Date.now(),this.beforeRequest(e))}get dailyApiRequestLimitInformation(){return this._lastApiUsage}}const A=(e,t=2)=>(100*e).toFixed(t);var T;!function(e){e.SFDC_ApexTestMethodResult="Apex Test Method",e.SFDC_ApexClass="Apex Class",e.SFDC_ApexTrigger="Apex Trigger",e.SFDC_Application="Application",e.SFDC_AppPermission="App Permission",e.SFDC_Browser="Browser",e.SFDC_CollaborationGroup="Chatter Group",e.SFDC_CustomLabel="Custom Label",e.SFDC_CustomTab="Custom Tab",e.SFDC_Dashboard="Dashboard",e.SFDC_Document="Document",e.SFDC_EmailTemplate="Email Template",e.SFDC_Field="Field",e.SFDC_FieldPermission="Field Permission",e.SFDC_FieldSet="Field Set",e.SFDC_Flow="Flow",e.SFDC_FlowVersion="Flow Version",e.SFDC_Group="Group",e.SFDC_HomePageComponent="Home Page",e.SFDC_KnowledgeArticle="Article",e.SFDC_LightningAuraComponent="Aura Component",e.SFDC_LightningPage="Page",e.SFDC_LightningWebComponent="Lightning Web Component",e.SFDC_Limit="Limit",e.SFDC_Object="Object",e.SFDC_ObjectPermission="CRUD",e.SFDC_ObjectRelationShip="Relationship",e.SFDC_ObjectType="Object Type",e.SFDC_Organization="Organization",e.SFDC_Package="Package",e.SFDC_PageLayout="Page Layout",e.SFDC_PermissionSet="Permission Set",e.SFDC_PermissionSetLicense="Permission Set License",e.SFDC_Profile="Profile",e.SFDC_ProfilePasswordPolicy="Password Policy",e.SFDC_ProfileRestrictions="Profile Restrictions",e.SFDC_ProfileIpRangeRestriction="Profile Ip Range Restrictions",e.SFDC_ProfileLoginHourRestriction="Profile Login Hour Restrictions",e.SFDC_RecordType="Record Type",e.SFDC_Report="Report",e.SFDC_StaticResource="Sstatic Resource",e.SFDC_User="User",e.SFDC_UserRole="Role",e.SFDC_ValidationRule="Validation Rule",e.SFDC_VisualForceComponent="Visualforce Component",e.SFDC_VisualForcePage="Visualforce Page",e.SFDC_WebLink="Web Link",e.SFDC_Workflow="Workflow"}(T||(T={}));const D=(e,t,i=3)=>!!(t&&e&&i)&&(e-t)/3>=i,w=e=>("number"!=typeof e||0!==e)&&(!e||(0===(null==e?void 0:e.length)||"string"==typeof e&&0===e.trim().length)),_="Dependencies",L="Hard-coded URLs",O="Hard-coded IDs",b="API Version",M="Code Quality",F="Documentation",N="User Adoption",U="Security",x="Overuse",G="Useless",V=[{id:0,description:"Not referenced anywhere",formula:e=>{var t,i;return!1===(null===(t=null==e?void 0:e.dependencies)||void 0===t?void 0:t.hadError)&&w(null===(i=e.dependencies)||void 0===i?void 0:i.referenced)},errorMessage:"This component is not referenced anywhere (as we were told by the Dependency API). Please review the need to keep it in your org.",badField:"dependencies.referenced?.length",applicable:[T.SFDC_CustomLabel,T.SFDC_LightningPage,T.SFDC_LightningAuraComponent,T.SFDC_LightningWebComponent,T.SFDC_VisualForceComponent,T.SFDC_VisualForcePage,T.SFDC_StaticResource],category:_},{id:1,description:"No reference anywhere for custom field",formula:e=>{var t,i;return!0===(null==e?void 0:e.isCustom)&&!1===(null===(t=null==e?void 0:e.dependencies)||void 0===t?void 0:t.hadError)&&w(null===(i=e.dependencies)||void 0===i?void 0:i.referenced)},errorMessage:"This custom field is not referenced anywhere (as we were told by the Dependency API). Please review the need to keep it in your org.",badField:"dependencies.referenced?.length",applicable:[T.SFDC_Field],category:_},{id:2,description:"No reference anywhere for apex class",formula:e=>{var t,i;return!1===(null==e?void 0:e.isTest)&&!1===(null===(t=null==e?void 0:e.dependencies)||void 0===t?void 0:t.hadError)&&w(null===(i=e.dependencies)||void 0===i?void 0:i.referenced)},errorMessage:"This apex class is not referenced anywhere (as we were told by the Dependency API). Please review the need to keep it in your org.",badField:"dependencies.referenced?.length",applicable:[T.SFDC_ApexClass],category:_},{id:3,description:"Sorry, we had an issue with the Dependency API to gather the dependencies of this item",formula:e=>(null==e?void 0:e.dependencies)&&!0===(null==e?void 0:e.dependencies.hadError),errorMessage:"Sorry, we had an issue with the Dependency API to gather the dependencies of this item.",badField:"dependencies.referenced?.length",applicable:[T.SFDC_Field,T.SFDC_ApexClass,T.SFDC_CustomLabel,T.SFDC_Flow,T.SFDC_LightningPage,T.SFDC_LightningAuraComponent,T.SFDC_LightningWebComponent,T.SFDC_VisualForceComponent,T.SFDC_VisualForcePage],category:_},{id:4,description:"API Version too old",formula:e=>D($.CurrentApiVersion,null==e?void 0:e.apiVersion),errorMessage:"The API version of this component is too old. Please update it to the newest version.",badField:"apiVersion",applicable:[T.SFDC_ApexClass,T.SFDC_ApexTrigger,T.SFDC_Flow,T.SFDC_LightningAuraComponent,T.SFDC_LightningWebComponent,T.SFDC_VisualForcePage,T.SFDC_VisualForceComponent,T.SFDC_EmailTemplate],category:b},{id:5,description:"No assertion in this Apex Test",formula:e=>!0===(null==e?void 0:e.isTest)&&0===(null==e?void 0:e.nbSystemAsserts),errorMessage:"This apex test does not contain any assertion! Best practices force you to define assertions in tests.",badField:"nbSystemAsserts",applicable:[T.SFDC_ApexClass],category:M},{id:6,description:"No description",formula:e=>w(null==e?void 0:e.description),errorMessage:"This component does not have a description. Best practices force you to use the Description field to give some informative context about why and how it is used/set/govern.",badField:"description",applicable:[T.SFDC_LightningPage,T.SFDC_LightningAuraComponent,T.SFDC_LightningWebComponent,T.SFDC_VisualForcePage,T.SFDC_VisualForceComponent,T.SFDC_Workflow,T.SFDC_WebLink,T.SFDC_FieldSet,T.SFDC_ValidationRule,T.SFDC_Document,T.SFDC_CustomTab,T.SFDC_EmailTemplate,T.SFDC_StaticResource,T.SFDC_Report,T.SFDC_Dashboard],category:F},{id:7,description:"No description for custom component",formula:e=>!0===(null==e?void 0:e.isCustom)&&w(null==e?void 0:e.description),errorMessage:"This custom component does not have a description. Best practices force you to use the Description field to give some informative context about why and how it is used/set/govern.",badField:"description",applicable:[T.SFDC_Field,T.SFDC_PermissionSet,T.SFDC_Profile],category:F},{id:8,description:"No explicit sharing in apex class",formula:e=>!1===(null==e?void 0:e.isTest)&&!0===(null==e?void 0:e.isClass)&&!e.specifiedSharing,errorMessage:"This Apex Class does not specify a sharing model. Best practices force you to specify with, without or inherit sharing to better control the visibility of the data you process in Apex.",badField:"specifiedSharing",applicable:[T.SFDC_ApexClass],category:M},{id:9,description:"Schedulable should be scheduled",formula:e=>!1===(null==e?void 0:e.isScheduled)&&!0===(null==e?void 0:e.isSchedulable),errorMessage:"This Apex Class implements Schedulable but is not scheduled. What is the point? Is this class still necessary?",badField:"isScheduled",applicable:[T.SFDC_ApexClass],category:M},{id:10,description:"Not able to compile class",formula:e=>!0===(null==e?void 0:e.needsRecompilation),errorMessage:"This Apex Class can not be compiled for some reason. You should try to recompile it. If the issue remains you need to consider refactoring this class or the classes that it is using.",badField:"name",applicable:[T.SFDC_ApexClass],category:M},{id:11,description:"No coverage for this class",formula:e=>!1===(null==e?void 0:e.isTest)&&(isNaN(e.coverage)||!e.coverage),errorMessage:"This Apex Class does not have any code coverage. Consider launching the corresponding tests that will bring some coverage. If you do not know which test to launch just run them all!",badField:"coverage",applicable:[T.SFDC_ApexClass],category:M},{id:12,description:"Coverage not enough",formula:e=>(null==e?void 0:e.coverage)>0&&(null==e?void 0:e.coverage)<.75,errorMessage:"This Apex Class does not have enough code coverage (less than 75% of lines are covered by successful unit tests). Maybe you ran not all the unit tests to cover this class entirely? If you did, then consider augmenting that coverage with new test methods.",badField:"coverage",applicable:[T.SFDC_ApexClass],category:M},{id:13,description:"At least one testing method failed",formula:e=>{var t;return!0===(null==e?void 0:e.isTest)&&(null==e?void 0:e.testFailedMethods)&&(null===(t=null==e?void 0:e.testFailedMethods)||void 0===t?void 0:t.length)>0},errorMessage:"This Apex Test Class has at least one failed method.",badField:"testFailedMethods",applicable:[T.SFDC_ApexClass],category:M},{id:14,description:"Apex trigger should not contain SOQL statement",formula:e=>!0===(null==e?void 0:e.hasSOQL),errorMessage:"This Apex Trigger contains at least one SOQL statement. Best practices force you to move any SOQL statement in dedicated Apex Classes that you would call from the trigger. Please update the code accordingly.",badField:"hasSOQL",applicable:[T.SFDC_ApexTrigger],category:M},{id:15,description:"Apex trigger should not contain DML action",formula:e=>!0===(null==e?void 0:e.hasDML),errorMessage:"This Apex Trigger contains at least one DML action. Best practices force you to move any DML action in dedicated Apex Classes that you would call from the trigger. Please update the code accordingly.",badField:"hasDML",applicable:[T.SFDC_ApexTrigger],category:M},{id:16,description:"Apex Trigger should not contain logic",formula:e=>(null==e?void 0:e.length)>5e3,errorMessage:"Due to the massive number of source code (more than 5000 characters) in this Apex Trigger, we suspect that it contains logic. Best practices force you to move any logic in dedicated Apex Classes that you would call from the trigger. Please update the code accordingly.",badField:"length",applicable:[T.SFDC_ApexTrigger],category:M},{id:17,description:"No direct member for this group",formula:e=>!e.nbDirectMembers||0===(null==e?void 0:e.nbDirectMembers),errorMessage:"This public group (or queue) does not contain any direct members (users or sub groups). Is it empty on purpose? Maybe you should review its use in your org...",badField:"nbDirectMembers",applicable:[T.SFDC_Group],category:G},{id:18,description:"Custom profile with no active member",formula:e=>!0===(null==e?void 0:e.isCustom)&&0===(null==e?void 0:e.memberCounts),errorMessage:"This custom profile has no active members. Is it empty on purpose? Maybe you should review its use in your org...",badField:"memberCounts",applicable:[T.SFDC_Profile],category:G},{id:19,description:"Role with no active users",formula:e=>0===(null==e?void 0:e.activeMembersCount),errorMessage:"This role has no active users assigned to it. Is it on purpose? Maybe you should review its use in your org...",badField:"activeMembersCount",applicable:[T.SFDC_UserRole],category:G},{id:20,description:"Active user not under LEX",formula:e=>!1===(null==e?void 0:e.onLightningExperience),errorMessage:"This user is still using Classic. Time to switch to Lightning for all your users, don't you think?",badField:"onLightningExperience",applicable:[T.SFDC_User],category:N},{id:21,description:"Active user never logged",formula:e=>null===(null==e?void 0:e.lastLogin),errorMessage:"This active user has never logged in yet. Time to optimize your licence cost!",badField:"lastLogin",applicable:[T.SFDC_User],category:N},{id:22,description:"Workflow with no action",formula:e=>!1===(null==e?void 0:e.hasAction),errorMessage:"This workflow has no action, please review it and potentially remove it.",badField:"hasAction",applicable:[T.SFDC_Workflow],category:_},{id:23,description:"Workflow with empty time triggered list",formula:e=>{var t;return(null===(t=null==e?void 0:e.emptyTimeTriggers)||void 0===t?void 0:t.length)>0},errorMessage:"This workflow is time triggered but with no time triggered action, please review it.",badField:"emptyTimeTriggers",applicable:[T.SFDC_Workflow],category:_},{id:24,description:"Password policy with question containing password!",formula:e=>!0===(null==e?void 0:e.passwordQuestion),errorMessage:"This profile password policy allows you to have a password in the question! Please change that setting as it is clearly a lack of security in your org!",badField:"passwordQuestion",applicable:[T.SFDC_ProfilePasswordPolicy],category:U},{id:25,description:"Password policy with too big expiration",formula:e=>(null==e?void 0:e.passwordExpiration)>90,errorMessage:"This profile password policy allows you to have a password that expires after 90 days. Please consider having a shorter period of time for expiration if you policy.",badField:"passwordExpiration",applicable:[T.SFDC_ProfilePasswordPolicy],category:U},{id:26,description:"Password policy with no expiration",formula:e=>0===(null==e?void 0:e.passwordExpiration),errorMessage:"This profile password policy allows you to have a password that never expires. Why is that? Do you have this profile for technical users? Please reconsider this setting and use JWT authentication instead for technical users.",badField:"passwordExpiration",applicable:[T.SFDC_ProfilePasswordPolicy],category:U},{id:27,description:"Password history too small",formula:e=>(null==e?void 0:e.passwordHistory)<3,errorMessage:"This profile password policy allows users to set their password with a too-short memory. For example, they can keep on using the same different password every time you ask them to change it. Please increase this setting.",badField:"passwordHistory",applicable:[T.SFDC_ProfilePasswordPolicy],category:U},{id:28,description:"Password minimum size too small",formula:e=>(null==e?void 0:e.minimumPasswordLength)<8,errorMessage:"This profile password policy allows users to set passwords with less than 8 characters. That minimum length is not strong enough. Please increase this setting.",badField:"minimumPasswordLength",applicable:[T.SFDC_ProfilePasswordPolicy],category:U},{id:29,description:"Password complexity too weak",formula:e=>(null==e?void 0:e.passwordComplexity)<3,errorMessage:"This profile password policy allows users to set too-easy passwords. The complexity you choose is not strong enough. Please increase this setting.",badField:"passwordComplexity",applicable:[T.SFDC_ProfilePasswordPolicy],category:U},{id:30,description:"No max login attempts set",formula:e=>void 0===(null==e?void 0:e.maxLoginAttempts),errorMessage:"This profile password policy allows users to try infinitely to log in without locking the access. Please review this setting.",badField:"passwordExpiration",applicable:[T.SFDC_ProfilePasswordPolicy],category:U},{id:31,description:"No lockout period set",formula:e=>void 0===(null==e?void 0:e.lockoutInterval),errorMessage:"This profile password policy does not set a value for any locked out period. Please review this setting.",badField:"lockoutInterval",applicable:[T.SFDC_ProfilePasswordPolicy],category:U},{id:32,description:"IP Range too large (> 100,000)",formula:e=>(null==e?void 0:e.ipRanges.filter(e=>e.difference>1e5).length)>0,errorMessage:"This profile includes an IP range that is too wide (more than 100,000 IP addresses!). If you set an IP Range it should be not that large. You could split that range into multiple ones. The risk is that you include an IP that is not part of your company. Please review this setting.",badField:"ipRanges",applicable:[T.SFDC_ProfileRestrictions],category:U},{id:33,description:"Login hours too large",formula:e=>(null==e?void 0:e.loginHours.filter(e=>e.difference>1200).length)>0,errorMessage:"This profile includes a login hour that is too wide (more than 20 hours a day!). If you set a login hour it should reflect reality. Please review this setting.",badField:"loginHours",applicable:[T.SFDC_ProfileRestrictions],category:U},{id:34,description:"Inactive component",formula:e=>!1===(null==e?void 0:e.isActive),errorMessage:"This component is inactive, so why do not you just remove it from your org?",badField:"isActive",applicable:[T.SFDC_ValidationRule,T.SFDC_RecordType,T.SFDC_ApexTrigger,T.SFDC_Workflow,T.SFDC_EmailTemplate],category:G},{id:35,description:"No active version for this flow",formula:e=>!1===(null==e?void 0:e.isVersionActive),errorMessage:"This flow does not have an active version, did you forget to activate its latest version? or you do not need that flow anymore?",badField:"isVersionActive",applicable:[T.SFDC_Flow],category:G},{id:36,description:"Too many versions under this flow",formula:e=>(null==e?void 0:e.versionsCount)>7,errorMessage:"This flow has more than seven versions. Maybe it is time to do some cleaning in this flow!",badField:"versionsCount",applicable:[T.SFDC_Flow],category:G},{id:37,description:"Migrate this process builder",formula:e=>!0===(null==e?void 0:e.isProcessBuilder),errorMessage:"Time to migrate this process builder to flow!",badField:"name",applicable:[T.SFDC_Flow],category:G},{id:38,description:"No description for the current version of a flow",formula:e=>w(null==e?void 0:e.description),errorMessage:"This flow does not have a description. Best practices force you to use the Description field to give some informative context about why and how it is used/set/govern.",badField:"description",applicable:[T.SFDC_Flow],category:F},{id:39,description:"API Version too old for the current version of a flow",formula:e=>{var t;return D($.CurrentApiVersion,null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.apiVersion)},errorMessage:"The API version of this flow's current version is too old. Please update it to the newest version.",badField:"currentVersionRef.apiVersion",applicable:[T.SFDC_Flow],category:b},{id:40,description:"This flow is running without sharing",formula:e=>{var t;return"SystemModeWithoutSharing"===(null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.runningMode)},errorMessage:"The running mode of this version without sharing. With great power comes great responsibilities. Please check if this is REALLY needed.",badField:"currentVersionRef.runningMode",applicable:[T.SFDC_Flow],category:U},{id:41,description:"Too many nodes in this version",formula:e=>{var t;return(null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.totalNodeCount)>100},errorMessage:"There are more than one hundred nodes in this flow. Please consider using Apex? or cut it into multiple sub flows?",badField:"currentVersionRef.totalNodeCount",applicable:[T.SFDC_Flow],category:G},{id:42,description:"Near the limit",formula:e=>(null==e?void 0:e.usedPercentage)>=.8,errorMessage:"This limit is almost reached (>80%). Please review this.",badField:"usedPercentage",applicable:[T.SFDC_Limit],category:x},{id:43,description:"Almost all licenses are used",formula:e=>void 0!==(null==e?void 0:e.usedPercentage)&&(null==e?void 0:e.usedPercentage)>=.8,errorMessage:"The number of seats for this license is almost reached (>80%). Please review this.",badField:"usedPercentage",applicable:[T.SFDC_PermissionSetLicense],category:x},{id:44,description:"You could have licenses to free up",formula:e=>(null==e?void 0:e.remainingCount)>0&&(null==e?void 0:e.distinctActiveAssigneeCount)!==(null==e?void 0:e.usedCount),errorMessage:"The Used count from that permission set license does not match the number of distinct active users assigned to the same license. Please check if you could free up some licenses!",badField:"distinctActiveAssigneeCount",applicable:[T.SFDC_PermissionSetLicense],category:G},{id:45,description:"Role with a level >= 7",formula:e=>(null==e?void 0:e.level)>=7,errorMessage:"This role has a level in the Role Hierarchy which is seven or greater. Please reduce the maximum depth of the role hierarchy. Having that many levels has an impact on performance...",badField:"level",applicable:[T.SFDC_UserRole],category:G},{id:46,description:"Hard-coded URL suspicion in this item",formula:e=>{var t;return(null===(t=null==e?void 0:e.hardCodedURLs)||void 0===t?void 0:t.length)>0||!1},errorMessage:"The source code of this item contains one or more hard coded URLs pointing to domains like salesforce.com or force.*",badField:"hardCodedURLs",applicable:[T.SFDC_ApexClass,T.SFDC_ApexTrigger,T.SFDC_CollaborationGroup,T.SFDC_Field,T.SFDC_HomePageComponent,T.SFDC_VisualForceComponent,T.SFDC_VisualForcePage,T.SFDC_WebLink,T.SFDC_CustomTab,T.SFDC_EmailTemplate],category:L},{id:47,description:"Hard-coded Salesforce IDs suspicion in this item",formula:e=>{var t;return(null===(t=null==e?void 0:e.hardCodedIDs)||void 0===t?void 0:t.length)>0||!1},errorMessage:"The source code of this item contains one or more hard coded Salesforce IDs",badField:"hardCodedIDs",applicable:[T.SFDC_ApexClass,T.SFDC_ApexTrigger,T.SFDC_CollaborationGroup,T.SFDC_Field,T.SFDC_HomePageComponent,T.SFDC_VisualForceComponent,T.SFDC_VisualForcePage,T.SFDC_WebLink,T.SFDC_CustomTab,T.SFDC_EmailTemplate],category:O},{id:48,description:"At least one successful testing method was very long",formula:e=>{var t;return!0===(null==e?void 0:e.isTest)&&(null==e?void 0:e.testPassedButLongMethods)&&(null===(t=null==e?void 0:e.testPassedButLongMethods)||void 0===t?void 0:t.length)>0},errorMessage:"This Apex Test Class has at least one successful method which took more than 20 seconds to execute",badField:"testPassedButLongMethods",applicable:[T.SFDC_ApexClass],category:M},{id:49,description:"Page layout should be assigned to at least one Profile",formula:e=>0===(null==e?void 0:e.profileAssignmentCount),errorMessage:"This Page Layout is not assigned to any Profile. Please review this page layout and assign it to at least one profile.",badField:"profileAssignmentCount",applicable:[T.SFDC_PageLayout],category:G},{id:50,description:"Hard-coded URL suspicion in this document",formula:e=>!0===(null==e?void 0:e.isHardCodedURL),errorMessage:"The URL of this document contains a hard coded URL pointing to domains like salesforce.com or force.*",badField:"documentUrl",applicable:[T.SFDC_Document],category:L},{id:51,description:"Unassigned Record Type",formula:e=>!1===(null==e?void 0:e.isDefault)&&!1===(null==e?void 0:e.isAvailable),errorMessage:"This record type is not set as default nor as visible in any profile in this org. Please review this record type and remove it if it is not needed anymore.",badField:"isDefault",applicable:[T.SFDC_RecordType],category:G},{id:52,description:"Email template never used",formula:e=>null===(null==e?void 0:e.lastUsedDate),errorMessage:"This email template was never used. Is it really useful?",badField:"lastUsedDate",applicable:[T.SFDC_EmailTemplate],category:G},{id:53,description:"No description for this flow",formula:e=>!1===(null==e?void 0:e.isProcessBuilder)&&w(null==e?void 0:e.description),errorMessage:"This flow does not have a description. Best practices force you to use the Description field to give some informative context about why and how it is used/set/govern.",badField:"description",applicable:[T.SFDC_Flow],category:F},{id:54,description:"Hard-coded URL suspicion in this article",formula:e=>!0===(null==e?void 0:e.isHardCodedURL),errorMessage:"This article contains text information with links that points to domains like salesforce.com or force.*",badField:"isHardCodedURL",applicable:[T.SFDC_KnowledgeArticle],category:L},{id:55,description:"Custom permission set with no active member and only assigned to empty group(s)",formula:e=>!0===(null==e?void 0:e.isCustom)&&!1===(null==e?void 0:e.isGroup)&&0===(null==e?void 0:e.memberCounts)&&!0===(null==e?void 0:e.allIncludingGroupsAreEmpty),errorMessage:"This custom permission set has no active members and is only included in empty permission set groups. Is it on purpose? Maybe you should review its use in your org...",badField:"allIncludingGroupsAreEmpty",applicable:[T.SFDC_PermissionSet],category:G},{id:56,description:"Custom permission set group with no active member",formula:e=>!0===(null==e?void 0:e.isCustom)&&!0===(null==e?void 0:e.isGroup)&&0===(null==e?void 0:e.memberCounts),errorMessage:"This custom permission set group has no active members. Is it empty on purpose? Maybe you should review its use in your org...",badField:"memberCounts",applicable:[T.SFDC_PermissionSet],category:G},{id:57,description:"Custom permission set with no active member and not even assigned to group",formula:e=>{var t;return!0===(null==e?void 0:e.isCustom)&&!1===(null==e?void 0:e.isGroup)&&0===(null==e?void 0:e.memberCounts)&&0===(null===(t=null==e?void 0:e.permissionSetGroupIds)||void 0===t?void 0:t.length)},errorMessage:"This custom permission set has no active members and is not even assigned to a permission set group. Is it on purpose? Maybe you should review its use in your org...",badField:"memberCounts",applicable:[T.SFDC_PermissionSet],category:G},{id:58,description:"IP Range too large (> 16,777,216)",formula:e=>(null==e?void 0:e.ipRanges.filter(e=>e.difference>16777216).length)>0,errorMessage:"This profile includes an IP range that is too wide (more than 16,777,216 IP addresses!). If you set an IP Range it should be not that large. You could split that range into multiple ones. The risk is that you include an IP that is not part of your company. Please review this setting.",badField:"ipRanges",applicable:[T.SFDC_ProfileRestrictions],category:U},{id:59,description:"Object with more than 350 custom fields",formula:e=>(null==e?void 0:e.nbCustomFields)>350,errorMessage:"This object has more than 350 custom fields. Please consider reducing that number as it can impact performance and usability.",badField:"nbCustomFields",applicable:[T.SFDC_Object],category:x},{id:60,description:"Object with more than 15 page layouts",formula:e=>(null==e?void 0:e.nbPageLayouts)>15,errorMessage:"This object has more than 15 page layouts. Please consider reducing that number as it can impact performance and usability.",badField:"nbPageLayouts",applicable:[T.SFDC_Object],category:x},{id:61,description:"Object with more than 20 workflow rules",formula:e=>(null==e?void 0:e.nbWorkflowRules)>20,errorMessage:"This object has more than 20 workflow rules. Please consider reducing that number as it can impact performance and usability.",badField:"nbWorkflowRules",applicable:[T.SFDC_Object],category:x},{id:62,description:"Object with more than 20 validation rules",formula:e=>(null==e?void 0:e.nbValidationRules)>20,errorMessage:"This object has more than 20 validation rules. Please consider reducing that number as it can impact performance and usability.",badField:"nbValidationRules",applicable:[T.SFDC_Object],category:x},{id:63,description:"Page layout with more than 100 fields",formula:e=>(null==e?void 0:e.nbFields)>100,errorMessage:"This page layout has more than 100 fields. Please consider reducing that number as it can impact user adoption.",badField:"nbFields",applicable:[T.SFDC_PageLayout],category:N},{id:64,description:"Page layout with more than 11 related lists",formula:e=>(null==e?void 0:e.nbRelatedLists)>11,errorMessage:"This page layout has more than 11 related lists. Please consider reducing that number as it can impact user adoption.",badField:"nbRelatedLists",applicable:[T.SFDC_PageLayout],category:N},{id:65,description:"Page layout with Notes and Attachments related list",formula:e=>!0===(null==e?void 0:e.isAttachmentRelatedListIncluded),errorMessage:"This page layout has the Notes and Attachments related list in it. Please consider using the Files related list instead.",badField:"isAttachmentRelatedListIncluded",applicable:[T.SFDC_PageLayout],category:N},{id:66,description:"Custom profile with low number of active members",formula:e=>!0===(null==e?void 0:e.isCustom)&&(null==e?void 0:e.memberCounts)<=10,errorMessage:"This custom profile has a low number of active members (<= 10). Maybe you should review its use in your org...",badField:"memberCounts",applicable:[T.SFDC_Profile],category:G},{id:67,description:"Custom permission set with low number of active members and only assigned to empty group(s)",formula:e=>!0===(null==e?void 0:e.isCustom)&&!1===(null==e?void 0:e.isGroup)&&(null==e?void 0:e.memberCounts)<=10&&!0===(null==e?void 0:e.allIncludingGroupsAreEmpty),errorMessage:"This custom permission set has a low number of active members (<= 10) and is only included in empty permission set groups. Is it on purpose? Maybe you should review its use in your org...",badField:"allIncludingGroupsAreEmpty",applicable:[T.SFDC_PermissionSet],category:G},{id:68,description:"Custom permission set group with low number of active members",formula:e=>!0===(null==e?void 0:e.isCustom)&&!0===(null==e?void 0:e.isGroup)&&(null==e?void 0:e.memberCounts)<=10,errorMessage:"This custom permission set group has a low number of active members (<= 10). Is it empty on purpose? Maybe you should review its use in your org...",badField:"memberCounts",applicable:[T.SFDC_PermissionSet],category:G},{id:69,description:"Custom permission set with low number of active members and not even assigned to group",formula:e=>{var t;return!0===(null==e?void 0:e.isCustom)&&!1===(null==e?void 0:e.isGroup)&&(null==e?void 0:e.memberCounts)<=10&&0===(null===(t=null==e?void 0:e.permissionSetGroupIds)||void 0===t?void 0:t.length)},errorMessage:"This custom permission set has a low number of active members (<= 10) and is not even assigned to a permission set group. Is it on purpose? Maybe you should review its use in your org...",badField:"memberCounts",applicable:[T.SFDC_PermissionSet],category:G},{id:70,description:"This browser is considered out-of-date by Salesforce",formula:e=>"Chrome"===e.name&&e.version<88||"Edge"===e.name&&e.version<91||"Firefox"===e.name&&e.version<88||"Safari"===e.name&&e.version<14,errorMessage:'This browser is considered out-of-date by Salesforce. At this time, we consider the following list: Chrome <88, Edge <91, Firefox <88 and Safari <14. Please work with your user to make them switch to a more recent/supported browser. To identity the users you can go to the setup page "Login History" and export the data to identify them.',badField:"fullName",applicable:[T.SFDC_Browser],category:N},{id:71,description:"This browser is unsupported by Salesforce",formula:e=>"IE"===e.name,errorMessage:'This browser is unsupported by Salesforce. At this time, we consider only Internet Explorer whatever its version. Please work with your user to make them switch to a more recent/supported browser. To identity the users you can go to the setup page "Login History" and export the data to identify them.',badField:"name",applicable:[T.SFDC_Browser],category:N},{id:72,description:"User is logging directly without MFA",formula:e=>e.nbDirectLoginsWithoutMFA>0&&!0!==e.hasMfaByPass,errorMessage:"This user is logging in directly to Salesforce without using MFA (Multi-Factor Authentication). And this user has not the MFA bypass enabled. Please work with your user to make them use MFA for better security.",badField:"nbDirectLoginsWithoutMFA",applicable:[T.SFDC_User],category:U},{id:73,description:"Lightning page with Notes and Attachments related list",formula:e=>!0===(null==e?void 0:e.isAttachmentRelatedListIncluded),errorMessage:"This lightning page has the Notes and Attachments related list in it. Please consider using the Files related list instead.",badField:"isAttachmentRelatedListIncluded",applicable:[T.SFDC_LightningPage],category:N},{id:74,description:"User with debug mode enabled",formula:e=>!0===(null==e?void 0:e.hasDebugMode),errorMessage:"This user has the debug mode enabled. Please disable it for better performance and user adoption.",badField:"hasDebugMode",applicable:[T.SFDC_User],category:N},{id:100,description:"[LFS] Inactive Flow",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("InactiveFlow"))||!1},errorMessage:"This flow is inactive. Consider activating it or removing it from your org.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:G},{id:101,description:"[LFS] Process Builder",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("ProcessBuilder"))||!1},errorMessage:"Time to migrate this process builder to flow!",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:G},{id:102,description:"[LFS] Missing Flow Description",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("FlowDescription"))||!1},errorMessage:"This flow does not have a description. Add documentation about its purpose and usage.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:F},{id:103,description:"[LFS] Outdated API Version",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("APIVersion"))||!1},errorMessage:"The API version of this flow is outdated. Update it to the newest version.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:b},{id:104,description:"[LFS] Unsafe Running Context",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("UnsafeRunningContext"))||!1},errorMessage:"This flow runs in System Mode without Sharing, which can lead to unsafe data access.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:U},{id:105,description:"[LFS] SOQL Query In Loop",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("SOQLQueryInLoop"))||!1},errorMessage:"This flow has SOQL queries inside loops. Consolidate queries at the end of the flow to avoid governor limits.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:M},{id:106,description:"[LFS] DML Statement In Loop",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("DMLStatementInLoop"))||!1},errorMessage:"This flow has DML operations inside loops. Consolidate DML at the end to avoid governor limits.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:M},{id:107,description:"[LFS] Action Calls In Loop",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("ActionCallsInLoop"))||!1},errorMessage:"This flow has action calls inside loops. Bulkify apex calls using collection variables.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:M},{id:108,description:"[LFS] Hardcoded Id",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("HardcodedId"))||!1},errorMessage:"This flow contains hardcoded IDs which are org-specific. Use variables or merge fields instead.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:O},{id:109,description:"[LFS] Hardcoded Url",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("HardcodedUrl"))||!1},errorMessage:"This flow contains hardcoded URLs. Use $API formulas or custom labels instead.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:L},{id:110,description:"[LFS] Missing Null Handler",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("MissingNullHandler"))||!1},errorMessage:"This flow has Get Records operations without null checks. Use decision elements to validate results.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:M},{id:111,description:"[LFS] Missing Fault Path",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("MissingFaultPath"))||!1},errorMessage:"This flow has DML or action operations without fault handlers. Add fault paths for better error handling.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:M},{id:112,description:"[LFS] Recursive After Update",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("RecursiveAfterUpdate"))||!1},errorMessage:"This after-update flow modifies the same record that triggered it, risking recursion. Use before-save flows instead.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:M},{id:113,description:"[LFS] Duplicate DML Operation",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("DuplicateDMLOperation"))||!1},errorMessage:"This flow allows navigation back after DML operations, which may cause duplicate changes.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:M},{id:114,description:"[LFS] Get Record All Fields",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("GetRecordAllFields"))||!1},errorMessage:'This flow uses Get Records with "all fields". Specify only needed fields for better performance.',badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:M},{id:115,description:"[LFS] Record ID as String",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("RecordIdAsString"))||!1},errorMessage:"This flow uses a String recordId variable. Modern flows can receive the entire record object, eliminating Get Records queries.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:M},{id:116,description:"[LFS] Unconnected Element",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("UnconnectedElement"))||!1},errorMessage:"This flow has unconnected elements that are not in use. Remove them to maintain clarity.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:G},{id:117,description:"[LFS] Unused Variable",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("UnusedVariable"))||!1},errorMessage:"This flow has unused variables. Remove them to maintain efficiency.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:G},{id:118,description:"[LFS] Copy API Name",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("CopyAPIName"))||!1},errorMessage:'This flow has elements with copy-paste naming patterns like "Copy_X_Of_Element". Update API names for readability.',badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:F},{id:120,description:"[LFS] Same Record Field Updates",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("SameRecordFieldUpdates"))||!1},errorMessage:"This before-save flow uses Update Records on $Record. Use direct assignment instead for better performance.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:M},{id:122,description:"[LFS] Missing Metadata Description",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("MissingMetadataDescription"))||!1},errorMessage:"This flow has elements or variables without descriptions. Add documentation for better maintainability.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:F},{id:123,description:"[LFS] Missing Filter Record Trigger",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("MissingFilterRecordTrigger"))||!1},errorMessage:"This record-triggered flow lacks filters on changed fields or entry conditions, causing unnecessary executions.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:M},{id:124,description:"[LFS] Transform Instead of Loop",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("TransformInsteadOfLoop"))||!1},errorMessage:"This flow uses Loop + Assignment which could be replaced with Transform element (10x faster).",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:M},{id:125,description:"[LFS] Missing Auto Layout",formula:e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.currentVersionRef)||void 0===t?void 0:t.lfsViolations)||void 0===i?void 0:i.includes("AutoLayout"))||!1},errorMessage:"This flow doesn't use Auto-Layout mode. Enable it to keep your flow organized automatically.",badField:"currentVersionRef.lfsViolations",applicable:[T.SFDC_Flow],category:N},{id:126,description:"Not referenced anywhere for flow (excluding Screen Flows)",formula:e=>{var t,i;return!1===(null==e?void 0:e.isScreenFlow)&&!1===(null===(t=null==e?void 0:e.dependencies)||void 0===t?void 0:t.hadError)&&w(null===(i=e.dependencies)||void 0===i?void 0:i.referenced)},errorMessage:"This flow is not referenced anywhere (as we were told by the Dependency API). Please review the need to keep it in your org.",badField:"dependencies.referenced?.length",applicable:[T.SFDC_Flow],category:_}];Object.freeze(V);const B=new Map(V.map(e=>[e.id,e]));class ${static get AllScoreRules(){return V}static GetScoreRulesForHardCodedURLs(){return V.filter(e=>e.category===L).map(e=>e.id)}static GetScoreRule(e){const t=B.get(e);if(void 0===t)throw new Error(`Couldn't find the rule #${e}`);return t}static GetScoreRuleDescription(e){var t,i;return null!==(i=null===(t=B.get(e))||void 0===t?void 0:t.description)&&void 0!==i?i:"N/A"}static get CurrentApiVersion(){return(()=>{const e=new Date,t=e.getFullYear(),i=e.getMonth()+1;return 3*(t-2022)+53+(i<=2?0:i<=6?1:i<=10?2:3)})()}}Object.freeze($);const W="*",k="sobject",j="namespace",H="sobjecttype",Q="permissions",q="apexclasstype",J="grouptype";class Y{static get ALL_VALUES(){return W}static get SOBJECT_NAME(){return k}static get PACKAGE_NAME(){return j}static get SOBJECT_TYPE_NAME(){return H}static get SYSTEM_PERMISSIONS_LIST(){return Q}static get APEX_CLASS_TYPE(){return q}static get APEX_CLASS_TYPE_REGULAR(){return"apexregular"}static get APEX_CLASS_TYPE_TEST(){return"apextest"}static get APEX_CLASS_TYPE_UNCOMPILED(){return"apexuncompiled"}static get GROUP_TYPE(){return J}static get GROUP_TYPE_PG(){return"publicgroup"}static get GROUP_TYPE_QUEUE(){return"queue"}static getSObjectName(e){var t;return null!==(t=null==e?void 0:e.get(k))&&void 0!==t?t:W}static getPackageName(e){var t;return null!==(t=null==e?void 0:e.get(j))&&void 0!==t?t:W}static getSObjectTypeName(e){var t;return null!==(t=null==e?void 0:e.get(H))&&void 0!==t?t:W}static getSystemPermissionsList(e){var t;return null!==(t=null==e?void 0:e.get(Q))&&void 0!==t?t:[]}static getApexClassType(e){var t;return null!==(t=null==e?void 0:e.get(q))&&void 0!==t?t:W}static getGroupType(e){var t;return null!==(t=null==e?void 0:e.get(J))&&void 0!==t?t:W}}class K{constructor(e,t){this._setItemToCache=(e,t)=>{var i;let o="N/A";try{o=this._compressor.compress(t),this._storage.setItem(e,o)}catch(t){throw new Error(`Error occured when trying to save the value for key ${e} with: hexValue?.length=${null!==(i=null==o?void 0:o.length)&&void 0!==i?i:"N/A"}, Initiale error message was ${t.message}`)}},this._getEntryFromCache=e=>{let t;try{const i=this._storage.getItem(e);i&&(t=this._compressor.decompress(i))}catch(t){console.error(`Error occured when trying to get the value for key ${e}`,t,null==t?void 0:t.message)}if(!t)return null;try{const e=JSON.parse(t);return e.created&&Date.now()-e.created>oe?null:e}catch(e){return console.error(`Error occured when trying to parse the string: ${t}`,e,null==e?void 0:e.message),null}},this._compressor=e,this._storage=t}get(e){var t,i;const o=te(e),s=ee(e),r=this._getEntryFromCache(o);if(null===r)return this._storage.removeItem(o),this._storage.removeItem(s),null;const n=this._getEntryFromCache(s);if(null===n)return this._storage.removeItem(o),null;if(r.length=null!==(i=null===(t=n.content)||void 0===t?void 0:t.length)&&void 0!==i?i:0,this._storage.setItem(o,JSON.stringify(r)),"map"!==r.type)return n.content;try{return new Map(n.content)}catch(t){return console.error(`Error occured when trying to create a map for key ${e}. We just removed the key from the cache.`,t),this._storage.removeItem(o),this._storage.removeItem(s),null}}set(e,t){const i=te(e),o=ee(e);if(null==t)this._storage.removeItem(i),this._storage.removeItem(o);else{const e=Date.now(),s=t instanceof Map?{type:"map",length:t.size,created:e}:{type:"array",length:null==t?void 0:t.length,created:e},r=t instanceof Map?{content:Array.from(t.entries()).filter(e=>{var t;return!1===(null===(t=e[0])||void 0===t?void 0:t.endsWith("Ref"))}),created:e}:{content:t,created:e};try{this._setItemToCache(o,JSON.stringify(r)),this._setItemToCache(i,JSON.stringify(s))}catch(e){this._storage.removeItem(i),this._storage.removeItem(o)}}}details(){return this._storage.keys().filter(e=>e.startsWith(Z)).map(e=>{const t=this._getEntryFromCache(e),i=ie(e);return t?{name:i,isEmpty:0===(null==t?void 0:t.length),isMap:"map"===t.type,length:null==t?void 0:t.length,created:t.created}:{name:i,isEmpty:!0,isMap:!1,length:0,created:0}})}remove(e){this._storage.removeItem(ee(e)),this._storage.removeItem(te(e))}clear(){return this._storage.keys().filter(e=>e.startsWith(X)).forEach(e=>this._storage.removeItem(e))}}const X="OrgCheck",z=`${X}.`,Z=`${X}_`,ee=e=>e.startsWith(z)?e:z+e,te=e=>e.startsWith(Z)?e:Z+e,ie=e=>e.startsWith(Z)?e.substring(null==Z?void 0:Z.length):e.startsWith(z)?e.substring(null==z?void 0:z.length):e,oe=864e5,se=new Map([[T.SFDC_ApexClass,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_ApexTestMethodResult,{hasScore:!1,hasDependencies:!1,caster:e=>e}],[T.SFDC_ApexTrigger,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_Application,{hasScore:!1,hasDependencies:!1,caster:e=>e}],[T.SFDC_AppPermission,{hasScore:!1,hasDependencies:!1,caster:e=>e}],[T.SFDC_Browser,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_CollaborationGroup,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_CustomLabel,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_CustomTab,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_Dashboard,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_Document,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_EmailTemplate,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_Field,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_FieldPermission,{hasScore:!1,hasDependencies:!1,caster:e=>e}],[T.SFDC_FieldSet,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_Flow,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_FlowVersion,{hasScore:!1,hasDependencies:!1,caster:e=>e}],[T.SFDC_Group,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_HomePageComponent,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_KnowledgeArticle,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_LightningAuraComponent,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_LightningPage,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_LightningWebComponent,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_Limit,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_Object,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_ObjectPermission,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_ObjectRelationShip,{hasScore:!1,hasDependencies:!1,caster:e=>e}],[T.SFDC_ObjectType,{hasScore:!1,hasDependencies:!1,caster:e=>e}],[T.SFDC_Organization,{hasScore:!1,hasDependencies:!1,caster:e=>e}],[T.SFDC_Package,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_PageLayout,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_PermissionSet,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_PermissionSetLicense,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_Profile,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_ProfileIpRangeRestriction,{hasScore:!1,hasDependencies:!1,caster:e=>e}],[T.SFDC_ProfileLoginHourRestriction,{hasScore:!1,hasDependencies:!1,caster:e=>e}],[T.SFDC_ProfilePasswordPolicy,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_ProfileRestrictions,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_RecordType,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_Report,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_StaticResource,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_User,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_UserRole,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_ValidationRule,{hasScore:!0,hasDependencies:!1,caster:e=>e}],[T.SFDC_VisualForceComponent,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_VisualForcePage,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_WebLink,{hasScore:!0,hasDependencies:!0,caster:e=>e}],[T.SFDC_Workflow,{hasScore:!0,hasDependencies:!1,caster:e=>e}]]);class re{constructor(){this._instances=new Map}getInstance(e){const t=se.get(e);if(void 0===t)throw new Error(`No metadata information for dataAlias: ${e}`);!1===this._instances.has(e)&&this._instances.set(e,new ne(e,t.hasScore?$.AllScoreRules.filter(t=>{var i;return null===(i=t.applicable)||void 0===i?void 0:i.includes(e)}):[],t.hasDependencies,t.caster));const i=this._instances.get(e);if(void 0===i)throw new Error("Couldn't find the instance for given class");return i}}class ne{constructor(e,t,i,o){this._dataAlias=e,this._scoreRules=t,this._isDependenciesNeeded=i,this._caster=o}create(e){var t;if(!e)throw new TypeError("Setup can't be null.");if(!e.properties)throw new TypeError("Setup.properties can't be null.");const i=this._caster(e.properties);if((null===(t=this._scoreRules)||void 0===t?void 0:t.length)>0&&(i.score=0,i.badFields=[],i.badReasonIds=[]),!0===this._isDependenciesNeeded){if(!e.dependencyData)throw new TypeError(`This data (of type ${this._dataAlias}) is defined as with dependencies, but no dependencies were provided.`);i.dependencies=g.create(e.dependencyData,(e.dependencyIdFields||["id"]).map(e=>i[e]))}else if(e.dependencyData)throw new TypeError(`This data (of type ${this._dataAlias}) is defined as without dependencies, but some dependencies were provided.`);return i}computeScore(e){return this._scoreRules.filter(t=>{try{if(!0===t.formula(e))return!0}catch(t){console.error("COMPUTE SCORE",t,e)}return!1}).forEach(t=>{e.score++,e.badFields.push(t.badField),e.badReasonIds.push(t.id)}),e}createWithScore(e){return this.computeScore(this.create(e))}}class ae{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about ApexClass, ApexCodeCoverage, ApexCodeCoverageAggregate and AsyncApexJob in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, Name, ApiVersion, NamespacePrefix, Body, LengthWithoutComments, SymbolTable, CreatedDate, LastModifiedDate FROM ApexClass WHERE ManageableState IN ('installedEditable', 'unmanaged') ORDER BY Id",tooling:!0},{string:"SELECT ApexClassId FROM AsyncApexJob WHERE JobType = 'ScheduledApex' AND ApexClass.ManageableState IN ('installedEditable', 'unmanaged') ",tooling:!0},{string:"SELECT ApexClassId, MethodName, ApexTestRunResult.CreatedDate, RunTime, Outcome, StackTrace, (SELECT Cpu, AsyncCalls, Sosl, Soql, QueryRows, DmlRows, Dml FROM ApexTestResults LIMIT 1) FROM ApexTestResult WHERE (Outcome != 'Pass' OR RunTime > 20000) AND ApexTestRunResult.Status = 'Completed' AND ApexClass.ManageableState IN ('installedEditable', 'unmanaged') ORDER BY ApexClassId, ApexTestRunResult.CreatedDate desc, MethodName ",tooling:!0}],i),s=t.getInstance(T.SFDC_ApexClass),r=t.getInstance(T.SFDC_ApexTestMethodResult),n=o[0],a=o[1],l=o[2];null==i||i.log(`Retrieving dependencies of ${null==n?void 0:n.length} apex classes...`);const d=yield C.map(n,t=>e.caseSafeId(t.Id)),c=yield e.dependenciesQuery(d,i),u=[],g=[];for(let e=0;e<(null==d?void 0:d.length);e+=500){const t=`'${d.slice(e,e+500).join("','")}'`;u.push({string:`SELECT ApexClassOrTriggerId, ApexTestClassId FROM ApexCodeCoverage WHERE ApexClassOrTriggerId IN (${t}) AND ApexTestClass.ManageableState IN ('installedEditable', 'unmanaged') GROUP BY ApexClassOrTriggerId, ApexTestClassId `,queryMoreField:"CreatedDate",tooling:!0}),g.push({string:`SELECT ApexClassOrTriggerId, NumLinesCovered, NumLinesUncovered, Coverage FROM ApexCodeCoverageAggregate WHERE ApexClassOrTriggerId IN (${t}) `,tooling:!0})}const h=yield Promise.all([e.soqlQuery(u,i),e.soqlQuery(g,i)]),m=[].concat(...h[0]),f=[].concat(...h[1]);null==i||i.log(`Parsing ${null==n?void 0:n.length} apex classes...`);const S=new Map(yield C.map(n,t=>I(this,void 0,void 0,function*(){var i,o,r,n,a;const l=e.caseSafeId(t.Id),d=s.create({properties:{id:l,name:t.Name,apiVersion:t.ApiVersion,package:t.NamespacePrefix||"",isTest:!1,isAbstract:!1,isClass:!0,isEnum:!1,isInterface:!1,isSchedulable:!1,isScheduled:!1,length:null==t?void 0:t.lengthWithoutComments,needsRecompilation:!t.SymbolTable,coverage:0,relatedTestClasses:[],relatedClasses:[],createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(l,E.APEX_CLASS)},dependencyData:c});if(t.SymbolTable&&(d.innerClassesCount=(null===(i=t.SymbolTable.innerClasses)||void 0===i?void 0:i.length)||0,d.interfaces=t.SymbolTable.interfaces,d.isSchedulable=null!==(r=null===(o=t.SymbolTable.interfaces)||void 0===o?void 0:o.includes("System.Schedulable"))&&void 0!==r&&r,d.methodsCount=(null===(n=t.SymbolTable.methods)||void 0===n?void 0:n.length)||0,d.extends=t.SymbolTable.parentClass,t.SymbolTable.tableDeclaration&&(d.annotations=null===(a=t.SymbolTable.tableDeclaration.annotations)||void 0===a?void 0:a.map(e=>{var t;return null!==(t=null==e?void 0:e.name)&&void 0!==t?t:e}),yield C.forEach(t.SymbolTable.tableDeclaration.modifiers,e=>I(this,void 0,void 0,function*(){switch(e){case"with sharing":d.specifiedSharing="with";break;case"without sharing":d.specifiedSharing="without";break;case"inherited sharing":d.specifiedSharing="inherited";break;case"public":d.specifiedAccess="public";break;case"private":d.specifiedAccess="private";break;case"global":d.specifiedAccess="global";break;case"virtual":d.specifiedAccess="virtual";break;case"abstract":d.isAbstract=!0;break;case"testMethod":d.isTest=!0;break;default:console.error(`Unsupported modifier in SymbolTable.tableDeclaration: ${e} (ApexClassId=${d.id})`)}})))),t.Body){const e=p.RemoveCommentsFromCode(t.Body);d.isInterface=p.IsInterfaceFromApexCode(e),d.isEnum=p.IsEnumFromApexCode(e),d.isClass=!1===d.isInterface&&!1===d.isEnum,d.hardCodedURLs=p.FindHardCodedURLs(e),d.hardCodedIDs=p.FindHardCodedIDs(e),!0===d.isTest&&(d.isTestSeeAllData=p.IsTestSeeAllDataFromApexCode(e),d.nbSystemAsserts=p.CountOfAssertsFromApexCode(e))}return!0!==d.isEnum&&!0!==d.isInterface||(d.specifiedSharing="Not applicable"),[d.id,d]})));null==i||i.log(`Parsing ${null==m?void 0:m.length} apex code coverages...`);const v=new Map,y=new Map;return yield C.forEach(m,t=>I(this,void 0,void 0,function*(){var i,o;const s=e.caseSafeId(t.ApexClassOrTriggerId),r=e.caseSafeId(t.ApexTestClassId);S.has(s)&&(!1===v.has(s)&&v.set(s,new Set),!1===y.has(r)&&y.set(r,new Set),null===(i=v.get(s))||void 0===i||i.add(r),null===(o=y.get(r))||void 0===o||o.add(s))})),yield Promise.all([C.forEach(v,(e,t)=>I(this,void 0,void 0,function*(){if(S.has(t)){const i=S.get(t);i&&(i.relatedTestClassIds=Array.from(e))}})),C.forEach(y,(e,t)=>I(this,void 0,void 0,function*(){if(S.has(t)){const i=S.get(t);i&&(i.relatedClassIds=Array.from(e))}}))]),null==i||i.log(`Parsing ${null==f?void 0:f.length} apex code coverage aggregates...`),yield C.forEach(f,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.ApexClassOrTriggerId);if(S.has(i)){const e=S.get(i);e&&(e.coverage=t.NumLinesCovered/(t.NumLinesCovered+t.NumLinesUncovered))}})),null==i||i.log(`Parsing ${null==a?void 0:a.length} schedule apex classes...`),yield C.forEach(a,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.ApexClassId);if(S.has(i)){const e=S.get(i);e&&(e.isScheduled=!0)}})),null==i||i.log(`Parsing ${null==l?void 0:l.length} test results...`),yield C.forEach(l,t=>I(this,void 0,void 0,function*(){var i,o,s,n;const a=e.caseSafeId(t.ApexClassId);if(S.has(a)){const e=S.get(a);if(!0===(null==e?void 0:e.isTest)&&(e.lastTestRunDate||(e.lastTestRunDate=null===(i=t.ApexTestRunResult)||void 0===i?void 0:i.CreatedDate,e.testMethodsRunTime=0,e.testPassedButLongMethods=[],e.testFailedMethods=[]),e.lastTestRunDate===(null===(o=t.ApexTestRunResult)||void 0===o?void 0:o.CreatedDate))){const i=r.create({properties:{methodName:t.MethodName,isSuccessful:"Pass"===t.Outcome,runtime:t.RunTime,stacktrace:t.StackTrace}});if((null===(s=t.ApexTestResults)||void 0===s?void 0:s.records)&&(null===(n=t.ApexTestResults.records)||void 0===n?void 0:n.length)>0){const e=t.ApexTestResults.records[0];e.Cpu>0&&(i.cpuConsumption=e.Cpu),e.AsyncCalls>0&&(i.asyncCallsConsumption=e.AsyncCalls),e.Sosl>0&&(i.soslConsumption=e.Sosl),e.Soql>0&&(i.soqlConsumption=e.Soql),e.QueryRows>0&&(i.queryRowsConsumption=e.QueryRows),e.DmlRows>0&&(i.dmlRowsConsumption=e.DmlRows),e.Dml>0&&(i.dmlConsumption=e.Dml)}e.testMethodsRunTime+=i.runtime,(i.isSuccessful?e.testPassedButLongMethods:e.testFailedMethods).push(i)}}})),null==i||i.log(`Computing scores for ${S.size} Apex classes...`),yield C.forEach(S,e=>I(this,void 0,void 0,function*(){s.computeScore(e)})),null==i||i.log("Done"),S})}}class le{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about ApexTrigger in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, Name, ApiVersion, Status, NamespacePrefix, Body, UsageBeforeInsert, UsageAfterInsert, UsageBeforeUpdate, UsageAfterUpdate, UsageBeforeDelete, UsageAfterDelete, UsageAfterUndelete, UsageIsBulk, LengthWithoutComments, EntityDefinition.QualifiedApiName, CreatedDate, LastModifiedDate FROM ApexTrigger WHERE ManageableState IN ('installedEditable', 'unmanaged') ",tooling:!0}],i),s=t.getInstance(T.SFDC_ApexTrigger),r=o[0];null==i||i.log(`Retrieving dependencies of ${null==r?void 0:r.length} apex triggers...`);const n=yield e.dependenciesQuery(yield C.map(r,t=>e.caseSafeId(t.Id)),i);null==i||i.log(`Parsing ${null==r?void 0:r.length} apex triggers...`);const a=new Map(yield C.map(r,t=>{var i,o;const r=e.caseSafeId(t.Id),a=s.create({properties:{id:r,name:t.Name,apiVersion:t.ApiVersion,package:t.NamespacePrefix||"",length:null==t?void 0:t.lengthWithoutComments,isActive:"Active"===t.Status,beforeInsert:t.UsageBeforeInsert,afterInsert:t.UsageAfterInsert,beforeUpdate:t.UsageBeforeUpdate,afterUpdate:t.UsageAfterUpdate,beforeDelete:t.UsageBeforeDelete,afterDelete:t.UsageAfterDelete,afterUndelete:t.UsageAfterUndelete,objectId:e.caseSafeId(null===(i=t.EntityDefinition)||void 0===i?void 0:i.QualifiedApiName),hasSOQL:!1,hasDML:!1,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(r,E.APEX_TRIGGER,null===(o=t.EntityDefinition)||void 0===o?void 0:o.QualifiedApiName)},dependencyData:n});if(t.Body){const e=p.RemoveCommentsFromCode(t.Body);a.hasSOQL=p.HasSOQLFromApexCode(e),a.hasDML=p.HasDMLFromApexCode(e),a.hardCodedURLs=p.FindHardCodedURLs(e),a.hardCodedIDs=p.FindHardCodedIDs(e)}return s.computeScore(a),[a.id,a]},e=>!!e.EntityDefinition));return null==i||i.log("Done"),a})}}class de{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about Applications (tab set typed) in the org...");const o=yield e.soqlQuery([{string:"SELECT ApplicationId, Name, Label, NamespacePrefix FROM AppMenuItem WHERE Type = 'TabSet' "}],i),s=t.getInstance(T.SFDC_Application),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} applications...`);const n=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.ApplicationId);return[i,s.create({properties:{id:i,name:t.Name,label:t.Label,package:t.NamespacePrefix||""}})]}));return null==i||i.log("Done"),n})}}class ce{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about SetupEntityAccess for TabSet in the org...");const o=yield e.soqlQuery([{string:"SELECT ApplicationId, IsAccessible, IsVisible FROM AppMenuItem WHERE Type = 'TabSet' "},{string:"SELECT SetupEntityId, ParentId, Parent.IsOwnedByProfile, Parent.ProfileId FROM SetupEntityAccess WHERE SetupEntityType = 'TabSet' "}],i),s=t.getInstance(T.SFDC_AppPermission),r=o[0],n=o[1];null==i||i.log(`Parsing ${null==r?void 0:r.length} Application Menu Items...`);const a=new Map(yield C.map(r,t=>[e.caseSafeId(t.ApplicationId),{a:t.IsAccessible,v:t.IsVisible}]));null==i||i.log(`Parsing ${null==n?void 0:n.length} Setup Entity Accesses...`);const l=new Map(yield C.map(n,t=>{var i,o;const r=e.caseSafeId(t.SetupEntityId),n=e.caseSafeId(t.Parent.IsOwnedByProfile?t.Parent.ProfileId:t.ParentId),l=a.get(r);return[`${r}-${n}`,s.create({properties:{appId:r,parentId:n,isAccessible:null!==(i=null==l?void 0:l.a)&&void 0!==i&&i,isVisible:null!==(o=null==l?void 0:l.v)&&void 0!==o&&o}})]},t=>a.has(e.caseSafeId(t.SetupEntityId))));return null==i||i.log("Done"),l})}}class ue{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about LoginHistory in the org...");const o=yield e.soqlQuery([{string:"SELECT Browser, COUNT(Id) CntBrowser FROM LoginHistory WHERE LoginType = 'Application' GROUP BY Browser ",queryMoreField:"LoginTime"}],i),s=t.getInstance(T.SFDC_Browser),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} browsers...`);const n=new Map;return yield C.forEach(r,e=>I(this,void 0,void 0,function*(){var t;const i=e.Browser.split(" ",2),o=i&&(null==i?void 0:i.length)>0?i[0]:e.Browser,r=i&&(null==i?void 0:i.length)>1?i[1]:"",a=null!==(t=Number.parseInt(r,10))&&void 0!==t?t:NaN;if(n.has(o)){n.get(o).nbApplicationLogin+=e.CntBrowser}else{const t=s.create({properties:{fullName:e.Browser,name:o,version:a,nbApplicationLogin:e.CntBrowser}});n.set(o,t)}})),null==i||i.log("Done"),n})}}class pe{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about CollaborationGroup in the org...");const o=yield e.soqlQuery([{byPasses:["INVALID_TYPE"],string:"SELECT Id, InformationBody, Description, Name, CreatedDate, LastModifiedDate FROM CollaborationGroup "}],i),s=t.getInstance(T.SFDC_CollaborationGroup),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} chatter groups...`);const n=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.Id),o=s.create({properties:{id:i,name:t.Name,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,url:e.setupUrl(i,E.COLLABORATION_GROUP)}});if(t.InformationBody){const e=p.RemoveCommentsFromXML(t.InformationBody);o.hardCodedURLs=p.FindHardCodedURLs(e),o.hardCodedIDs=p.FindHardCodedIDs(e)}return s.computeScore(o),[o.id,o]}));return null==i||i.log("Done"),n})}}class ge{run(e,t,i,o){return I(this,void 0,void 0,function*(){const t=null==o?void 0:o.get(Y.SYSTEM_PERMISSIONS_LIST);if(void 0===t||0===(null==t?void 0:t.length))throw new Error(`DatasetCurrentUserPermissions: No '${Y.SYSTEM_PERMISSIONS_LIST}' were provided in the parameters.`);if(!Array.isArray(t))throw new Error(`DatasetCurrentUserPermissions: '${Y.SYSTEM_PERMISSIONS_LIST}' parameter should be an array of permission names.`);null==i||i.log("Querying REST API about UserPermissionAccess in the org...");const s=yield e.soqlQuery(t.map(e=>({string:`SELECT Permissions${e} FROM UserPermissionAccess LIMIT 1`,byPasses:["INVALID_FIELD"]})),i);null==i||i.log("Parsing the results...");const r=new Map;return s.forEach(e=>{if(1===(null==e?void 0:e.length)){const t=e[0];if(t){const e=Object.keys(t).filter(e=>e.startsWith("Permissions"));if(1===(null==e?void 0:e.length)){const i=e[0];if(i){const e=i.substring(11);r.set(e,t[i])}}}}}),r})}}const he=["00a","017","02c","0D5","1CE"];class me{run(e,t,i,o){return I(this,void 0,void 0,function*(){const s=Y.getSObjectName(o);null==i||i.log("Querying Tooling API about CustomField in the org...");const r=yield e.soqlQuery([{tooling:!0,string:"SELECT Id, EntityDefinition.QualifiedApiName, EntityDefinition.IsCustomSetting, EntityDefinition.KeyPrefix FROM CustomField WHERE ManageableState IN ('installedEditable', 'unmanaged') "+(s===Y.ALL_VALUES?"":`AND EntityDefinition.QualifiedApiName = '${s}'`)}],i),n=t.getInstance(T.SFDC_Field),a=r[0];null==i||i.log(`Parsing ${null==a?void 0:a.length} custom fields...`);const l=new Map(yield C.map(a,t=>[e.caseSafeId(t.Id),{qualifiedApiName:t.EntityDefinition.QualifiedApiName,isCustomSetting:t.EntityDefinition.IsCustomSetting}],e=>{var t;return!!e.EntityDefinition&&(!he.includes(e.EntityDefinition.KeyPrefix)&&!(null===(t=e.EntityDefinition.QualifiedApiName)||void 0===t?void 0:t.endsWith("_hd")))}));null==i||i.log(`Retrieving dependencies of ${null==a?void 0:a.length} custom fields...`);const d=yield e.dependenciesQuery(yield C.map(a,t=>e.caseSafeId(t.Id)),i);null==i||i.log(`Calling Tooling API Composite to get more information about these ${l.size} custom fields...`);const c=yield e.readMetadataAtScale("CustomField",Array.from(l.keys()),["INVALID_CROSS_REFERENCE_KEY"],i),u=new Map(yield C.map(c,t=>{var i;const o=e.caseSafeId(t.Id),s=l.get(o),r=n.create({properties:{id:o,name:t.DeveloperName,label:t.Metadata.label,package:t.NamespacePrefix||"",description:t.Description,isCustom:!0,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,objectId:s.qualifiedApiName,tooltip:t.InlineHelpText,type:t.Metadata.type,length:null===(i=t.Metadata)||void 0===i?void 0:i.length,isUnique:!0===t.Metadata.unique,isEncrypted:null!==t.Metadata.encryptionScheme&&"None"!==t.Metadata.encryptionScheme,isExternalId:!0===t.Metadata.externalId,isIndexed:!0===t.Metadata.unique||!0===t.Metadata.externalId,defaultValue:t.Metadata.defaultValue,formula:t.Metadata.formula,url:e.setupUrl(o,E.CUSTOM_FIELD,s.qualifiedApiName,e.getObjectType(s.qualifiedApiName,s.isCustomSetting))},dependencyData:d});if(t.Metadata.valueSet?"string"==typeof t.Metadata.valueSet?r.isRestrictedPicklist=!0:r.isRestrictedPicklist=!0===t.Metadata.valueSet.restricted:r.isRestrictedPicklist=!1,r.formula){const e=p.RemoveCommentsFromCode(r.formula);r.hardCodedURLs=p.FindHardCodedURLs(e),r.hardCodedIDs=p.FindHardCodedIDs(e)}return n.computeScore(r),[r.id,r]}));return null==i||i.log("Done"),u})}}class fe{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about ExternalString in the org...");const o=yield e.soqlQuery([{tooling:!0,string:"SELECT Id, Name, NamespacePrefix, Category, IsProtected, Language, MasterLabel, Value, CreatedDate, LastModifiedDate FROM ExternalString WHERE ManageableState IN ('installedEditable', 'unmanaged') "}],i),s=t.getInstance(T.SFDC_CustomLabel),r=o[0];null==i||i.log(`Retrieving dependencies of ${null==r?void 0:r.length} custom labels...`);const n=yield e.dependenciesQuery(yield C.map(r,t=>e.caseSafeId(t.Id)),i);null==i||i.log(`Parsing ${null==r?void 0:r.length} custom labels...`);const a=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.Id),o=s.createWithScore({properties:{id:i,name:t.Name,package:t.NamespacePrefix||"",category:t.Category,isProtected:!0===t.IsProtected,language:t.Language,label:t.MasterLabel,value:t.Value,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(i,E.CUSTOM_LABEL)},dependencyData:n});return[o.id,o]}));return null==i||i.log("Done"),a})}}class Se{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about CustomTab in the org...");const o=yield e.soqlQuery([{tooling:!0,string:"SELECT Id, DeveloperName, Type, Url, CreatedDate, Description, LastModifiedDate, NamespacePrefix FROM CustomTab WHERE ManageableState IN ('installedEditable', 'unmanaged')"}],i),s=t.getInstance(T.SFDC_CustomTab),r=o[0];null==i||i.log(`Retrieving dependencies of ${null==r?void 0:r.length} custom tabs...`);const n=yield e.dependenciesQuery(yield C.map(r,t=>e.caseSafeId(t.Id)),i);null==i||i.log(`Parsing ${null==r?void 0:r.length} custom tabs...`);const a=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.Id),o=s.createWithScore({properties:{id:i,name:t.DeveloperName||`${i} (No name from API!)`,package:t.NamespacePrefix||"",type:t.Type,description:t.Description,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,hardCodedURLs:p.FindHardCodedURLs(t.Url),hardCodedIDs:p.FindHardCodedIDs(t.Url),url:e.setupUrl(i,E.CUSTOM_TAB)},dependencyData:n});return[o.id,o]}));return null==i||i.log("Done"),a})}}class ve{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about dashboards in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, FolderName, FolderId, Title, DeveloperName, NamespacePrefix, Description, CreatedDate, LastModifiedDate, Type, LastViewedDate, LastReferencedDate, DashboardResultRefreshedDate FROM Dashboard "}],i),s=t.getInstance(T.SFDC_Dashboard),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} dashboards...`);const n=new Map(yield C.map(r,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.Id),o=s.createWithScore({properties:{id:i,folderName:t.FolderName,folderId:t.FolderId,title:t.Title,developerName:t.DeveloperName,package:t.NamespacePrefix||"",description:t.Description,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,type:t.Type,lastViewedDate:t.LastViewedDate,lastReferencedDate:t.LastReferencedDate,resultRefreshedDate:t.DashboardResultRefreshedDate,url:e.setupUrl(i,E.DASHBOARD)}});return[o.id,o]})));return null==i||i.log("Done"),n})}}class Ee{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about Document in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, Name, Url, BodyLength, ContentType, CreatedDate, Description, DeveloperName, Folder.Name, Folder.Id, LastModifiedDate, NamespacePrefix FROM Document "}],i),s=t.getInstance(T.SFDC_Document),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} documents...`);const n=new Map(yield C.map(r,t=>{var i,o,r;const n=e.caseSafeId(t.Id),a=s.createWithScore({properties:{id:n,name:t.Name,documentUrl:t.Url,isHardCodedURL:(null===(i=p.FindHardCodedURLs(t.Url))||void 0===i?void 0:i.length)>0||!1,size:t.BodyLength,type:t.ContentType,description:t.Description,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,folderId:null===(o=t.Folder)||void 0===o?void 0:o.Id,folderName:null===(r=t.Folder)||void 0===r?void 0:r.Name,package:t.NamespacePrefix||"",url:e.setupUrl(n,E.DOCUMENT)}});return[a.id,a]}));return null==i||i.log("Done"),n})}}class Ie{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about EmailTemplates in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, Name, ApiVersion, IsActive, HtmlValue, Body, Markup, CreatedDate, LastModifiedDate, FolderId, FolderName, Description, LastUsedDate, TimesUsed, UiType, TemplateType, NamespacePrefix FROM EmailTemplate"}],i),s=t.getInstance(T.SFDC_EmailTemplate),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} email templates...`);const n=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.Id),o=p.RemoveCommentsFromXML(t.HtmlValue||t.Body||t.Markup||""),r=s.createWithScore({properties:{id:i,name:t.Name,apiVersion:t.ApiVersion,isActive:t.IsActive,description:t.Description,package:t.NamespacePrefix||"",hardCodedURLs:p.FindHardCodedURLs(o),hardCodedIDs:p.FindHardCodedIDs(o),createdDate:t.CreatedDate,uiType:t.UiType,type:t.TemplateType,lastModifiedDate:t.LastModifiedDate,lastUsedDate:t.LastUsedDate,timesUsed:t.TimesUsed,folderId:t.FolderId,folderName:t.FolderName,url:e.setupUrl(i,E.EMAIL_TEMPLATE)}});return[r.id,r]}));return null==i||i.log("Done"),n})}}class Ce{run(e,t,i,o){return I(this,void 0,void 0,function*(){const s=Y.getSObjectName(o);null==i||i.log("Querying REST API about SetupEntityAccess for TabSet in the org...");const r=yield e.soqlQuery([{string:`SELECT Field, PermissionsRead, PermissionsEdit, ParentId, Parent.IsOwnedByProfile, Parent.ProfileId FROM FieldPermissions WHERE SObjectType = '${s}' `}],i),n=t.getInstance(T.SFDC_FieldPermission),a=r[0];null==i||i.log(`Parsing ${null==a?void 0:a.length} Field Permissions...`);const l=new Map(yield C.map(a,t=>{const i=e.caseSafeId(!0===t.Parent.IsOwnedByProfile?t.Parent.ProfileId:t.ParentId),o=t.Field.indexOf("."),s=-1===o?t.Field:t.Field.substring(o+1),r=n.create({properties:{fieldApiName:s,parentId:i,isRead:t.PermissionsRead,isEdit:t.PermissionsEdit}});return[`${t.Field}-${i}`,r]},e=>!!e.Parent&&(!!e.ParentId&&(!1!==`${e.ParentId}`.startsWith("0PS")&&!!e.Field))));return null==i||i.log("Done"),l})}}class ye{static normalizeMetadata(e){if(null==e)return null;if("object"!=typeof e)return e;if(Array.isArray(e))return e.filter(e=>null!=e).map(e=>this.normalizeMetadata(e));const t={};for(const i in e){const o=e[i];if(null!=o){const e=this.normalizeMetadata(o);null==e||Array.isArray(e)&&0===(null==e?void 0:e.length)||(t[i]=e)}}return t}static scanFlows(e,t){return I(this,void 0,void 0,function*(){var i;let o=new Map;try{const s="undefined"!=typeof window?null===window||void 0===window?void 0:window.lightningflowscanner:null!==(i=null===globalThis||void 0===globalThis?void 0:globalThis.lightningflowscanner)&&void 0!==i?i:null;if(s){const i=e.filter(e=>e.Metadata).map(e=>{const i=t(e.Id);return{uri:i,flow:new s.Flow(i,this.normalizeMetadata(e.Metadata))}}),r=s.scan(i);o=this.mapResults(r)}}catch(e){console.info(`Error scanning flows with LFS: returning an empty map (error: ${null==e?void 0:e.message})`)}return o})}static mapResults(e){const t=new Map;for(const i of e){const e=i.ruleResults.filter(e=>!0===e.occurs).map(e=>e.ruleName);(null==e?void 0:e.length)>0&&t.set(i.flow.uri,e)}return t}}const Pe={ApprovalWorkflow:"Approval Workflow",AutoLaunchedFlow:"Auto-Launched Flow",Flow:"Screen Flow",InvocableProcess:"Invocable Process",LoginFlow:"Login Flow",Survey:"Survey",Workflow:"Process Builder"};class Re{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about FlowDefinition in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, DeveloperName, ApiVersion, Description, ActiveVersionId, LatestVersionId, CreatedDate, LastModifiedDate FROM FlowDefinition",tooling:!0},{string:"SELECT DefinitionId, COUNT(Id) NbVersions FROM Flow GROUP BY DefinitionId",queryMoreField:"CreatedDate",tooling:!0}],i),s=t.getInstance(T.SFDC_Flow),r=t.getInstance(T.SFDC_FlowVersion),n=o[0],a=o[1];null==i||i.log(`Retrieving dependencies of ${null==n?void 0:n.length} flow versions...`);const l=[];yield C.forEach(n,t=>I(this,void 0,void 0,function*(){var i;l.push(e.caseSafeId(null!==(i=t.ActiveVersionId)&&void 0!==i?i:t.LatestVersionId)),l.push(e.caseSafeId(t.Id))}));const d=yield e.dependenciesQuery(l,i),c=[];null==i||i.log(`Parsing ${null==n?void 0:n.length} flow definitions...`);const u=new Map(yield C.map(n,t=>{const i=e.caseSafeId(t.Id),o=e.caseSafeId(t.ActiveVersionId),r=e.caseSafeId(t.LatestVersionId),n=s.create({properties:{id:i,name:t.DeveloperName,apiVersion:t.ApiVersion,currentVersionId:null!=o?o:r,isLatestCurrentVersion:o===r,isVersionActive:!!o,versionsCount:0,description:t.Description,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(i,E.FLOW_DEFINITION)},dependencyData:d,dependencyIdFields:["id","currentVersionId"]});return c.push(n.currentVersionId),[n.id,n]}));null==i||i.log(`Parsing ${null==a?void 0:a.length} flow versions...`),yield C.forEach(a,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.DefinitionId),o=u.get(i);o&&(o.versionsCount+=t.NbVersions)})),null==i||i.log(`Calling Tooling API Composite to get more information about these ${null==c?void 0:c.length} flow versions...`);const p=yield e.readMetadataAtScale("Flow",c,["UNKNOWN_EXCEPTION"],i);null==i||i.log(`Scanning ${null==p?void 0:p.length} flows with Lightning Flow Scanner...`);const g=yield ye.scanFlows(p,e.caseSafeId);return null==i||i.log(`LFS gave us ${g.size} violations.`),null==i||i.log(`Parsing ${null==p?void 0:p.length} flow versions from Tooling API...`),yield C.forEach(p,t=>I(this,void 0,void 0,function*(){var i,o,s,n,a,l,d,c,p;const h=e.caseSafeId(t.Id),m=e.caseSafeId(t.DefinitionId),f=null!==(i=g.get(h))&&void 0!==i?i:[],S=r.create({properties:{id:h,name:t.FullName,version:t.VersionNumber,apiVersion:t.ApiVersion,totalNodeCount:["actionCalls","apexPluginCalls","assignments","collectionProcessors","decisions","loops","orchestratedStages","recordCreates","recordDeletes","recordLookups","recordRollbacks","recordUpdates","screens","steps","waits"].reduce((e,i)=>{var o;return e+(null===(o=t.Metadata[i])||void 0===o?void 0:o.length)||0},0),dmlCreateNodeCount:(null===(o=t.Metadata.recordCreates)||void 0===o?void 0:o.length)||0,dmlDeleteNodeCount:(null===(s=t.Metadata.recordDeletes)||void 0===s?void 0:s.length)||0,dmlUpdateNodeCount:(null===(n=t.Metadata.recordUpdates)||void 0===n?void 0:n.length)||0,screenNodeCount:(null===(a=t.Metadata.screens)||void 0===a?void 0:a.length)||0,sobject:(null===(l=t.Metadata.start)||void 0===l?void 0:l.object)||"",triggerType:(null===(d=t.Metadata.start)||void 0===d?void 0:d.triggerType)||"",recordTriggerType:(null===(c=t.Metadata.start)||void 0===c?void 0:c.recordTriggerType)||"",isActive:"Active"===t.Status,description:t.Description,type:Pe[t.ProcessType]||`Other (${t.ProcessType})`,isProcessBuilder:"Workflow"===t.ProcessType,isScreenFlow:"Flow"===t.ProcessType,runningMode:t.RunInMode,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,lfsViolations:f,url:e.setupUrl(h,E.FLOW_VERSION)}});!0===S.isProcessBuilder&&(null===(p=t.Metadata.processMetadataValues)||void 0===p||p.forEach(e=>{"ObjectType"===e.name&&(S.sobject=e.value.stringValue),"TriggerType"===e.name&&(S.triggerType=e.value.stringValue)}));const v=u.get(m);v&&(v.currentVersionRef=S,v.type=S.type,v.isProcessBuilder=S.isProcessBuilder,v.isScreenFlow=S.isScreenFlow,v.description||(v.description=S.description))})),yield C.forEach(u,e=>I(this,void 0,void 0,function*(){return s.computeScore(e)})),null==i||i.log("Done"),u})}}class Ae{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about Group in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, Name, DeveloperName, DoesIncludeBosses, Type, RelatedId, Related.Name, (SELECT UserOrGroupId From GroupMembers)FROM Group "}],i),s=t.getInstance(T.SFDC_Group),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} groups...`);const n=new Map(yield C.map(r,t=>I(this,void 0,void 0,function*(){var i,o,r;const n=e.caseSafeId(t.Id);let a,l,d,c,u,p;switch(t.Type){case"Regular":case"Queue":a="Regular"===t.Type?E.PUBLIC_GROUP:E.QUEUE,l=t.Name,d=t.DeveloperName,c=t.DoesIncludeBosses;break;case"Role":case"RoleAndSubordinates":case"RoleAndSubordinatesInternal":a=E.ROLE,l=null!==(o=null===(i=t.Related)||void 0===i?void 0:i.Name)&&void 0!==o?o:"(unknown)",u="Role"!==t.Type,p=e.caseSafeId(t.RelatedId);break;default:l=t.Type,a=E.TECHNICAL_GROUP}const g=[],h=[];t.GroupMembers&&t.GroupMembers.records&&(null===(r=t.GroupMembers.records)||void 0===r?void 0:r.length)>0&&(yield C.forEach(t.GroupMembers.records,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.UserOrGroupId);(i.startsWith("005")?g:h).push(i)})));const m=s.createWithScore({properties:{id:n,name:l,developerName:d,type:a,isPublicGroup:"Regular"===t.Type,isQueue:"Queue"===t.Type,nbDirectMembers:(null==g?void 0:g.length)+(null==h?void 0:h.length),directUserIds:g,directGroupIds:h,includeBosses:!0===c,includeSubordinates:!0===u,relatedId:p,url:e.setupUrl(null!=p?p:n,a)}});return[m.id,m]})));return null==i||i.log("Done"),n})}}class Te{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about SFDC_HomePageComponent in the org...");const o=yield e.soqlQuery([{tooling:!0,string:"SELECT Id, Name, Body, CreatedDate, LastModifiedDate, NamespacePrefix FROM Homepagecomponent WHERE ManageableState IN ('installedEditable', 'unmanaged')"}],i),s=t.getInstance(T.SFDC_HomePageComponent),r=o[0];null==i||i.log(`Retrieving dependencies of ${null==r?void 0:r.length} homepage components...`);const n=yield e.dependenciesQuery(yield C.map(r,t=>e.caseSafeId(t.Id)),i);null==i||i.log(`Parsing ${null==r?void 0:r.length} homepage components...`);const a=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.Id),o=s.create({properties:{id:i,name:t.Name,package:t.NamespacePrefix||"",isBodyEmpty:!t.Body,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(i,E.HOME_PAGE_COMPONENT)},dependencyData:n});if(t.Body){const e=p.RemoveCommentsFromXML(t.Body);o.hardCodedURLs=p.FindHardCodedURLs(e),o.hardCodedIDs=p.FindHardCodedIDs(e)}return s.computeScore(o),[o.id,o]}));return null==i||i.log("Done"),a})}}class De{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about internal active User in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, Name, ProfileId, LastLoginDate, LastPasswordChangeDate, NumberOfFailedLogins, UserPreferencesLightningExperiencePreferred, UserPreferencesUserDebugModePref FROM User WHERE IsActive = true AND ContactId = NULL AND Profile.Id != NULL "},{string:"SELECT Id, AssigneeId, PermissionSetId, PermissionSet.IsOwnedByProfile, PermissionSet.PermissionsModifyAllData, PermissionSet.PermissionsViewAllData, PermissionSet.PermissionsManageUsers, PermissionSet.PermissionsCustomizeApplication, PermissionSet.PermissionsBypassMFAForUiLogins FROM PermissionSetAssignment WHERE Assignee.IsActive = true AND Assignee.ContactId = NULL AND Assignee.Profile.Id != NULL"},{string:"SELECT UserId, Status, LoginType, COUNT(Id) CntLogins FROM LoginHistory WHERE (LoginType = 'Application' OR LoginType LIKE '%SSO%') GROUP BY UserId, Status, LoginType ",queryMoreField:"LoginTime"},{string:"SELECT UserId, Policy, COUNT(Id) CntVerifications FROM VerificationHistory WHERE Activity = 'Login' AND Status IN ('AutomatedSuccess', 'Succeeded') AND (LoginHistory.LoginType = 'Application') GROUP BY UserId, Policy ",queryMoreField:"VerificationTime"}],i),s=t.getInstance(T.SFDC_User),r=o[0],n=o[1],a=o[2],l=o[3];null==i||i.log(`Parsing ${null==r?void 0:r.length} users...`);const d=new Map(yield C.map(r,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.Id),o=s.create({properties:{id:i,name:t.Name,lastLogin:t.LastLoginDate,numberFailedLogins:t.NumberOfFailedLogins,onLightningExperience:!0===t.UserPreferencesLightningExperiencePreferred,lastPasswordChange:t.LastPasswordChangeDate,profileId:e.caseSafeId(t.ProfileId),permissionSetIds:[],isAdminLike:!1,hasMfaByPass:!1,hasDebugMode:!0===t.UserPreferencesUserDebugModePref,nbDirectLogins:0,nbDirectLoginsWithMFA:0,nbDirectLoginsWithoutMFA:0,nbSSOLogins:0,url:e.setupUrl(i,E.USER)}});return[o.id,o]})));return null==i||i.log(`Parsing ${null==n?void 0:n.length} permission set assignments...`),n.forEach(t=>{var i,o,s,r,n,a;const l=e.caseSafeId(t.AssigneeId),c=e.caseSafeId(t.PermissionSetId),u=d.get(l);u&&(!1===(null===(i=t.PermissionSet)||void 0===i?void 0:i.IsOwnedByProfile)&&u.permissionSetIds.push(c),!0!==(null===(o=t.PermissionSet)||void 0===o?void 0:o.PermissionsModifyAllData)&&!0!==(null===(s=t.PermissionSet)||void 0===s?void 0:s.PermissionsViewAllData)&&!0!==(null===(r=t.PermissionSet)||void 0===r?void 0:r.PermissionsManageUsers)&&!0!==(null===(n=t.PermissionSet)||void 0===n?void 0:n.PermissionsCustomizeApplication)||(u.isAdminLike=!0),!0===(null===(a=t.PermissionSet)||void 0===a?void 0:a.PermissionsBypassMFAForUiLogins)&&(u.hasMfaByPass=!0))}),null==i||i.log(`Parsing ${null==a?void 0:a.length} user logins aggregates...`),yield C.forEach(a,t=>I(this,void 0,void 0,function*(){if("Success"===t.Status){const i=e.caseSafeId(t.UserId),o=d.get(i);o&&("Application"===t.LoginType?o.nbDirectLogins+=t.CntLogins:o.nbSSOLogins+=t.CntLogins)}})),null==i||i.log(`Parsing ${null==l?void 0:l.length} user verifications aggregates...`),yield C.forEach(l,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.UserId),o=d.get(i);o&&("TwoFactorAuthentication"===t.Policy?o.nbDirectLoginsWithMFA+=t.CntVerifications:o.nbDirectLoginsWithoutMFA+=t.CntVerifications)})),null==i||i.log(`Computing scores for ${d.size} users...`),yield C.forEach(d,e=>I(this,void 0,void 0,function*(){s.computeScore(e)})),null==i||i.log("Done"),d})}}class we{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying SOSL about published KnowledgeArticleVersion containing Salesforce domains...");const o=yield e.soslQuery([{string:"FIND { .salesforce.com OR .force.* } IN ALL FIELDS RETURNING KnowledgeArticleVersion (Id, KnowledgeArticleId, ArticleNumber, CreatedDate, LastModifiedDate, PublishStatus, Title, UrlName )",byPasses:["INVALID_TYPE"]}],i),s=t.getInstance(T.SFDC_KnowledgeArticle),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} articles...`);const n=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.Id),o=e.caseSafeId(t.KnowledgeArticleId),r=s.createWithScore({properties:{id:o,number:t.ArticleNumber,versionId:i,title:t.Title,urlName:t.UrlName,status:t.PublishStatus,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,isHardCodedURL:!0,url:e.setupUrl(i,E.KNOWLEDGE_ARTICLE_VERSION)}});return[r.id,r]}));return null==i||i.log("Done"),n})}}class _e{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about AuraDefinitionBundle in the org...");const o=yield e.soqlQuery([{tooling:!0,string:"SELECT Id, MasterLabel, ApiVersion, NamespacePrefix, Description, CreatedDate, LastModifiedDate FROM AuraDefinitionBundle WHERE ManageableState IN ('installedEditable', 'unmanaged') "}],i),s=t.getInstance(T.SFDC_LightningAuraComponent),r=o[0];null==i||i.log(`Retrieving dependencies of ${null==r?void 0:r.length} lightning aura components...`);const n=yield e.dependenciesQuery(yield C.map(r,t=>e.caseSafeId(t.Id)),i);null==i||i.log(`Parsing ${null==r?void 0:r.length} lightning aura components...`);const a=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.Id),o=s.createWithScore({properties:{id:i,name:t.MasterLabel,apiVersion:t.ApiVersion,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,url:e.setupUrl(i,E.AURA_WEB_COMPONENT)},dependencyData:n});return[o.id,o]}));return null==i||i.log("Done"),a})}}class Le{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about FlexiPage in the org...");const o=yield e.soqlQuery([{tooling:!0,string:"SELECT Id, MasterLabel, EntityDefinition.QualifiedApiName, Type, NamespacePrefix, Description, CreatedDate, LastModifiedDate FROM FlexiPage WHERE ManageableState IN ('installedEditable', 'unmanaged') "}],i),s=t.getInstance(T.SFDC_LightningPage),r=o[0],n=yield C.map(r,t=>e.caseSafeId(t.Id));null==i||i.log(`Retrieving dependencies of ${null==r?void 0:r.length} lightning pages...`);const a=yield e.dependenciesQuery(n,i);null==i||i.log(`Parsing ${null==r?void 0:r.length} lightning pages...`);const l=new Map(yield C.map(r,t=>{var i;const o=e.caseSafeId(t.Id),r=s.create({properties:{id:o,name:t.MasterLabel,type:t.Type,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,objectId:(null===(i=t.EntityDefinition)||void 0===i?void 0:i.QualifiedApiName)||"",nbComponents:0,nbFields:0,nbRelatedLists:0,isAttachmentRelatedListIncluded:!1,isRelatedListFromPageLayoutIncluded:!1,url:e.setupUrl(o,E.LIGHTNING_PAGE)},dependencyData:a});return[r.id,r]}));null==i||i.log(`Calling Tooling API Composite to get more information about these ${null==n?void 0:n.length} lightning pages...`);const d=yield e.readMetadataAtScale("FlexiPage",n,["FIELD_INTEGRITY_EXCEPTION","UNKNOWN_EXCEPTION"],i);return null==i||i.log(`Parsing ${null==d?void 0:d.length} lightning pages metadata information...`),yield C.forEach(d,t=>I(this,void 0,void 0,function*(){var i,o;const s=e.caseSafeId(t.Id),r=l.get(s);r&&(null===(o=null===(i=null==t?void 0:t.Metadata)||void 0===i?void 0:i.flexiPageRegions)||void 0===o||o.forEach(e=>{var t;null===(t=null==e?void 0:e.itemInstances)||void 0===t||t.forEach(e=>{var t,i;if(e.componentInstance&&null===e.fieldInstance){r.nbComponents++;const o=e.componentInstance;switch(null==o?void 0:o.componentName){case"force:relatedListContainer":r.isRelatedListFromPageLayoutIncluded=!0,r.nbRelatedLists++;break;case"force:relatedListSingleContainer":!1===r.isAttachmentRelatedListIncluded&&(r.isAttachmentRelatedListIncluded=null!==(i=null===(t=null==o?void 0:o.componentInstanceProperties)||void 0===t?void 0:t.some(e=>"relatedListApiName"===e.name&&"CombinedAttachments"===e.value))&&void 0!==i&&i),r.nbRelatedLists++}}else e.fieldInstance&&null===e.componentInstance&&r.nbFields++})}))})),yield C.forEach(l,e=>I(this,void 0,void 0,function*(){s.computeScore(e)})),null==i||i.log("Done"),l})}}class Oe{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about LightningComponentBundle in the org...");const o=yield e.soqlQuery([{tooling:!0,string:"SELECT Id, MasterLabel, ApiVersion, NamespacePrefix, Description, CreatedDate, LastModifiedDate FROM LightningComponentBundle WHERE ManageableState IN ('installedEditable', 'unmanaged') "}],i),s=t.getInstance(T.SFDC_LightningWebComponent),r=o[0];null==i||i.log(`Retrieving dependencies of ${null==r?void 0:r.length} lightning web components...`);const n=yield e.dependenciesQuery(yield C.map(r,t=>e.caseSafeId(t.Id)),i);null==i||i.log(`Parsing ${null==r?void 0:r.length} lightning web components...`);const a=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.Id),o=s.createWithScore({properties:{id:i,name:t.MasterLabel,apiVersion:t.ApiVersion,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,url:e.setupUrl(i,E.LIGHTNING_WEB_COMPONENT)},dependencyData:n});return[o.id,o]}));return null==i||i.log("Done"),a})}}class be{run(e,t,i,o){return I(this,void 0,void 0,function*(){var s,r,n,a,l,d,c,u,g,h,m,f;const S=Y.getSObjectName(o);if(void 0===S||"string"!=typeof S)throw new Error("DatasetObject: No object were provided in the parameters.");const v=S.split("__"),y=3===(null==v?void 0:v.length)?v[0]:"",P=t.getInstance(T.SFDC_Field),R=t.getInstance(T.SFDC_FieldSet),A=t.getInstance(T.SFDC_PageLayout),D=t.getInstance(T.SFDC_Limit),w=t.getInstance(T.SFDC_ValidationRule),_=t.getInstance(T.SFDC_WebLink),L=t.getInstance(T.SFDC_RecordType),O=t.getInstance(T.SFDC_ObjectRelationShip),b=t.getInstance(T.SFDC_Object),M=yield Promise.all([e.describe(S,i),e.soqlQuery([{tooling:!0,string:`SELECT Id, DurableId, DeveloperName, Description, NamespacePrefix, ExternalSharingModel, InternalSharingModel, (SELECT Id FROM ApexTriggers), (SELECT Id, MasterLabel, Description FROM FieldSets), (SELECT Id, Name, LayoutType FROM Layouts), (SELECT DurableId, Label, Max, Remaining, Type FROM Limits), (SELECT Id, Active, Description, ErrorDisplayField, ErrorMessage, ValidationName, NamespacePrefix, CreatedDate, LastModifiedDate FROM ValidationRules), (SELECT Id, Name, Url, LinkType, OpenType, Description, CreatedDate, LastModifiedDate, NamespacePrefix FROM WebLinks) FROM EntityDefinition WHERE QualifiedApiName = '${S}' `+(y?`AND NamespacePrefix = '${y}' `:"")+"LIMIT 1"},{tooling:!0,string:`SELECT DurableId, QualifiedApiName, Description, IsIndexed FROM FieldDefinition WHERE EntityDefinition.QualifiedApiName = '${S}' `+(y?`AND EntityDefinition.NamespacePrefix = '${y}' `:""),queryMoreField:"DurableId"},{string:`SELECT TableEnumOrId, Id FROM WorkflowRule WHERE TableEnumOrId = '${S}' `+(y?`AND EntityDefinition.NamespacePrefix = '${y}' `:""),tooling:!0}],i),e.recordCount(S,i)]),F=M[0],N=e.getObjectType(F.name,F.customSetting),U=M[1][0][0];if(!U)throw new TypeError(`No entity definition record found for: ${S}`);const x=M[1][1],G=M[1][2],V=M[2],B=[],$=new Map;yield C.forEach(x,t=>I(this,void 0,void 0,function*(){var i;if(t&&t.DurableId&&t.DurableId.split&&t.DurableId.includes){const o=e.caseSafeId(t.DurableId.split(".")[1]);(null===(i=t.DurableId)||void 0===i?void 0:i.includes(".00N"))?B.push(o):$.set(t.QualifiedApiName,{id:o,description:t.Description,isIndexed:t.IsIndexed})}}));const W=yield C.map(F.fields,t=>{const i=$.get(t.name);return P.createWithScore({properties:{id:i.id,name:t.label,label:t.label,description:i.description,tooltip:t.inlineHelpText,type:t.type,length:null==t?void 0:t.length,isUnique:t.unique,isEncrypted:t.encrypted,isExternalId:t.externalId,isIndexed:i.isIndexed,defaultValue:t.defaultValue,formula:t.calculatedFormula,url:e.setupUrl(i.id,E.STANDARD_FIELD,U.DurableId,N)},dependencyData:{records:[],errors:[]}})},e=>$.has(e.name)),k=yield C.map(null===(s=U.ApexTriggers)||void 0===s?void 0:s.records,t=>e.caseSafeId(t.Id)),j=yield C.map(G,t=>e.caseSafeId(t.Id)),H=yield C.map(null===(r=U.FieldSets)||void 0===r?void 0:r.records,t=>R.createWithScore({properties:{id:e.caseSafeId(t.Id),label:t.MasterLabel,description:t.Description,url:e.setupUrl(t.Id,E.FIELD_SET,U.DurableId)}})),Q=yield C.map(null===(n=U.Layouts)||void 0===n?void 0:n.records,t=>A.createWithScore({properties:{id:e.caseSafeId(t.Id),name:t.Name,type:t.LayoutType,url:e.setupUrl(t.Id,E.PAGE_LAYOUT,U.DurableId)},dependencyData:{records:[],errors:[]}})),q=yield C.map(null===(a=U.Limits)||void 0===a?void 0:a.records,t=>D.createWithScore({properties:{id:e.caseSafeId(t.DurableId),label:t.Label,max:t.Max,remaining:t.Remaining,used:t.Max-t.Remaining,usedPercentage:(t.Max-t.Remaining)/t.Max,type:t.Type}})),J=yield C.map(null===(l=U.ValidationRules)||void 0===l?void 0:l.records,t=>w.createWithScore({properties:{id:e.caseSafeId(t.Id),name:t.ValidationName,isActive:t.Active,description:t.Description,errorDisplayField:t.ErrorDisplayField,errorMessage:t.ErrorMessage,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(t.Id,E.VALIDATION_RULE)}})),K=yield C.map(null===(d=U.WebLinks)||void 0===d?void 0:d.records,t=>_.createWithScore({properties:{id:e.caseSafeId(t.Id),name:t.Name,hardCodedURLs:p.FindHardCodedURLs(t.Url),hardCodedIDs:p.FindHardCodedIDs(t.Url),type:t.LinkType,behavior:t.OpenType,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,url:e.setupUrl(t.Id,E.WEB_LINK,U.DurableId)},dependencyData:{records:[],errors:[]}})),X=yield C.map(F.recordTypeInfos,t=>L.createWithScore({properties:{id:e.caseSafeId(t.recordTypeId),name:t.name,developerName:t.developerName,isActive:t.active,isAvailable:t.available,isDefault:t.defaultRecordTypeMapping,isMaster:t.master,url:e.setupUrl(t.recordTypeId,E.RECORD_TYPE,U.DurableId)}})),z=yield C.map(F.childRelationships,e=>O.createWithScore({properties:{name:e.relationshipName,childObject:e.childSObject,fieldName:e.field,isCascadeDelete:e.cascadeDelete,isRestrictedDelete:e.restrictedDelete}}),e=>null!==e.relationshipName),Z=b.createWithScore({properties:{id:U.DurableId,label:F.label,labelPlural:F.labelPlural,isCustom:F.custom,isFeedEnabled:F.feedEnabled,isMostRecentEnabled:F.mruEnabled,isSearchable:F.searchable,keyPrefix:F.keyPrefix,name:U.DeveloperName,apiname:F.name,package:U.NamespacePrefix||"",typeId:N,description:U.Description,externalSharingModel:U.ExternalSharingModel,internalSharingModel:U.InternalSharingModel,apexTriggerIds:k,nbApexTriggers:null!==(c=null==k?void 0:k.length)&&void 0!==c?c:0,fieldSets:H,limits:q,layouts:Q,nbPageLayouts:null!==(u=null==Q?void 0:Q.length)&&void 0!==u?u:0,validationRules:J,nbValidationRules:null!==(g=null==J?void 0:J.length)&&void 0!==g?g:0,webLinks:K,standardFields:W,customFieldIds:B,nbCustomFields:null!==(h=null==B?void 0:B.length)&&void 0!==h?h:0,recordTypes:X,nbRecordTypes:null!==(m=null==X?void 0:X.length)&&void 0!==m?m:0,relationships:z,workflowRuleIds:j,nbWorkflowRules:null!==(f=null==j?void 0:j.length)&&void 0!==f?f:0,recordCount:V,url:e.setupUrl(U.Id,N)}});return null==i||i.log("Done"),Z})}}class Me{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about ObjectPermissions in the org...");const o=yield e.soqlQuery([{string:"SELECT ParentId, Parent.IsOwnedByProfile, Parent.ProfileId, SobjectType, CreatedDate, LastModifiedDate,PermissionsRead, PermissionsCreate, PermissionsEdit, PermissionsDelete, PermissionsViewAllRecords, PermissionsModifyAllRecords FROM ObjectPermissions"}],i),s=t.getInstance(T.SFDC_ObjectPermission),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} object permissions...`);const n=new Map(yield C.map(r,t=>{const i=s.create({properties:{parentId:e.caseSafeId(!0===t.Parent.IsOwnedByProfile?t.Parent.ProfileId:t.ParentId),objectType:t.SobjectType,isRead:t.PermissionsRead,isCreate:t.PermissionsCreate,isEdit:t.PermissionsEdit,isDelete:t.PermissionsDelete,isViewAll:t.PermissionsViewAllRecords,isModifyAll:t.PermissionsModifyAllRecords,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate}});return[`${i.parentId}_${i.objectType}`,i]},e=>null!==e.Parent));return null==i||i.log("Done"),n})}}class Fe{run(e,t,i){return I(this,void 0,void 0,function*(){const o=t.getInstance(T.SFDC_Object);null==i||i.log("Performing a global describe and in parallel a SOQL query to EntityDefinition...");const s=yield Promise.all([e.describeGlobal(i),e.soqlQuery([{string:"SELECT DurableId, NamespacePrefix, DeveloperName, QualifiedApiName, ExternalSharingModel, InternalSharingModel FROM EntityDefinition WHERE KeyPrefix <> null AND DeveloperName <> null AND (NOT(KeyPrefix IN ('00a', '017', '02c', '0D5', '1CE'))) AND (NOT(QualifiedApiName like '%_hd'))",tooling:!0,queryMoreField:"DurableId"},{string:"SELECT EntityDefinitionId, COUNT(Id) NbCustomFields FROM CustomField GROUP BY EntityDefinitionId",tooling:!0,queryMoreField:"CreatedDate"},{string:"SELECT EntityDefinitionId, COUNT(Id) NbPageLayouts FROM Layout GROUP BY EntityDefinitionId",tooling:!0,queryMoreField:"CreatedDate"},{string:"SELECT EntityDefinitionId, COUNT(Id) NbRecordTypes FROM RecordType GROUP BY EntityDefinitionId",tooling:!0,queryMoreField:"CreatedDate"},{string:"SELECT TableEnumOrId, COUNT(Id) NbWorkflowRules FROM WorkflowRule GROUP BY TableEnumOrId",tooling:!0,queryMoreField:"CreatedDate"},{string:"SELECT EntityDefinitionId, COUNT(Id) NbValidationRules FROM ValidationRule GROUP BY EntityDefinitionId",tooling:!0,queryMoreField:"CreatedDate"},{string:"SELECT EntityDefinitionId, COUNT(Id) NbTriggers FROM ApexTrigger GROUP BY EntityDefinitionId",tooling:!0,queryMoreField:"CreatedDate"}],i)]),r=s[0],n=s[1][0],a=s[1][1],l=s[1][2],d=s[1][3],c=s[1][4],u=s[1][5],p=s[1][6],g={},h=yield C.map(n,e=>(g[e.QualifiedApiName]=e,e.QualifiedApiName)),m=new Map,f=(e,t,i)=>{const o=`${e}-${t}`;!1===m.has(o)?m.set(o,i):m.set(o,m.get(o)+i)};yield Promise.all([C.forEach(a,e=>I(this,void 0,void 0,function*(){return f(e.EntityDefinitionId,"cf",e.NbCustomFields)})),C.forEach(l,e=>I(this,void 0,void 0,function*(){return f(e.EntityDefinitionId,"pl",e.NbPageLayouts)})),C.forEach(d,e=>I(this,void 0,void 0,function*(){return f(e.EntityDefinitionId,"rt",e.NbRecordTypes)})),C.forEach(c,e=>I(this,void 0,void 0,function*(){return f(e.TableEnumOrId,"wf",e.NbWorkflowRules)})),C.forEach(u,e=>I(this,void 0,void 0,function*(){return f(e.EntityDefinitionId,"vr",e.NbValidationRules)})),C.forEach(p,e=>I(this,void 0,void 0,function*(){return f(e.EntityDefinitionId,"ap",e.NbTriggers)}))]),null==i||i.log(`Parsing ${null==r?void 0:r.length} objects...`);const S=new Map(yield C.map(r,t=>{var i,s,r,n,a,l;const d=e.getObjectType(t.name,t.customSetting),c=g[t.name],u=c.DurableId,p=o.createWithScore({properties:{id:t.name,label:t.label,name:c.DeveloperName,apiname:t.name,package:c.NamespacePrefix||"",typeId:d,externalSharingModel:c.ExternalSharingModel,internalSharingModel:c.InternalSharingModel,nbCustomFields:null!==(i=m.get(`${u}-cf`))&&void 0!==i?i:0,nbPageLayouts:null!==(s=m.get(`${u}-pl`))&&void 0!==s?s:0,nbRecordTypes:null!==(r=m.get(`${u}-rt`))&&void 0!==r?r:0,nbWorkflowRules:null!==(n=m.get(`${t.name}-wf`))&&void 0!==n?n:0,nbValidationRules:null!==(a=m.get(`${u}-vr`))&&void 0!==a?a:0,nbApexTriggers:null!==(l=m.get(`${u}-at`))&&void 0!==l?l:0,url:e.setupUrl(u,d)}});return[p.id,p]},e=>!!(null==h?void 0:h.includes(e.name))));return null==i||i.log("Done"),S})}}const Ne="StandardEntity",Ue="CustomObject",xe="ExternalObject",Ge="CustomSetting",Ve="CustomMetadataType",Be="CustomEvent",$e="KnowledgeArticle",We="CustomBigObject",ke=[{id:Ne,label:"Standard Object"},{id:Ue,label:"Custom Object"},{id:xe,label:"External Object"},{id:Ge,label:"Custom Setting"},{id:Ve,label:"Custom Metadata Type"},{id:Be,label:"Platform Event"},{id:$e,label:"Knowledge Article"},{id:We,label:"Big Object"}];class je{run(e,t,i){return I(this,void 0,void 0,function*(){const e=t.getInstance(T.SFDC_ObjectType);return new Map(ke.map(t=>[t.id,e.create({properties:{id:t.id,label:t.label}})]))})}}const He="Production",Qe="Developer Edition",qe="Sandbox",Je="Trial";class Ye{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about Organization in the org...");const o=(yield e.soqlQuery([{string:"SELECT Id, Name, IsSandbox, OrganizationType, TrialExpirationDate, NamespacePrefix FROM Organization LIMIT 1"}],i))[0];if(!o||0===(null==o?void 0:o.length))throw new Error("DatasetOrganization: No Organization record found in the org.");const s=o[0];null==i||i.log("We need to get the first result and from there the first record..."),null==i||i.log("Parsing the result...");const r=t.getInstance(T.SFDC_Organization);let n;n="Developer Edition"===s.OrganizationType?Qe:!0===s.IsSandbox?qe:!1===s.IsSandbox&&s.TrialExpirationDate?Je:He;const a=r.create({properties:{id:e.caseSafeId(s.Id),name:s.Name,type:n,isDeveloperEdition:n===Qe,isSandbox:n===qe,isTrial:n===Je,isProduction:n===He,localNamespace:s.NamespacePrefix||""}});return null==i||i.log("Done"),a})}}class Ke{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about InstalledSubscriberPackage and REST API about Organization in the org...");const o=yield e.soqlQuery([{tooling:!0,string:"SELECT Id, SubscriberPackage.NamespacePrefix, SubscriberPackage.Name FROM InstalledSubscriberPackage "},{string:"SELECT NamespacePrefix FROM Organization LIMIT 1 "}],i),s=t.getInstance(T.SFDC_Package),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} installed packages...`);const n=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.Id),o=s.create({properties:{id:i,name:t.SubscriberPackage.Name,namespace:t.SubscriberPackage.NamespacePrefix,type:"Installed"}});return[o.id,o]})),a=o[1];if(!a||0===(null==a?void 0:a.length))throw new Error("DatasetPackages: No Organization record found in the org.");const l=a[0].NamespacePrefix;return l&&(null==i||i.log(`Adding your local package ${l}...`),n.set(l,s.create({properties:{id:l,name:l,namespace:l,type:"Local"}}))),null==i||i.log("Done"),n})}}class Xe{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about Layout and ProfileLayout in the org...");const o=yield e.soqlQuery([{tooling:!0,string:"SELECT Id, Name, NamespacePrefix, LayoutType, EntityDefinition.DurableId, EntityDefinition.QualifiedApiName, CreatedDate, LastModifiedDate FROM Layout "},{tooling:!0,string:"SELECT LayoutId, COUNT(ProfileId) CountAssignment FROM ProfileLayout WHERE Profile.Name != null GROUP BY LayoutId ",queryMoreField:"CreatedDate"}],i),s=t.getInstance(T.SFDC_PageLayout),r=o[0],n=o[1],a=yield C.map(r,t=>e.caseSafeId(t.Id));null==i||i.log(`Retrieving dependencies of ${null==r?void 0:r.length} page layouts...`);const l=yield e.dependenciesQuery(a,i);null==i||i.log(`Parsing ${null==r?void 0:r.length} page layouts...`);const d=new Map(yield C.map(r,t=>{var i,o;const r=e.caseSafeId(t.Id),n=s.create({properties:{id:r,name:t.Name,package:t.NamespacePrefix||"",objectId:null===(i=t.EntityDefinition)||void 0===i?void 0:i.QualifiedApiName,type:t.LayoutType,profileAssignmentCount:0,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(r,E.PAGE_LAYOUT,null===(o=t.EntityDefinition)||void 0===o?void 0:o.DurableId)},dependencyData:l});return[n.id,n]},e=>!!e.EntityDefinition));null==i||i.log(`Parsing ${null==n?void 0:n.length} page layout assignment counts...`),yield C.forEach(n,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.LayoutId),o=d.get(i);o&&(o.profileAssignmentCount+=t.CountAssignment)})),null==i||i.log(`Calling Tooling API Composite to get more information about these ${null==a?void 0:a.length} page layouts...`);const c=yield e.readMetadataAtScale("Layout",a,["FIELD_INTEGRITY_EXCEPTION","UNKNOWN_EXCEPTION"],i);return null==i||i.log(`Parsing ${null==c?void 0:c.length} page layout metadata information...`),yield C.forEach(c,t=>I(this,void 0,void 0,function*(){var i,o,s,r,n,a,l,c;const u=e.caseSafeId(t.Id),p=d.get(u);p&&(p.nbRelatedLists=null!==(s=null===(o=null===(i=null==t?void 0:t.Metadata)||void 0===i?void 0:i.relatedLists)||void 0===o?void 0:o.length)&&void 0!==s?s:0,p.isAttachmentRelatedListIncluded=null!==(a=null===(n=null===(r=null==t?void 0:t.Metadata)||void 0===r?void 0:r.relatedLists)||void 0===n?void 0:n.some(e=>"RelatedNoteList"===e.relatedList))&&void 0!==a&&a,p.nbFields=0,null===(c=null===(l=null==t?void 0:t.Metadata)||void 0===l?void 0:l.layoutSections)||void 0===c||c.forEach(e=>{var t;null===(t=null==e?void 0:e.layoutColumns)||void 0===t||t.forEach(e=>{var t;null===(t=null==e?void 0:e.layoutItems)||void 0===t||t.forEach(e=>{e.field&&p.nbFields++})})}))})),yield C.forEach(d,e=>I(this,void 0,void 0,function*(){s.computeScore(e)})),null==i||i.log("Done"),d})}}class ze{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about PermissionSetLicenses in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, MasterLabel, CreatedDate, LastModifiedDate, TotalLicenses, Status, ExpirationDate, UsedLicenses, IsAvailableForIntegrations FROM PermissionSetLicense "},{string:"SELECT Id, LicenseId FROM PermissionSet WHERE IsOwnedByProfile = false AND LicenseId <> NULL "},{string:"SELECT AssigneeId, PermissionSet.LicenseId FROM PermissionSetAssignment WHERE Assignee.IsActive = TRUE AND PermissionSet.LicenseId <> NULL AND PermissionSet.IsOwnedByProfile = FALSE ORDER BY PermissionSetId "}],i),s=t.getInstance(T.SFDC_PermissionSetLicense),r=o[0],n=o[1],a=o[2];null==i||i.log(`Parsing ${null==r?void 0:r.length} permission sets licenses...`);const l=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.Id),o=s.create({properties:{id:i,name:t.MasterLabel,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,totalCount:t.TotalLicenses,usedCount:t.UsedLicenses,usedPercentage:0!==t.TotalLicenses?t.UsedLicenses/t.TotalLicenses:void 0,remainingCount:t.TotalLicenses-t.UsedLicenses,permissionSetIds:[],distinctActiveAssigneeCount:0,status:t.Status,expirationDate:t.ExpirationDate,isAvailableForIntegrations:t.IsAvailableForIntegrations,url:e.setupUrl(i,E.PERMISSION_SET_LICENSE)}});return[o.id,o]}));null==i||i.log(`Parsing ${null==a?void 0:a.length} Permission Sets with a link to a License...`);const d=new Map;return yield C.forEach(a,t=>I(this,void 0,void 0,function*(){if(t.PermissionSet&&t.PermissionSet.LicenseId&&t.PermissionSet.LicenseId.startsWith("0PL")){const i=e.caseSafeId(t.PermissionSet.LicenseId),o=e.caseSafeId(t.AssigneeId);!1===d.has(i)&&d.set(i,new Set),d.get(i).add(o);const s=l.get(i);s&&(s.distinctActiveAssigneeCount=d.get(i).size)}})),null==i||i.log(`Parsing ${null==n?void 0:n.length} Permission Sets with a link to a License...`),yield C.forEach(n,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.Id),o=e.caseSafeId(t.LicenseId),s=l.get(o);s&&s.permissionSetIds.push(i)})),null==i||i.log(`Computing the score for ${l.size} permission set licenses...`),yield C.forEach(l,e=>I(this,void 0,void 0,function*(){s.computeScore(e)})),null==i||i.log("Done"),l})}}class Ze{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about PermissionSet, PermissionSetAssignment and PermissionSet (with a PermissionSetGroupId populated) in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, Name, Description, IsCustom, License.Name, NamespacePrefix, Type, PermissionsApiEnabled, PermissionsViewSetup, PermissionsModifyAllData, PermissionsViewAllData, PermissionsManageUsers, PermissionsCustomizeApplication, CreatedDate, LastModifiedDate FROM PermissionSet WHERE IsOwnedByProfile = FALSE ORDER BY Id "},{byPasses:["INVALID_TYPE"],string:"SELECT Id, PermissionSetGroupId, PermissionSetGroup.Description FROM PermissionSet WHERE PermissionSetGroupId != null ORDER BY Id"},{string:"SELECT ParentId, COUNT(SobjectType) CountObject FROM ObjectPermissions WHERE Parent.IsOwnedByProfile = FALSE GROUP BY ParentId ",queryMoreField:"CreatedDate"},{string:"SELECT ParentId, COUNT(Field) CountField FROM FieldPermissions WHERE Parent.IsOwnedByProfile = FALSE GROUP BY ParentId ",queryMoreField:"SystemModstamp"},{string:"SELECT PermissionSetId, COUNT(Id) CountAssignment FROM PermissionSetAssignment WHERE PermissionSet.IsOwnedByProfile = FALSE AND Assignee.IsActive = TRUE GROUP BY PermissionSetId ",queryMoreField:"SystemModstamp"},{string:"SELECT PermissionSetGroupId, PermissionSetId FROM PermissionSetGroupComponent WHERE PermissionSet.IsOwnedByProfile = FALSE ORDER BY PermissionSetGroupId "}],i),s=o[0],r=o[1],n=o[2],a=o[3],l=o[4],d=o[5],c=t.getInstance(T.SFDC_PermissionSet);null==i||i.log(`Parsing ${null==s?void 0:s.length} permission sets...`);const u=new Map(yield C.map(s,t=>{const i=e.caseSafeId(t.Id),o="Group"===t.Type,s=c.create({properties:{id:i,name:t.Name,description:t.Description,license:t.License?t.License.Name:"",isCustom:t.IsCustom,package:t.NamespacePrefix||"",memberCounts:0,allIncludingGroupsAreEmpty:!1,permissionSetIds:[],permissionSetGroupIds:[],isGroup:o,type:o?"Permission Set Group":"Permission Set",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,nbFieldPermissions:0,nbObjectPermissions:0,importantPermissions:{apiEnabled:!0===t.PermissionsApiEnabled,viewSetup:!0===t.PermissionsViewSetup,modifyAllData:!0===t.PermissionsModifyAllData,viewAllData:!0===t.PermissionsViewAllData,manageUsers:!0===t.PermissionsManageUsers,customizeApplication:!0===t.PermissionsCustomizeApplication},isAdminLike:!0===t.PermissionsModifyAllData||!0===t.PermissionsViewAllData||!0===t.PermissionsManageUsers||!0===t.PermissionsCustomizeApplication,url:!1===o?e.setupUrl(i,E.PERMISSION_SET):""}});return[s.id,s]}));null==i||i.log(`Parsing ${null==r?void 0:r.length} permission set groups, ${null==n?void 0:n.length} object permissions and ${null==a?void 0:a.length} field permissions...`);const p=new Map;yield Promise.all([C.forEach(r,t=>I(this,void 0,void 0,function*(){var i,o;const s=e.caseSafeId(t.Id),r=e.caseSafeId(t.PermissionSetGroupId),n=u.get(s);n&&(n.isGroup=!0,n.groupId=r,n.description=null!==(o=null===(i=t.PermissionSetGroup)||void 0===i?void 0:i.Description)&&void 0!==o?o:"",n.url=e.setupUrl(r,E.PERMISSION_SET_GROUP),p.set(r,s))})),C.forEach(n,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.ParentId),o=u.get(i);o&&(o.nbObjectPermissions+=t.CountObject)})),C.forEach(a,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.ParentId),o=u.get(i);o&&(o.nbFieldPermissions+=t.CountField)})),C.forEach(l,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.PermissionSetId),o=u.get(i);o&&(o.memberCounts+=t.CountAssignment)}))]),null==i||i.log(`Checking the ${null==d?void 0:d.length} Permission Set assignments to Permission Set Groups...`);const g=new Map;return yield C.forEach(d,t=>I(this,void 0,void 0,function*(){var i;const o=e.caseSafeId(t.PermissionSetId),s=e.caseSafeId(t.PermissionSetGroupId),r=p.get(s),n=u.get(o),a=u.get(r);n&&a&&(n.permissionSetGroupIds.push(r),a.permissionSetIds.push(o),g.set(o,null!==(i=g.get(o))&&void 0!==i?i:0+a.memberCounts))})),null==i||i.log(`Computing the score for ${u.size} permission sets...`),yield C.forEach(u,e=>I(this,void 0,void 0,function*(){0===g.get(e.id)&&(e.allIncludingGroupsAreEmpty=!0),c.computeScore(e)})),null==i||i.log("Done"),u})}}class et{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Metadata API about ProfilePasswordPolicy...");const o=yield e.readMetadata([{type:"ProfilePasswordPolicy",members:["*"]}],i),s=(null==o?void 0:o.get("ProfilePasswordPolicy"))||[];if(!s)return new Map;const r=t.getInstance(T.SFDC_ProfilePasswordPolicy);null==i||i.log(`Parsing ${null==s?void 0:s.length} profile password policies...`);const n=new Map(yield C.map(s,e=>{const t=r.createWithScore({properties:{lockoutInterval:parseInt(e.lockoutInterval,10),maxLoginAttempts:parseInt(e.maxLoginAttempts,10),minimumPasswordLength:parseInt(e.minimumPasswordLength,10),minimumPasswordLifetime:"true"===e.minimumPasswordLifetime,obscure:"true"===e.obscure,passwordComplexity:parseInt(e.passwordComplexity,10),passwordExpiration:parseInt(e.passwordExpiration,10),passwordHistory:parseInt(e.passwordHistory,10),passwordQuestion:"0"===e.passwordQuestion,profileName:e.profile}});return[t.profileName,t]},e=>"string"==typeof e.profile&&""!==e.profile));return null==i||i.log("Done"),n})}}const tt=e=>null==e?void 0:e.split(".").reduce((e,t,i,o)=>e+Number(t)*Math.pow(255,(null==o?void 0:o.length)-1-i),0),it=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];class ot{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about Profile in the org...");const o=(yield e.soqlQuery([{string:"SELECT Id FROM Profile"}],i))[0];null==i||i.log(`Parsing ${null==o?void 0:o.length} Profiles...`);const s=yield C.map(o,e=>e.Id),r=t.getInstance(T.SFDC_ProfileRestrictions),n=t.getInstance(T.SFDC_ProfileIpRangeRestriction),a=t.getInstance(T.SFDC_ProfileLoginHourRestriction);null==i||i.log(`Calling Tooling API Composite to get more information about these ${null==s?void 0:s.length} profiles...`);const l=yield e.readMetadataAtScale("Profile",s,["UNKNOWN_EXCEPTION"],i);null==i||i.log(`Parsing ${null==l?void 0:l.length} profile restrictions...`);const d=new Map(yield C.map(l,t=>I(this,void 0,void 0,function*(){var i,o;const s=e.caseSafeId(t.Id);let l,d;l=t.Metadata.loginHours?yield C.map(it,e=>{const i=t.Metadata.loginHours[e+"Start"],o=t.Metadata.loginHours[e+"End"];return a.create({properties:{day:e,fromTime:("0"+Math.floor(i/60)).slice(-2)+":"+("0"+i%60).slice(-2),toTime:("0"+Math.floor(o/60)).slice(-2)+":"+("0"+o%60).slice(-2),difference:o-i}})}):[],d=null!==(o=null===(i=t.Metadata.loginIpRanges)||void 0===i?void 0:i.length)&&void 0!==o&&o?yield C.map(t.Metadata.loginIpRanges,e=>{const t=tt(e.startAddress),i=tt(e.endAddress);return n.create({properties:{startAddress:e.startAddress,endAddress:e.endAddress,description:e.description||"(empty)",difference:i-t+1}})}):[];const c=r.createWithScore({properties:{profileId:s,ipRanges:d,loginHours:l}});return[c.profileId,c]})));return null==i||i.log("Done"),d})}}class st{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about PermissionSet with IsOwnedByProfile=true in the org...");const o=yield e.soqlQuery([{string:"SELECT ProfileId, Profile.Name, Profile.Description, IsCustom, License.Name, NamespacePrefix, PermissionsApiEnabled, PermissionsViewSetup, PermissionsModifyAllData, PermissionsViewAllData, PermissionsManageUsers, PermissionsCustomizeApplication, CreatedDate, LastModifiedDate FROM PermissionSet WHERE isOwnedByProfile = TRUE ORDER BY ProfileId "},{string:"SELECT Parent.ProfileId, COUNT(SobjectType) CountObject FROM ObjectPermissions WHERE Parent.IsOwnedByProfile = TRUE GROUP BY Parent.ProfileId ",queryMoreField:"CreatedDate"},{string:"SELECT Parent.ProfileId, COUNT(Field) CountField FROM FieldPermissions WHERE Parent.IsOwnedByProfile = TRUE GROUP BY Parent.ProfileId ",queryMoreField:"SystemModstamp"},{string:"SELECT PermissionSet.ProfileId, COUNT(Id) CountAssignment FROM PermissionSetAssignment WHERE PermissionSet.IsOwnedByProfile = TRUE AND Assignee.IsActive = TRUE GROUP BY PermissionSet.ProfileId ",queryMoreField:"SystemModstamp"}],i),s=o[0],r=o[1],n=o[2],a=o[3],l=t.getInstance(T.SFDC_Profile);null==i||i.log(`Parsing ${null==s?void 0:s.length} profiles...`);const d=new Map(yield C.map(s,t=>{const i=e.caseSafeId(t.ProfileId),o=l.create({properties:{id:i,name:t.Profile.Name,description:t.Profile.Description,license:t.License?t.License.Name:"",isCustom:t.IsCustom,package:t.NamespacePrefix||"",memberCounts:0,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,nbFieldPermissions:0,nbObjectPermissions:0,type:"Profile",importantPermissions:{apiEnabled:!0===t.PermissionsApiEnabled,viewSetup:!0===t.PermissionsViewSetup,modifyAllData:!0===t.PermissionsModifyAllData,viewAllData:!0===t.PermissionsViewAllData,manageUsers:!0===t.PermissionsManageUsers,customizeApplication:!0===t.PermissionsCustomizeApplication},isAdminLike:!0===t.PermissionsModifyAllData||!0===t.PermissionsViewAllData||!0===t.PermissionsManageUsers||!0===t.PermissionsCustomizeApplication,url:e.setupUrl(i,E.PROFILE)}});return[o.id,o]}));return null==i||i.log(`Parsing ${null==r?void 0:r.length} object permissions, ${null==n?void 0:n.length} field permissions and ${null==a?void 0:a.length} assignments...`),yield Promise.all([C.forEach(r,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.ProfileId),o=d.get(i);o&&(o.nbObjectPermissions+=t.CountObject)})),C.forEach(n,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.ProfileId),o=d.get(i);o&&(o.nbFieldPermissions+=t.CountField)})),C.forEach(a,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.ProfileId),o=d.get(i);o&&(o.memberCounts+=t.CountAssignment)}))]),null==i||i.log(`Computing the score for ${d.size} profiles...`),yield C.forEach(d,e=>I(this,void 0,void 0,function*(){l.computeScore(e)})),null==i||i.log("Done"),d})}}class rt{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about Record Types and Profiles in the org...");const o=yield e.soqlQuery([{string:"SELECT DeveloperName, NamespacePrefix, Id, Name, SobjectType, IsActive FROM RecordType "},{string:"SELECT Id FROM Profile "}],i),s=t.getInstance(T.SFDC_RecordType),r=o[0],n=o[1];null==i||i.log(`Parsing ${null==r?void 0:r.length} record types...`);const a=new Map,l=new Map(yield C.map(r,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.Id),o=s.create({properties:{id:e.caseSafeId(i),name:t.Name,developerName:t.DeveloperName,package:t.NamespacePrefix||"",url:e.setupUrl(i,E.RECORD_TYPE,t.SobjectType),isActive:t.IsActive,objectId:t.SobjectType,isAvailable:!1,isDefault:!1}});return a.set(`${t.SobjectType}.${t.NamespacePrefix?t.NamespacePrefix+"__":""}${t.DeveloperName}`,i),[o.id,o]})));null==i||i.log(`Extracting Ids from ${null==n?void 0:n.length} profiles...`);const d=yield C.map(n,t=>e.caseSafeId(t.Id));null==i||i.log("Get record type information from Profile Metatdata API");const c=yield e.readMetadataAtScale("Profile",d,[],i);return null==i||i.log(`Parsing ${null==c?void 0:c.length} profiles looking for record types information...`),yield C.forEach(c,e=>I(this,void 0,void 0,function*(){var t,i;null===(i=null===(t=e.Metadata)||void 0===t?void 0:t.recordTypeVisibilities)||void 0===i||i.forEach(e=>{if(a.has(e.recordType)){const t=a.get(e.recordType),i=l.get(t);i&&(!1===i.isDefault&&!0===e.default&&(i.isDefault=!0),!1===i.isAvailable&&!0===e.visible&&(i.isAvailable=!0))}})})),yield C.forEach(l,e=>I(this,void 0,void 0,function*(){s.computeScore(e)})),null==i||i.log("Done"),l})}}class nt{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about reports in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, Description, DeveloperName, FolderName, Format, Name, NamespacePrefix, CreatedDate, LastModifiedDate, LastRunDate, LastViewedDate, LastReferencedDate FROM Report "}],i),s=t.getInstance(T.SFDC_Report),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} reports...`);const n=new Map(yield C.map(r,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.Id),o=s.createWithScore({properties:{id:i,name:t.Name,developerName:t.DeveloperName,description:t.Description,format:t.Format,folderName:t.FolderName,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,lastRunDate:t.LastRunDate,lastViewedDate:t.LastViewedDate,lastReferencedDate:t.LastReferencedDate,url:e.setupUrl(i,E.REPORT)}});return[o.id,o]})));return null==i||i.log("Done"),n})}}class at{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Rest API about StaticResource in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, Name, ContentType, CreatedDate, LastModifiedDate, Description, NamespacePrefix FROM StaticResource "}],i),s=t.getInstance(T.SFDC_StaticResource),r=o[0];null==i||i.log(`Retrieving dependencies of ${null==r?void 0:r.length} static resources...`);const n=yield e.dependenciesQuery(yield C.map(r,t=>e.caseSafeId(t.Id)),i);null==i||i.log(`Parsing ${null==r?void 0:r.length} static resources...`);const a=new Map(yield C.map(r,t=>I(this,void 0,void 0,function*(){const i=e.caseSafeId(t.Id),o=s.createWithScore({properties:{id:i,name:t.Name,description:t.Description,package:t.NamespacePrefix||"",contentType:t.ContentType,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(i,E.STATIC_RESOURCE)},dependencyData:n});return[o.id,o]})));return null==i||i.log("Done"),a})}}class lt{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about UserRole in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, DeveloperName, Name, ParentRoleId, (SELECT Id FROM Users WHERE IsActive = true AND ContactId = NULL AND Profile.Id != NULL) FROM UserRole WHERE PortalType = 'None' "}],i),s=t.getInstance(T.SFDC_UserRole),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} user roles...`);const n=new Map,a=[],l=new Map(yield C.map(r,t=>I(this,void 0,void 0,function*(){var i,o,r;const l=e.caseSafeId(t.Id),d=s.create({properties:{id:l,name:t.Name,apiname:t.DeveloperName,parentId:t.ParentRoleId?e.caseSafeId(t.ParentRoleId):void 0,hasParent:!!t.ParentRoleId,activeMembersCount:0,activeMemberIds:[],hasActiveMembers:!1,url:e.setupUrl(l,E.ROLE)}});return!1===d.hasParent?a.push(d):(!1===n.has(d.parentId)&&n.set(d.parentId,[]),n.get(d.parentId).push(d)),yield C.forEach(null===(i=null==t?void 0:t.Users)||void 0===i?void 0:i.records,t=>I(this,void 0,void 0,function*(){d.activeMemberIds.push(e.caseSafeId(t.Id))})),d.activeMembersCount=null===(o=d.activeMemberIds)||void 0===o?void 0:o.length,d.hasActiveMembers=(null===(r=d.activeMemberIds)||void 0===r?void 0:r.length)>0,[d.id,d]})));return yield C.forEach(a,e=>I(this,void 0,void 0,function*(){e.level=1,dt(e,n)})),yield C.forEach(l,e=>I(this,void 0,void 0,function*(){s.computeScore(e)})),null==i||i.log("Done"),l})}}const dt=(e,t)=>{const i=t.get(e.id);null==i||i.forEach(i=>{i.level=e.level+1,dt(i,t)})};class ct{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about Validaiton Rules in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, Active, Description, ErrorDisplayField, ErrorMessage, ValidationName, EntityDefinition.QualifiedApiName, NamespacePrefix, CreatedDate, LastModifiedDate FROM ValidationRule",tooling:!0}],i),s=t.getInstance(T.SFDC_ValidationRule),r=o[0];null==i||i.log(`Parsing ${null==r?void 0:r.length} validation rules...`);const n=new Map(yield C.map(r,t=>I(this,void 0,void 0,function*(){var i;const o=e.caseSafeId(t.Id),r=s.createWithScore({properties:{id:e.caseSafeId(o),name:t.ValidationName,isActive:t.Active,package:t.NamespacePrefix||"",description:t.Description,errorDisplayField:t.ErrorDisplayField,errorMessage:t.ErrorMessage,objectId:null===(i=t.EntityDefinition)||void 0===i?void 0:i.QualifiedApiName,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(o,E.VALIDATION_RULE)}});return[r.id,r]})));return null==i||i.log("Done"),n})}}class ut{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about ApexComponent in the org...");const o=yield e.soqlQuery([{tooling:!0,string:"SELECT Id, Name, ApiVersion, NamespacePrefix, Description, Markup, CreatedDate, LastModifiedDate FROM ApexComponent WHERE ManageableState IN ('installedEditable', 'unmanaged') "}],i),s=t.getInstance(T.SFDC_VisualForceComponent),r=o[0];null==i||i.log(`Retrieving dependencies of ${null==r?void 0:r.length} visualforce components...`);const n=yield e.dependenciesQuery(yield C.map(r,t=>e.caseSafeId(t.Id)),i);null==i||i.log(`Parsing ${null==r?void 0:r.length} visualforce components...`);const a=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.Id),o=s.create({properties:{id:i,name:t.Name,apiVersion:t.ApiVersion,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,url:e.setupUrl(i,E.VISUAL_FORCE_COMPONENT)},dependencyData:n});if(t.Markup){const e=p.RemoveCommentsFromCode(t.Markup);o.hardCodedURLs=p.FindHardCodedURLs(e),o.hardCodedIDs=p.FindHardCodedIDs(e)}return s.computeScore(o),[o.id,o]}));return null==i||i.log("Done"),a})}}class pt{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about ApexPage in the org...");const o=yield e.soqlQuery([{tooling:!0,string:"SELECT Id, Name, ApiVersion, NamespacePrefix, Description, IsAvailableInTouch, Markup, CreatedDate, LastModifiedDate FROM ApexPage WHERE ManageableState IN ('installedEditable', 'unmanaged')"}],i),s=t.getInstance(T.SFDC_VisualForcePage),r=o[0];null==i||i.log(`Retrieving dependencies of ${null==r?void 0:r.length} visualforce pages...`);const n=yield e.dependenciesQuery(yield C.map(r,t=>e.caseSafeId(t.Id)),i);null==i||i.log(`Parsing ${null==r?void 0:r.length} visualforce pages...`);const a=new Map(yield C.map(r,t=>{const i=e.caseSafeId(t.Id),o=s.create({properties:{id:i,name:t.Name,apiVersion:t.ApiVersion,isMobileReady:t.IsAvailableInTouch,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,url:e.setupUrl(i,E.VISUAL_FORCE_PAGE)},dependencyData:n});if(t.Markup){const e=p.RemoveCommentsFromCode(t.Markup);o.hardCodedURLs=p.FindHardCodedURLs(e),o.hardCodedIDs=p.FindHardCodedIDs(e)}return s.computeScore(o),[o.id,o]}));return null==i||i.log("Done"),a})}}class gt{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying REST API about WebLinks in the org...");const o=yield e.soqlQuery([{string:"SELECT Id, Name, Url, LinkType, OpenType, Description, CreatedDate, LastModifiedDate, NamespacePrefix, EntityDefinition.DurableId FROM WebLink WHERE ManageableState IN ('installedEditable', 'unmanaged') ",tooling:!0}],i),s=t.getInstance(T.SFDC_WebLink),r=o[0];null==i||i.log(`Retrieving dependencies of ${null==r?void 0:r.length} web links...`);const n=yield e.dependenciesQuery(yield C.map(r,t=>e.caseSafeId(t.Id)),i);null==i||i.log(`Parsing ${null==r?void 0:r.length} weblinks...`);const a=new Map(yield C.map(r,t=>I(this,void 0,void 0,function*(){var i;const o=e.caseSafeId(t.Id),r=s.createWithScore({properties:{id:o,name:t.Name,hardCodedURLs:p.FindHardCodedURLs(t.Url),hardCodedIDs:p.FindHardCodedIDs(t.Url),type:t.LinkType,behavior:t.OpenType,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,objectId:null===(i=t.EntityDefinition)||void 0===i?void 0:i.DurableId,url:e.setupUrl(t.Id,E.WEB_LINK,t.PageOrSobjectType)},dependencyData:n});return[r.id,r]})));return null==i||i.log("Done"),a})}}class ht{run(e,t,i){return I(this,void 0,void 0,function*(){null==i||i.log("Querying Tooling API about WorkflowRule in the org...");const o=(yield e.soqlQuery([{string:"SELECT Id FROM WorkflowRule",tooling:!0}],i))[0];null==i||i.log(`Parsing ${null==o?void 0:o.length} Workflow Rules...`);const s=yield C.map(o,e=>e.Id),r=t.getInstance(T.SFDC_Workflow);null==i||i.log(`Calling Tooling API Composite to get more information about these ${null==s?void 0:s.length} workflow rules...`);const n=yield e.readMetadataAtScale("WorkflowRule",s,["UNKNOWN_EXCEPTION"],i);null==i||i.log(`Parsing ${null==n?void 0:n.length} workflows...`);const a=new Map(yield C.map(n,t=>I(this,void 0,void 0,function*(){var i,o;const s=e.caseSafeId(t.Id),n=r.create({properties:{id:s,name:t.FullName,description:t.Metadata.description,isActive:t.Metadata.active,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,hasAction:!0,futureActions:[],emptyTimeTriggers:[],url:e.setupUrl(s,E.WORKFLOW_RULE)}}),a=t.Metadata.actions;n.actions=yield C.map(a,e=>({name:e.name,type:e.type}));const l=t.Metadata.workflowTimeTriggers;return yield C.forEach(l,e=>I(this,void 0,void 0,function*(){var t;const i=e.offsetFromField||"TriggerDate";0===(null===(t=e.actions)||void 0===t?void 0:t.length)?n.emptyTimeTriggers.push({field:i,delay:`${e.timeLength} ${e.workflowTimeTriggerUnit}`}):e.actions.forEach(t=>{n.futureActions.push({name:t.name,type:t.type,field:i,delay:`${e.timeLength} ${e.workflowTimeTriggerUnit}`})})})),n.hasAction=(null===(i=n.actions)||void 0===i?void 0:i.length)+(null===(o=n.futureActions)||void 0===o?void 0:o.length)>0,r.computeScore(n),[n.id,n]})));return null==i||i.log("Done"),a})}}class mt{constructor(e,t,i){this._sfdcManager=e,this._logger=i,this._dataCache=t,this._datasets=new Map,this._datasetPromisesCache=new Map,this._dataFactory=new re,this._datasets.set(S.APEXCLASSES,new ae),this._datasets.set(S.APEXTRIGGERS,new le),this._datasets.set(S.APPLICATIONS,new de),this._datasets.set(S.APPPERMISSIONS,new ce),this._datasets.set(S.BROWSERS,new ue),this._datasets.set(S.CURRENTUSERPERMISSIONS,new ge),this._datasets.set(S.CUSTOMFIELDS,new me),this._datasets.set(S.CUSTOMLABELS,new fe),this._datasets.set(S.CUSTOMTABS,new Se),this._datasets.set(S.COLLABORATIONGROUPS,new pe),this._datasets.set(S.DASHBOARDS,new ve),this._datasets.set(S.DOCUMENTS,new Ee),this._datasets.set(S.EMAILTEMPLATES,new Ie),this._datasets.set(S.FIELDPERMISSIONS,new Ce),this._datasets.set(S.FLOWS,new Re),this._datasets.set(S.PUBLICGROUPSANDQUEUES,new Ae),this._datasets.set(S.HOMEPAGECOMPONENTS,new Te),this._datasets.set(S.KNOWLEDGEARTICLES,new we),this._datasets.set(S.LIGHTNINGAURACOMPONENTS,new _e),this._datasets.set(S.LIGHTNINGPAGES,new Le),this._datasets.set(S.LIGHTNINGWEBCOMPONENTS,new Oe),this._datasets.set(S.OBJECT,new be),this._datasets.set(S.OBJECTPERMISSIONS,new Me),this._datasets.set(S.OBJECTS,new Fe),this._datasets.set(S.OBJECTTYPES,new je),this._datasets.set(S.ORGANIZATION,new Ye),this._datasets.set(S.PACKAGES,new Ke),this._datasets.set(S.PAGELAYOUTS,new Xe),this._datasets.set(S.PERMISSIONSETS,new Ze),this._datasets.set(S.PERMISSIONSETLICENSES,new ze),this._datasets.set(S.PROFILEPWDPOLICIES,new et),this._datasets.set(S.PROFILERESTRICTIONS,new ot),this._datasets.set(S.PROFILES,new st),this._datasets.set(S.RECORDTYPES,new rt),this._datasets.set(S.REPORTS,new nt),this._datasets.set(S.STATICRESOURCES,new at),this._datasets.set(S.USERROLES,new lt),this._datasets.set(S.INTERNALACTIVEUSERS,new De),this._datasets.set(S.VALIDATIONRULES,new ct),this._datasets.set(S.VISUALFORCECOMPONENTS,new ut),this._datasets.set(S.VISUALFORCEPAGES,new pt),this._datasets.set(S.WEBLINKS,new gt),this._datasets.set(S.WORKFLOWS,new ht)}run(e){return I(this,void 0,void 0,function*(){if(e instanceof Array==!1)throw new TypeError("The given datasets is not an instance of Array.");const t=yield Promise.all(e.map(e=>{const t="string"==typeof e?e:e.alias,i="string"==typeof e?e:e.cacheKey,o="string"==typeof e?void 0:e.parameters,s=`Run dataset "${t}"`;return!1===this._datasetPromisesCache.has(i)&&this._datasetPromisesCache.set(i,new Promise((e,r)=>{var n,a;this._logger.log(s,`Checking the data cache for key=${i}...`);const l=this._dataCache.get(i);l?(this._logger.ended(s,"There was data in data cache, we use it!"),e([t,l])):(this._logger.log(s,"There was no data in data cache. Let's retrieve data."),null===(n=this._datasets.get(t))||void 0===n||n.run(this._sfdcManager,this._dataFactory,null===(a=this._logger)||void 0===a?void 0:a.toSimpleLogger(s),o).then(o=>{this._dataCache.set(i,o),this._logger.ended(s,`Data retrieved and saved in cache with key=${i}`),e([t,o])}).catch(e=>{this._logger.failed(s,e),r({dataset:t,cause:e})}))})),this._datasetPromisesCache.get(i)}));return new Map(t)})}clean(e){if(e instanceof Array==!1)throw new TypeError("The given datasets is not an instance of Array.");e.forEach(e=>{const t="string"==typeof e?e:e.cacheKey;this._dataCache.remove(t),this._datasetPromisesCache.delete(t)})}}class ft{constructor(e){this._enabledFailed=!0,this._logger=e}isConsoleFallback(){var e;return null===(e=this._logger)||void 0===e?void 0:e.isConsoleFallback()}log(e,t){var i,o;(null===(i=this._logger)||void 0===i?void 0:i.isConsoleFallback())&&St(e,"LOG",t),null===(o=this._logger)||void 0===o||o.log(e,t)}ended(e,t){var i,o;(null===(i=this._logger)||void 0===i?void 0:i.isConsoleFallback())&&St(e,"ENDED",t),null===(o=this._logger)||void 0===o||o.ended(e,t)}failed(e,t){var i,o;!0===this._enabledFailed&&((null===(i=this._logger)||void 0===i?void 0:i.isConsoleFallback())&&St(e,"FAILED",t),null===(o=this._logger)||void 0===o||o.failed(e,t))}enableFailed(e=!0){this._enabledFailed=!0===e}toSimpleLogger(e){return{log:t=>{var i,o,s;(null===(o=null===(i=this._logger)||void 0===i?void 0:i.isConsoleFallback())||void 0===o||o)&&St(e,"LOG",t),null===(s=this._logger)||void 0===s||s.log(e,t)},debug:t=>{var i,o;(null===(o=null===(i=this._logger)||void 0===i?void 0:i.isConsoleFallback())||void 0===o||o)&&St(e,"DEBUG",t)}}}}const St=(e,t,i="...")=>{console.log(`${(new Date).toISOString()} - ${e} - ${t} - ${i}`)};class vt{constructor(){this.hadError=!1,this.lastErrorMessage="",this.countAll=0,this.countBad=0,this.countBadByRule=[],this.data=[]}get countGood(){return this.countAll-this.countBad}}const Et=e=>!1===e.isTest&&!1===e.needsRecompilation,It=e=>!0===e.isTest&&!1===e.needsRecompilation,Ct=e=>!0===e.needsRecompilation,yt="tests",Pt="uncompiled",Rt="regular";class At{constructor(e){switch(e){case yt:this._filterFunction=It;break;case Pt:this._filterFunction=Ct;break;default:this._filterFunction=Et}}extract(e){return[S.APEXCLASSES]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.APEXCLASSES),o=Y.getPackageName(i);if(!t)throw new Error("RecipeApexClasses: Data from dataset alias 'APEXCLASSES' was undefined.");const s=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){const i=yield Promise.all([C.map(e.relatedTestClassIds,e=>t.get(e)),C.map(e.relatedClassIds,e=>t.get(e))]);e.relatedTestClassRefs=i[0],e.relatedClassRefs=i[1],o!==Y.ALL_VALUES&&e.package!==o||!this._filterFunction(e)||s.push(e)})),s})}}class Tt extends At{constructor(){super(Rt)}}class Dt extends At{constructor(){super(yt)}}class wt extends At{constructor(){super(Pt)}}class _t{extract(e){return[S.APEXTRIGGERS,S.OBJECTS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.APEXTRIGGERS),o=e.get(S.OBJECTS),s=Y.getPackageName(i);if(!t)throw new Error("RecipeApexTriggers: Data from dataset alias 'APEXTRIGGERS' was undefined.");if(!o)throw new Error("RecipeApexTriggers: Data from dataset alias 'OBJECTS' was undefined.");const r=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){const t=o.get(e.objectId);t&&(e.objectRef=t),s!==Y.ALL_VALUES&&e.package!==s||r.push(e)})),r})}}class Lt{extract(e){return[S.APPLICATIONS,S.APPPERMISSIONS,S.PROFILES,S.PERMISSIONSETS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.APPLICATIONS),o=e.get(S.APPPERMISSIONS),s=e.get(S.PROFILES),r=e.get(S.PERMISSIONSETS),n=Y.getPackageName(i);if(!t)throw new Error("RecipeAppPermissions: Data from dataset alias 'APPLICATIONS' was undefined.");if(!o)throw new Error("RecipeAppPermissions: Data from dataset alias 'APPPERMISSIONS' was undefined.");if(!s)throw new Error("RecipeAppPermissions :Data from dataset alias 'PROFILES' was undefined.");if(!r)throw new Error("RecipeAppPermissions: Data from dataset alias 'PERMISSIONSETS' was undefined.");const a=h.create();return yield C.forEach(o,e=>I(this,void 0,void 0,function*(){var i,o;const l=t.get(e.appId);l&&(e.appRef=l);const d=(!0===e.parentId.startsWith("0PS")?r:s).get(e.parentId);d&&(e.parentRef=d),void 0!==l&&void 0!==d&&(n!==Y.ALL_VALUES&&(null===(i=e.parentRef)||void 0===i?void 0:i.package)!==n&&(null===(o=e.appRef)||void 0===o?void 0:o.package)!==n||(!1===a.hasRowHeader(e.parentId)&&a.setRowHeader(e.parentId,e.parentRef),!1===a.hasColumnHeader(e.appId)&&a.setColumnHeader(e.appId,e.appRef),a.addValueToProperty(e.parentId,e.appId,(e.isAccessible?"A":"")+(e.isVisible?"V":""))))})),a.toDataMatrix()})}}class Ot{extract(e){return[S.BROWSERS]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.BROWSERS);if(!t)throw new Error("RecipeBrowsers: Data from dataset alias 'BROWSERS' was undefined.");return[...t.values()]})}}class bt{extract(e){return[S.COLLABORATIONGROUPS]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.COLLABORATIONGROUPS);if(!t)throw new Error("RecipeCollaborationGroups: Data from dataset alias 'COLLABORATIONGROUPS' was undefined.");return[...t.values()]})}}class Mt{extract(e,t){return[new f(S.CURRENTUSERPERMISSIONS,S.CURRENTUSERPERMISSIONS,t)]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.CURRENTUSERPERMISSIONS);if(!t)throw new Error("RecipeCurrentUserPermissions: Data from dataset alias 'CURRENTUSERPERMISSIONS' was undefined.");return t})}}class Ft{extract(e){return[S.CUSTOMFIELDS,S.OBJECTTYPES,S.OBJECTS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const o=e.get(S.OBJECTTYPES),s=e.get(S.OBJECTS),r=e.get(S.CUSTOMFIELDS),n=Y.getPackageName(i),a=Y.getSObjectTypeName(i),l=Y.getSObjectName(i);if(!o)throw new Error("RecipeCustomFields: Data from dataset alias 'OBJECTTYPES' was undefined.");if(!s)throw new Error("RecipeCustomFields: Data from dataset alias 'OBJECTS' was undefined.");if(!r)throw new Error("RecipeCustomFields: Data from dataset alias 'CUSTOMFIELDS' was undefined.");const d=[];return yield C.forEach(r,e=>I(this,void 0,void 0,function*(){var t,i,r;const c=s.get(e.objectId);if(c){if(void 0===c.typeRef){const e=o.get(c.typeId);e&&(c.typeRef=e)}e.objectRef=c}n!==Y.ALL_VALUES&&e.package!==n||a!==Y.ALL_VALUES&&(null===(i=null===(t=e.objectRef)||void 0===t?void 0:t.typeRef)||void 0===i?void 0:i.id)!==a||l!==Y.ALL_VALUES&&(null===(r=e.objectRef)||void 0===r?void 0:r.apiname)!==l||d.push(e)})),null==t||t.log("Done transforming custom fields!"),d})}}class Nt{extract(e){return[S.CUSTOMLABELS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.CUSTOMLABELS),o=Y.getPackageName(i);if(!t)throw new Error("RecipeCustomLabels: Data from dataset alias 'CUSTOMLABELS' was undefined.");const s=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){o!==Y.ALL_VALUES&&e.package!==o||s.push(e)})),s})}}class Ut{extract(e){return[S.CUSTOMTABS]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.CUSTOMTABS);if(!t)throw new Error("RecipeCustomTabs: Data from dataset alias 'CUSTOMTABS' was undefined.");return[...t.values()]})}}class xt{extract(e){return[S.INTERNALACTIVEUSERS,S.DASHBOARDS]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.DASHBOARDS),i=e.get(S.INTERNALACTIVEUSERS);if(!t)throw new Error("RecipeDashboards: Data from dataset alias 'DASHBOARDS' was undefined.");if(!i)throw new Error("RecipeDashboards: Data from dataset alias 'INTERNALACTIVEUSERS' was undefined.");return[...t.values()]})}}class Gt{extract(e){return[S.DOCUMENTS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.DOCUMENTS),o=Y.getPackageName(i);if(!t)throw new Error("RecipeDocuments: Data from dataset alias 'DOCUMENTS' was undefined.");const s=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){o!==Y.ALL_VALUES&&e.package!==o||s.push(e)})),s})}}class Vt{extract(e){return[S.EMAILTEMPLATES]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.EMAILTEMPLATES),o=Y.getPackageName(i);if(!t)throw new Error("RecipeDocuments: Data from dataset alias 'EMAILTEMPLATES' was undefined.");const s=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){o!==Y.ALL_VALUES&&e.package!==o||s.push(e)})),s})}}class Bt{extract(e,t){return[new f(S.FIELDPERMISSIONS,`${S.FIELDPERMISSIONS}_${Y.getSObjectName(t)}`,t),S.PROFILES,S.PERMISSIONSETS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.FIELDPERMISSIONS),o=e.get(S.PROFILES),s=e.get(S.PERMISSIONSETS),r=Y.getPackageName(i);if(!t)throw new Error("RecipeFieldPermissions: Data from dataset alias 'FIELDPERMISSIONS' was undefined.");if(!o)throw new Error("RecipeFieldPermissions: Data from dataset alias 'PROFILES' was undefined.");if(!s)throw new Error("RecipeFieldPermissions: Data from dataset alias 'PERMISSIONSETS' was undefined.");const n=h.create();return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){const t=(!0===e.parentId.startsWith("0PS")?s:o).get(e.parentId);t&&(e.parentRef=t),void 0!==t&&(r!==Y.ALL_VALUES&&e.parentRef.package!==r||(!1===n.hasRowHeader(e.parentId)&&n.setRowHeader(e.parentId,e.parentRef),n.addValueToProperty(e.parentId,e.fieldApiName,(e.isRead?"R":"")+(e.isEdit?"U":""))))})),n.toDataMatrix()})}}class $t{extract(e){return[S.FLOWS]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.FLOWS);if(!t)throw new Error("RecipeFlows: Data from dataset alias 'FLOWS' was undefined.");const i=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){!1===e.isProcessBuilder&&i.push(e)})),i})}}class Wt{extract(e){return[v.APEX_CLASSES,v.APEX_TESTS,v.APEX_TRIGGERS,v.APEX_UNCOMPILED,v.BROWSERS,v.COLLABORATION_GROUPS,v.CUSTOM_FIELDS,v.CUSTOM_LABELS,v.CUSTOM_TABS,v.DASHBOARDS,v.DOCUMENTS,v.EMAIL_TEMPLATES,v.FLOWS,v.HOME_PAGE_COMPONENTS,v.INTERNAL_ACTIVE_USERS,v.KNOWLEDGE_ARTICLES,v.LIGHTNING_AURA_COMPONENTS,v.LIGHTNING_PAGES,v.LIGHTNING_WEB_COMPONENTS,v.OBJECTS,v.PAGE_LAYOUTS,v.PERMISSION_SETS,v.PERMISSION_SET_LICENSES,v.PROCESS_BUILDERS,v.PROFILE_PWD_POLICIES,v.PROFILE_RESTRICTIONS,v.PROFILES,v.PUBLIC_GROUPS,v.QUEUES,v.RECORD_TYPES,v.REPORTS,v.STATIC_RESOURCES,v.USER_ROLES,v.VALIDATION_RULES,v.VISUALFORCE_COMPONENTS,v.VISUALFORCE_PAGES,v.WEBLINKS,v.WORKFLOWS]}filterByScoreRuleIds(e){return[]}}class kt{extract(e){return[v.APEX_CLASSES,v.APEX_TRIGGERS,v.COLLABORATION_GROUPS,v.CUSTOM_FIELDS,v.CUSTOM_TABS,v.DOCUMENTS,v.EMAIL_TEMPLATES,v.HOME_PAGE_COMPONENTS,v.VALIDATION_RULES,v.VISUALFORCE_COMPONENTS,v.VISUALFORCE_PAGES,v.WEBLINKS]}filterByScoreRuleIds(e){return $.GetScoreRulesForHardCodedURLs()}}class jt{extract(e){return[S.HOMEPAGECOMPONENTS]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.HOMEPAGECOMPONENTS);if(!t)throw new Error("RecipeHomePageComponents: Data from dataset alias 'HOMEPAGECOMPONENTS' was undefined.");return[...t.values()]})}}class Ht{extract(e){return[S.INTERNALACTIVEUSERS,S.PROFILES,S.PERMISSIONSETS]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.INTERNALACTIVEUSERS),i=e.get(S.PROFILES),o=e.get(S.PERMISSIONSETS);if(!t)throw new Error("RecipeActiveUsers: Data from dataset alias 'INTERNALACTIVEUSERS' was undefined.");if(!i)throw new Error("RecipeActiveUsers: Data from dataset alias 'PROFILES' was undefined.");if(!o)throw new Error("RecipeActiveUsers: Data from dataset alias 'PERMISSIONSETS' was undefined.");return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){var t,s,r,n,a,l,d;const c=i.get(e.profileId);c&&(e.profileRef=c),e.permissionSetRefs=yield C.map(e.permissionSetIds,e=>o.get(e),e=>o.has(e)),e.importantPermissionsGrantedBy={apiEnabled:[],viewSetup:[],modifyAllData:[],viewAllData:[],manageUsers:[],customizeApplication:[]},(null===(t=e.profileRef)||void 0===t?void 0:t.importantPermissions)&&Object.keys(e.profileRef.importantPermissions).filter(t=>!0===e.profileRef.importantPermissions[t]).forEach(t=>e.importantPermissionsGrantedBy[t].push(e.profileRef)),yield C.forEach(e.permissionSetRefs,t=>I(this,void 0,void 0,function*(){Object.keys(t.importantPermissions).filter(e=>!0===t.importantPermissions[e]).forEach(i=>e.importantPermissionsGrantedBy[i].push(t))})),e.importantPermissions={apiEnabled:(null===(s=e.importantPermissionsGrantedBy.apiEnabled)||void 0===s?void 0:s.length)>0,viewSetup:(null===(r=e.importantPermissionsGrantedBy.viewSetup)||void 0===r?void 0:r.length)>0,modifyAllData:(null===(n=e.importantPermissionsGrantedBy.modifyAllData)||void 0===n?void 0:n.length)>0,viewAllData:(null===(a=e.importantPermissionsGrantedBy.viewAllData)||void 0===a?void 0:a.length)>0,manageUsers:(null===(l=e.importantPermissionsGrantedBy.manageUsers)||void 0===l?void 0:l.length)>0,customizeApplication:(null===(d=e.importantPermissionsGrantedBy.customizeApplication)||void 0===d?void 0:d.length)>0}})),[...t.values()]})}}class Qt{extract(e){return[S.KNOWLEDGEARTICLES]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.KNOWLEDGEARTICLES);if(!t)throw new Error("RecipeDocuments: Data from dataset alias 'KNOWLEDGEARTICLES' was undefined.");return[...t.values()]})}}class qt{extract(e){return[S.LIGHTNINGAURACOMPONENTS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.LIGHTNINGAURACOMPONENTS),o=Y.getPackageName(i);if(!t)throw new Error("RecipeLightningAuraComponents: Data from dataset alias 'LIGHTNINGAURACOMPONENTS' was undefined.");const s=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){o!==Y.ALL_VALUES&&e.package!==o||s.push(e)})),s})}}class Jt{extract(e){return[S.LIGHTNINGPAGES,S.OBJECTS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.LIGHTNINGPAGES),o=e.get(S.OBJECTS),s=Y.getPackageName(i);if(!t)throw new Error("RecipeLightningPages: Data from dataset alias 'LIGHTNINGPAGES' was undefined.");if(!o)throw new Error("RecipeLightningPages: Data from dataset alias 'OBJECTS' was undefined.");const r=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){if(e.objectId){const t=o.get(e.objectId);t&&(e.objectRef=t)}s!==Y.ALL_VALUES&&e.package!==s||r.push(e)})),r})}}class Yt{extract(e){return[S.LIGHTNINGWEBCOMPONENTS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.LIGHTNINGWEBCOMPONENTS),o=Y.getPackageName(i);if(!t)throw new Error("RecipeLightningWebComponents: Data from dataset alias 'LIGHTNINGWEBCOMPONENTS' was undefined.");const s=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){o!==Y.ALL_VALUES&&e.package!==o||s.push(e)})),s})}}class Kt{extract(e,t){return[new f(S.OBJECT,`${S.OBJECT}_${Y.getSObjectName(t)}`,t),S.OBJECTTYPES,S.APEXTRIGGERS,S.WORKFLOWS,S.LIGHTNINGPAGES,new f(S.CUSTOMFIELDS,`${S.CUSTOMFIELDS}_${Y.getSObjectName(t)}`,t)]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.OBJECTTYPES),i=e.get(S.OBJECT),o=e.get(S.APEXTRIGGERS),s=e.get(S.WORKFLOWS),r=e.get(S.LIGHTNINGPAGES),n=e.get(S.CUSTOMFIELDS);if(!t)throw new Error("RecipeObject: Data from dataset alias 'OBJECTTYPES' was undefined.");if(!i)throw new Error("RecipeObject: Data from dataset alias 'OBJECT' was undefined.");if(!o)throw new Error("RecipeObject: Data from dataset alias 'APEXTRIGGERS' was undefined.");if(!s)throw new Error("RecipeObject: Data from dataset alias 'WORKFLOWS' was undefined.");if(!r)throw new Error("RecipeObject: Data from dataset alias 'LIGHTNINGPAGES' was undefined.");if(!n)throw new Error("RecipeObject: Data from dataset alias 'CUSTOMFIELDS' was undefined.");const a=t.get(i.typeId);a&&(i.typeRef=a),i.flexiPages=[];const l=yield Promise.all([C.map(i.apexTriggerIds,e=>{const t=o.get(e);if(!t)throw new Error(`Apex Trigger ${e} was not found for object ${i.name}`);return t.objectRef=i,t},e=>o.has(e)),C.map(i.workflowRuleIds,e=>s.get(e),e=>s.has(e)),C.forEach(r,e=>I(this,void 0,void 0,function*(){e.objectId===i.id&&i.flexiPages.push(e)})),C.map(i.customFieldIds,e=>{const t=n.get(e);if(!t)throw new Error(`Custom Field ${e} was not found for object ${i.name}`);return t.objectRef=i,t},e=>n.has(e))]);return i.apexTriggerRefs=l[0],i.workflowRuleRefs=l[1],i.customFieldRefs=l[3],i})}}class Xt{extract(e){return[S.OBJECTPERMISSIONS,S.PROFILES,S.PERMISSIONSETS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.OBJECTPERMISSIONS),o=e.get(S.PROFILES),s=e.get(S.PERMISSIONSETS),r=Y.getPackageName(i);if(!t)throw new Error("RecipeObjectPermissions: Data from dataset alias 'OBJECTPERMISSIONS' was undefined.");if(!o)throw new Error("RecipeObjectPermissions: Data from dataset alias 'PROFILES' was undefined.");if(!s)throw new Error("RecipeObjectPermissions: Data from dataset alias 'PERMISSIONSETS' was undefined.");const n=h.create();return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){const t=(!0===e.parentId.startsWith("0PS")?s:o).get(e.parentId);t&&(e.parentRef=t),void 0!==t&&(r!==Y.ALL_VALUES&&e.parentRef.package!==r||(!1===n.hasRowHeader(e.parentId)&&n.setRowHeader(e.parentId,e.parentRef),n.addValueToProperty(e.parentId,e.objectType,(e.isCreate?"C":"")+(e.isRead?"R":"")+(e.isEdit?"U":"")+(e.isDelete?"D":"")+(e.isViewAll?"v":"")+(e.isModifyAll?"m":""))))})),n.toDataMatrix()})}}class zt{extract(e){return[S.OBJECTTYPES,S.OBJECTS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.OBJECTTYPES),o=e.get(S.OBJECTS),s=Y.getPackageName(i),r=Y.getSObjectTypeName(i);if(!t)throw new Error("RecipeObjects: Data from dataset alias 'OBJECTTYPES' was undefined.");if(!o)throw new Error("RecipeObjects: Data from dataset alias 'OBJECTS' was undefined.");const n=[];return yield C.forEach(o,e=>I(this,void 0,void 0,function*(){var i;const o=t.get(e.typeId);o&&(e.typeRef=o),s!==Y.ALL_VALUES&&e.package!==s||r!==Y.ALL_VALUES&&(null===(i=e.typeRef)||void 0===i?void 0:i.id)!==r||n.push(e)})),n.sort((e,t)=>e.label<t.label?-1:1)})}}class Zt{extract(e){return[S.OBJECTTYPES]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.OBJECTTYPES);if(!t)throw new Error("RecipeObjectTypes: Data from dataset alias 'OBJECTTYPES' was undefined.");return[...t.values()]})}}class ei{extract(e){return[S.ORGANIZATION]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.ORGANIZATION);if(!t)throw new Error("RecipeOrganization: Data from dataset alias 'ORGANIZATION' was undefined.");return t})}}class ti{extract(e){return[S.PACKAGES]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.PACKAGES);if(!t)throw new Error("RecipePackages: Data from dataset alias 'PACKAGES' was undefined.");return[...t.values()]})}}class ii{extract(e){return[S.PAGELAYOUTS,S.OBJECTTYPES,S.OBJECTS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.PAGELAYOUTS),o=e.get(S.OBJECTTYPES),s=e.get(S.OBJECTS),r=Y.getPackageName(i),n=Y.getSObjectTypeName(i),a=Y.getSObjectName(i);if(!o)throw new Error("RecipePageLayouts: Data from dataset alias 'OBJECTTYPES' was undefined.");if(!s)throw new Error("RecipePageLayouts: Data from dataset alias 'OBJECTS' was undefined.");if(!t)throw new Error("RecipePageLayouts: Data from dataset alias 'PAGELAYOUTS' was undefined.");const l=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){var t,i,d;const c=s.get(e.objectId);if(c){if(void 0===c.typeRef){const e=o.get(c.typeId);e&&(c.typeRef=e)}e.objectRef=c}r!==Y.ALL_VALUES&&e.package!==r||n!==Y.ALL_VALUES&&(null===(i=null===(t=e.objectRef)||void 0===t?void 0:t.typeRef)||void 0===i?void 0:i.id)!==n||a!==Y.ALL_VALUES&&(null===(d=e.objectRef)||void 0===d?void 0:d.apiname)!==a||l.push(e)})),l})}}class oi{extract(e){return[S.PERMISSIONSETLICENSES,S.PERMISSIONSETS]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.PERMISSIONSETLICENSES),i=e.get(S.PERMISSIONSETS);if(!t)throw new Error("RecipePermissionSetLicenses: Data from dataset alias 'PERMISSIONSETLICENSES' was undefined.");if(!i)throw new Error("RecipePermissionSetLicenses: Data from dataset alias 'PERMISSIONSETS' was undefined.");return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){e.permissionSetRefs=yield C.map(e.permissionSetIds,e=>i.get(e),e=>i.has(e))})),[...t.values()]})}}class si{extract(e){return[S.PERMISSIONSETS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.PERMISSIONSETS),o=Y.getPackageName(i);if(!t)throw new Error("RecipePermissionSets: Data from dataset alias 'PERMISSIONSETS' was undefined.");const s=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){const i=yield Promise.all([C.map(e.permissionSetIds,e=>t.get(e)),C.map(e.permissionSetGroupIds,e=>t.get(e))]);e.permissionSetRefs=i[0],e.permissionSetGroupRefs=i[1],o!==Y.ALL_VALUES&&e.package!==o||s.push(e)})),s})}}class ri{extract(e){return[S.FLOWS]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.FLOWS);if(!t)throw new Error("RecipeProcessBuilders: Data from dataset alias 'FLOWS' was undefined.");const i=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){!0===e.isProcessBuilder&&i.push(e)})),i})}}class ni{extract(e){return[S.PROFILEPWDPOLICIES]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.PROFILEPWDPOLICIES);if(!t)throw new Error("RecipeProfilePasswordPolicies: Data from dataset alias 'PROFILEPWDPOLICIES' was undefined.");return[...t.values()]})}}class ai{extract(e){return[S.PROFILES,S.PROFILERESTRICTIONS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.PROFILES),o=e.get(S.PROFILERESTRICTIONS),s=Y.getPackageName(i);if(!t)throw new Error("RecipeProfileRestrictions: Data from dataset alias 'PROFILES' was undefined.");if(!o)throw new Error("RecipeProfileRestrictions: Data from dataset alias 'PROFILERESTRICTIONS' was undefined.");const r=[];return yield C.forEach(o,e=>I(this,void 0,void 0,function*(){var i;const o=t.get(e.profileId);o&&(e.profileRef=o),s!==Y.ALL_VALUES&&(null===(i=e.profileRef)||void 0===i?void 0:i.package)!==s||r.push(e)})),r})}}class li{extract(e){return[S.PROFILES]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.PROFILES),o=Y.getPackageName(i);if(!t)throw new Error("RecipeProfiles: Data from dataset alias 'PROFILES' was undefined.");const s=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){o!==Y.ALL_VALUES&&e.package!==o||s.push(e)})),s})}}const di=e=>!0===e.isQueue,ci=e=>!0===e.isPublicGroup,ui="queue",pi="publicgroup";class gi{constructor(e){if(e===ui)this._filterFunction=di;else this._filterFunction=ci}extract(e){return[S.INTERNALACTIVEUSERS,S.PUBLICGROUPSANDQUEUES]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.PUBLICGROUPSANDQUEUES),i=e.get(S.INTERNALACTIVEUSERS);if(!t)throw new Error("RecipePublicGroups: Data from dataset alias 'PUBLICGROUPSANDQUEUES' was undefined.");if(!i)throw new Error("RecipePublicGroups: Data from dataset alias 'INTERNALACTIVEUSERS' was undefined.");const o=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){e.directUserRefs=yield C.map(e.directUserIds,e=>i.get(e),e=>i.has(e)),e.directGroupRefs=yield C.map(e.directGroupIds,e=>t.get(e),e=>t.has(e)),!0===this._filterFunction(e)&&o.push(e)})),o})}}class hi extends gi{constructor(){super(ui)}}class mi extends gi{constructor(){super(pi)}}class fi{extract(e){return[S.RECORDTYPES,S.OBJECTTYPES,S.OBJECTS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const o=e.get(S.RECORDTYPES),s=e.get(S.OBJECTTYPES),r=e.get(S.OBJECTS),n=Y.getPackageName(i),a=Y.getSObjectTypeName(i),l=Y.getSObjectName(i);if(!o)throw new Error("RecipeRecordTypes: Data from dataset alias 'RECORDTYPES' was undefined.");if(!s)throw new Error("RecipeRecordTypes: Data from dataset alias 'OBJECTTYPES' was undefined.");if(!r)throw new Error("RecipeRecordTypes: Data from dataset alias 'OBJECTS' was undefined.");const d=[];return yield C.forEach(o,e=>I(this,void 0,void 0,function*(){var i,o,c;const u=r.get(e.objectId);if(u){if(void 0===u.typeRef){const e=s.get(u.typeId);e&&(u.typeRef=e)}e.objectRef=u}n!==Y.ALL_VALUES&&e.package!==n||a!==Y.ALL_VALUES&&(null===(o=null===(i=e.objectRef)||void 0===i?void 0:i.typeRef)||void 0===o?void 0:o.id)!==a||l!==Y.ALL_VALUES&&(null===(c=e.objectRef)||void 0===c?void 0:c.apiname)!==l||(d.push(e),t.log(`Pushing a record type in the array: ${e}`))})),t.log(`Array has ${null==d?void 0:d.length} items.`),d})}}class Si{extract(e){return[S.INTERNALACTIVEUSERS,S.REPORTS]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.REPORTS),i=e.get(S.INTERNALACTIVEUSERS);if(!t)throw new Error("RecipeReports: Data from dataset alias 'REPORTS' was undefined.");if(!i)throw new Error("RecipeReports: Data from dataset alias 'INTERNALACTIVEUSERS' was undefined.");return[...t.values()]})}}class vi{extract(e){return[S.STATICRESOURCES]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.STATICRESOURCES),o=Y.getPackageName(i);if(!t)throw new Error("RecipeStaticResources: Data from dataset alias 'STATICRESOURCES' was undefined.");const s=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){o!==Y.ALL_VALUES&&e.package!==o||s.push(e)})),s})}}class Ei{extract(e){return[S.USERROLES,S.INTERNALACTIVEUSERS]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.USERROLES),i=e.get(S.INTERNALACTIVEUSERS);if(!t)throw new Error("RecipeUserRoles: Data from dataset alias 'USERROLES' was undefined.");if(!i)throw new Error("RecipeUserRoles: Data from dataset alias 'USERS' was undefined.");return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){if(!0===e.hasActiveMembers&&(e.activeMemberRefs=yield C.map(e.activeMemberIds,e=>i.get(e))),!0===e.hasParent){const i=t.get(e.parentId);i&&(e.parentRef=i)}})),[...t.values()]})}}class Ii{extract(e){return[S.VALIDATIONRULES,S.OBJECTTYPES,S.OBJECTS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.OBJECTTYPES),o=e.get(S.OBJECTS),s=e.get(S.VALIDATIONRULES),r=Y.getPackageName(i),n=Y.getSObjectTypeName(i),a=Y.getSObjectName(i);if(!t)throw new Error("RecipeValidationRules: Data from dataset alias 'OBJECTTYPES' was undefined.");if(!o)throw new Error("RecipeValidationRules: Data from dataset alias 'OBJECTS' was undefined.");if(!s)throw new Error("RecipeValidationRules: Data from dataset alias 'VALIDATIONRULES' was undefined.");const l=[];return yield C.forEach(s,e=>I(this,void 0,void 0,function*(){var i,s,d;const c=o.get(e.objectId);if(c){if(void 0===c.typeRef){const e=t.get(c.typeId);e&&(c.typeRef=e)}e.objectRef=c}r!==Y.ALL_VALUES&&e.package!==r||n!==Y.ALL_VALUES&&(null===(s=null===(i=e.objectRef)||void 0===i?void 0:i.typeRef)||void 0===s?void 0:s.id)!==n||a!==Y.ALL_VALUES&&(null===(d=e.objectRef)||void 0===d?void 0:d.apiname)!==a||l.push(e)})),l})}}class Ci{extract(e){return[S.VISUALFORCECOMPONENTS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.VISUALFORCECOMPONENTS),o=Y.getPackageName(i);if(!t)throw new Error("RecipeVisualForceComponents: Data from dataset alias 'VISUALFORCECOMPONENTS' was undefined.");const s=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){o!==Y.ALL_VALUES&&e.package!==o||s.push(e)})),s})}}class yi{extract(e){return[S.VISUALFORCEPAGES]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.VISUALFORCEPAGES),o=Y.getPackageName(i);if(!t)throw new Error("RecipeVisualForcePages: Data from dataset alias 'VISUALFORCEPAGES' was undefined.");const s=[];return yield C.forEach(t,e=>I(this,void 0,void 0,function*(){o!==Y.ALL_VALUES&&e.package!==o||s.push(e)})),s})}}class Pi{extract(e){return[S.OBJECTTYPES,S.OBJECTS,S.WEBLINKS]}transform(e,t,i){return I(this,void 0,void 0,function*(){const t=e.get(S.OBJECTTYPES),o=e.get(S.OBJECTS),s=e.get(S.WEBLINKS),r=Y.getPackageName(i),n=Y.getSObjectTypeName(i),a=Y.getSObjectName(i);if(!t)throw new Error("RecipeWebLinks: Data from dataset alias 'OBJECTTYPES' was undefined.");if(!o)throw new Error("RecipeWebLinks: Data from dataset alias 'OBJECTS' was undefined.");if(!s)throw new Error("RecipeWebLinks: Data from dataset alias 'WEBLINKS' was undefined.");const l=[];return yield C.forEach(s,e=>I(this,void 0,void 0,function*(){var i,s,d;const c=o.get(e.objectId);if(c){if(void 0===c.typeRef){const e=t.get(c.typeId);e&&(c.typeRef=e)}e.objectRef=c}r!==Y.ALL_VALUES&&e.package!==r||n!==Y.ALL_VALUES&&(null===(s=null===(i=e.objectRef)||void 0===i?void 0:i.typeRef)||void 0===s?void 0:s.id)!==n||a!==Y.ALL_VALUES&&(null===(d=e.objectRef)||void 0===d?void 0:d.apiname)!==a||l.push(e)})),l})}}class Ri{extract(e){return[S.WORKFLOWS]}transform(e,t){return I(this,void 0,void 0,function*(){const t=e.get(S.WORKFLOWS);if(!t)throw new Error("RecipeWorkflows: Data from dataset alias 'WORKFLOWS' was undefined.");return[...t.values()]})}}class Ai{constructor(e,t){this._datasetManager=e,this._logger=t,this._recipes=new Map,this._recipeCollections=new Map,this._recipes.set(v.INTERNAL_ACTIVE_USERS,new Ht),this._recipes.set(v.APEX_CLASSES,new Tt),this._recipes.set(v.APEX_TESTS,new Dt),this._recipes.set(v.APEX_TRIGGERS,new _t),this._recipes.set(v.APEX_UNCOMPILED,new wt),this._recipes.set(v.APP_PERMISSIONS,new Lt),this._recipes.set(v.BROWSERS,new Ot),this._recipes.set(v.COLLABORATION_GROUPS,new bt),this._recipes.set(v.CURRENT_USER_PERMISSIONS,new Mt),this._recipes.set(v.CUSTOM_FIELDS,new Ft),this._recipes.set(v.CUSTOM_LABELS,new Nt),this._recipes.set(v.CUSTOM_TABS,new Ut),this._recipes.set(v.DASHBOARDS,new xt),this._recipes.set(v.DOCUMENTS,new Gt),this._recipes.set(v.EMAIL_TEMPLATES,new Vt),this._recipes.set(v.FIELD_PERMISSIONS,new Bt),this._recipes.set(v.FLOWS,new $t),this._recipes.set(v.HOME_PAGE_COMPONENTS,new jt),this._recipes.set(v.KNOWLEDGE_ARTICLES,new Qt),this._recipes.set(v.LIGHTNING_AURA_COMPONENTS,new qt),this._recipes.set(v.LIGHTNING_PAGES,new Jt),this._recipes.set(v.LIGHTNING_WEB_COMPONENTS,new Yt),this._recipes.set(v.OBJECT,new Kt),this._recipes.set(v.OBJECT_PERMISSIONS,new Xt),this._recipes.set(v.OBJECTS,new zt),this._recipes.set(v.OBJECT_TYPES,new Zt),this._recipes.set(v.ORGANIZATION,new ei),this._recipes.set(v.PACKAGES,new ti),this._recipes.set(v.PAGE_LAYOUTS,new ii),this._recipes.set(v.PERMISSION_SETS,new si),this._recipes.set(v.PERMISSION_SET_LICENSES,new oi),this._recipes.set(v.PROCESS_BUILDERS,new ri),this._recipes.set(v.PROFILE_PWD_POLICIES,new ni),this._recipes.set(v.PROFILE_RESTRICTIONS,new ai),this._recipes.set(v.PROFILES,new li),this._recipes.set(v.PUBLIC_GROUPS,new mi),this._recipes.set(v.QUEUES,new hi),this._recipes.set(v.RECORD_TYPES,new fi),this._recipes.set(v.REPORTS,new Si),this._recipes.set(v.STATIC_RESOURCES,new vi),this._recipes.set(v.USER_ROLES,new Ei),this._recipes.set(v.VALIDATION_RULES,new Ii),this._recipes.set(v.VISUALFORCE_COMPONENTS,new Ci),this._recipes.set(v.VISUALFORCE_PAGES,new yi),this._recipes.set(v.WEBLINKS,new Pi),this._recipes.set(v.WORKFLOWS,new Ri),this._recipeCollections.set(v.GLOBAL_VIEW,new Wt),this._recipeCollections.set(v.HARDCODED_URLS_VIEW,new kt)}run(e,t){return I(this,void 0,void 0,function*(){if(this._recipes.has(e)){const i=yield this._runRecipe(e,t);if(void 0===i)throw new Error(`Running recipe ${e} resulted in an undefined response.`);return i}if(this._recipeCollections.has(e)){const i=yield this._runRecipeCollection(e,t);if(void 0===i)throw new Error(`Running recipe collection ${e} resulted in an undefined response.`);return i}throw new TypeError(`The given alias (${e}) does not correspond to a registered recipe.`)})}clean(e,t){if(this._recipes.has(e))this._cleanRecipe(e,t);else{if(!this._recipeCollections.has(e))throw new TypeError(`The given alias (${e}) does not correspond to a registered recipe.`);this._cleanRecipeCollection(e,t)}}_runRecipe(e,t){return I(this,void 0,void 0,function*(){const i=`Run recipe "${e}"`,o=this._recipes.get(e);if(void 0===o)throw new Error(`The recipe with alias: ${e} was not found.`);let s,r,n;this._logger.log(i,"How many datasets this recipe has?");try{s=o.extract(this._logger.toSimpleLogger(i),t)}catch(e){return void this._logger.failed(i,`An error occurred while extracting the datasets (message: ${e.message}).`)}this._logger.log(i,`This recipe has ${null==s?void 0:s.length} ${(null==s?void 0:s.length)>1?"datasets":"dataset"}: ${s.map(e=>e instanceof f?e.alias:e).join(", ")}...`);try{r=yield this._datasetManager.run(s)}catch(e){return void this._logger.failed(i,`An error occurred while running the dataset ${e.dataset}.`)}this._logger.log(i,"Datasets information successfuly retrieved!"),this._logger.log(i,"This recipe will now transform all this information...");try{n=yield o.transform(r,this._logger.toSimpleLogger(i),t)}catch(e){return void this._logger.failed(i,`An error occurred while transforming the data (message: ${e.message}).`)}return this._logger.ended(i,"Transformation successfuly done!"),n})}_runRecipeCollection(e,t){return I(this,void 0,void 0,function*(){const i=`Run recipe collection "${e}"`,o=this._recipeCollections.get(e);if(void 0===o)throw new Error(`The recipe collection with alias: ${e} was not found.`);let s;this._logger.log(i,"How many recipes this recipe collection has?");try{s=o.extract(this._logger.toSimpleLogger(i),t)}catch(e){return void this._logger.failed(i,`An error occurred while extracting the recipes (message: ${e.message}).`)}this._logger.log(i,`This recipe collection has ${null==s?void 0:s.length} ${(null==s?void 0:s.length)>1?"recipes":"recipe"}: ${s.join(", ")}...`);const r=new Map,n=new Map;try{this._logger.enableFailed(!1),yield C.forEach(s,e=>I(this,void 0,void 0,function*(){try{const i=yield this._runRecipe(e,t);if(!Array.isArray(i))throw new TypeError(`The recipe "${e}" did not return an array of data as expected.`);r.set(e,i)}catch(t){n.set(e,t)}}))}catch(e){return void this._logger.failed(i,`An error occurred while running the recipes (message: ${e.message}).`)}finally{this._logger.enableFailed(!0)}this._logger.log(i,"All datasets information successfuly retrieved from recipes!"),this._logger.log(i,"This recipe collection will now transform all this information...");const a=o.filterByScoreRuleIds(this._logger.toSimpleLogger(i),t),l=(null==a?void 0:a.length)>0||!1,d=new Map;try{yield C.forEach(r,(e,t)=>I(this,void 0,void 0,function*(){var i,o,s;const r=null===(i=null==e?void 0:e.filter(e=>{var t,i;return!!(e.score&&e.score>0)&&(!0!==l||null!==(i=null===(t=e.badReasonIds)||void 0===t?void 0:t.some(e=>a.includes(e)))&&void 0!==i&&i)}))||void 0===i?void 0:i.sort((e,t)=>e.score>t.score?-1:1),n=new Map;null==r||r.forEach(e=>{e.badReasonIds.filter(e=>!0!==l||a.includes(e)).forEach(e=>{n.set(e,n.has(e)?n.get(e)+1:1)})});const c=new vt;c.hadError=!1,c.countAll=null!==(o=null==e?void 0:e.length)&&void 0!==o?o:0,c.countBad=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,c.countBadByRule=Array.from(n.keys()).map(e=>({ruleId:e,ruleName:$.GetScoreRuleDescription(e),count:n.get(e)})),c.data=r,d.set(t,c)})),n.forEach((e,t)=>{const i=new vt;i.hadError=!0,i.lastErrorMessage=(null==e?void 0:e.message)||"Unknown error",d.set(t,i)})}catch(e){return void this._logger.failed(i,`An error occurred while transforming the data (message: ${e.message}).`)}return this._logger.ended(i,"Transformation successfuly done!"),d})}_cleanRecipe(e,t){const i=`Clean recipe "${e}"`,o=this._recipes.get(e);if(void 0===o)throw new Error(`The recipe with alias: ${e} was not found.`);let s;this._logger.log(i,"How many datasets this recipe has?");try{s=o.extract(this._logger.toSimpleLogger(i),t)}catch(e){return void this._logger.failed(i,`An error occurred while extracting the datasets (message: ${e.message}).`)}this._logger.log(i,`This recipe has ${null==s?void 0:s.length} ${(null==s?void 0:s.length)>1?"datasets":"dataset"}: ${s.map(e=>e instanceof f?e.alias:e).join(", ")}...`),this._logger.log(i,"Clean all datasets...");try{this._datasetManager.clean(s)}catch(e){return void this._logger.failed(i,`An error occurred while cleaning the datasets (message: ${e.message}).`)}this._logger.ended(i,"Datasets succesfully cleaned!")}_cleanRecipeCollection(e,t){const i=`Clean recipe collection "${e}"`,o=this._recipeCollections.get(e);if(void 0===o)throw new Error(`The recipe collection with alias: ${e} was not found.`);let s;this._logger.log(i,"How many recipes this recipe collection has?");try{s=o.extract(this._logger.toSimpleLogger(i),t)}catch(e){return void this._logger.failed(i,`An error occurred while extracting the recipes (message: ${e.message}).`)}this._logger.log(i,`This recipe collection has ${null==s?void 0:s.length} ${(null==s?void 0:s.length)>1?"recipes":"recipe"}: ${s.join(", ")}...`),this._logger.log(i,"Clean all datasets of these recipes...");try{s.forEach(e=>{this._cleanRecipe(e,t)})}catch(e){return void this._logger.failed(i,`An error occurred while cleaning the datasets (message: ${e.message}).`)}this._logger.ended(i,"Datasets of these recipes succesfully cleaned!")}}const Ti=2e3;class Di{constructor(e){var t;if(this.apiVersion=$.CurrentApiVersion,!e)throw new Error("Can't instanciate a SalesforceManager from an undefined setup.");let i;if(e.connection)i=e.connection;else{if(!e.authenticationOptions)throw new Error("Can't instanciate a SalesforceManager if a authenticationOptions is undefined in the setup.");if(0===Object.keys(e.authenticationOptions).length)throw new Error("Can't instanciate a SalesforceManager if a authenticationOptions is totally empty in the setup.");const o={version:`${this.apiVersion}.0`,maxRequest:15};if(e.authenticationOptions.accessToken)o.accessToken=e.authenticationOptions.accessToken;else{if(void 0===e.authenticationOptions.clientId)throw new Error("Can't instanciate a SalesforceManager if a authenticationOptions.clientId is undefined in the setup.");if(void 0===e.authenticationOptions.clientSecret)throw new Error("Can't instanciate a SalesforceManager if a authenticationOptions.clientSecret is undefined in the setup.");if(void 0===e.authenticationOptions.redirectUri)throw new Error("Can't instanciate a SalesforceManager if a authenticationOptions.redirectUri is undefined in the setup.");o.oauth2={clientId:e.authenticationOptions.clientId,clientSecret:e.authenticationOptions.clientSecret,redirectUri:e.authenticationOptions.redirectUri}}const s="undefined"!=typeof window?null===window||void 0===window?void 0:window.jsforce:null!==(t=null===globalThis||void 0===globalThis?void 0:globalThis.jsforce)&&void 0!==t?t:null;if(!s)throw new Error("jsforce not available");if(i=new s.Connection(o),!i)throw new Error("Couldn't instantiate a salesforce Connection with the given factory and options")}this._watchDog=new R(()=>{var e,t,o,s,r,n;return{used:null!==(o=null===(t=null===(e=i.limitInfo)||void 0===e?void 0:e.apiUsage)||void 0===t?void 0:t.used)&&void 0!==o?o:0,max:null!==(n=null===(r=null===(s=i.limitInfo)||void 0===s?void 0:s.apiUsage)||void 0===r?void 0:r.limit)&&void 0!==n?n:0}}),this._connection=i}caseSafeId(e){return e&&18===(null==e?void 0:e.length)?e.substr(0,15):e}setupUrl(e,t,i,o){if(!e)return"";switch(t){case E.STANDARD_FIELD:case E.CUSTOM_FIELD:case E.ANY_FIELD:switch(o){case E.STANDARD_OBJECT:case E.CUSTOM_OBJECT:case E.KNOWLEDGE_ARTICLE:return"/lightning/setup/ObjectManager/"+(i?`${i}/FieldsAndRelationships/${e}/view`:`page?address=%2F${e}`);case E.CUSTOM_BIG_OBJECT:return`/lightning/setup/BigObjects/page?address=%2F${e}%3Fsetupid%3DBigObjects`;case E.CUSTOM_EVENT:return`/lightning/setup/EventObjects/page?address=%2F${e}%3Fsetupid%3DEventObjects`;case E.CUSTOM_SETTING:return`/lightning/setup/CustomSettings/page?address=%2F${e}%3Fsetupid%3DCustomSettings`;case E.CUSTOM_METADATA_TYPE:return`/lightning/setup/CustomMetadata/page?address=%2F${e}%3Fsetupid%3DCustomMetadata`;case E.EXTERNAL_OBJECT:return`/lightning/setup/ExternalObjects/page?address=%2F${e}%3Fsetupid%3DExternalObjects`;default:return`/lightning/setup/ObjectManager/page?address=%2F${e}`}case E.STANDARD_OBJECT:case E.CUSTOM_OBJECT:case E.KNOWLEDGE_ARTICLE:return`/lightning/setup/ObjectManager/${e}/Details/view`;case E.CUSTOM_BIG_OBJECT:return`/lightning/setup/BigObjects/page?address=%2F${e}%3Fsetupid%3DBigObjects`;case E.CUSTOM_EVENT:return`/lightning/setup/EventObjects/page?address=%2F${e}%3Fsetupid%3DEventObjects`;case E.CUSTOM_SETTING:return`/lightning/setup/CustomSettings/page?address=%2F${e}%3Fsetupid%3DCustomSettings`;case E.CUSTOM_METADATA_TYPE:return`/lightning/setup/CustomMetadata/page?address=%2F${e}%3Fsetupid%3DCustomMetadata`;case E.EXTERNAL_OBJECT:return`/lightning/setup/ExternalObjects/page?address=%2F${e}%3Fsetupid%3DExternalObjects`;case E.PAGE_LAYOUT:return"/lightning/setup/ObjectManager/"+(i?`${i}/PageLayouts/${e}/view`:`page?address=%2F${e}`);case E.VALIDATION_RULE:return`/lightning/setup/ObjectManager/page?address=%2F${e}`;case E.WEB_LINK:return"/lightning/setup/ObjectManager/"+(i?`${i}/ButtonsLinksActions/${e}/view`:`page?address=%2F${e}`);case E.RECORD_TYPE:return"/lightning/setup/ObjectManager/"+(i?`${i}/RecordTypes/${e}/view`:`page?address=%2F${e}`);case E.APEX_TRIGGER:return"/lightning/setup/ObjectManager/"+(i?`${i}/ApexTriggers/${e}/view`:`page?address=%2F${e}`);case E.FIELD_SET:return"/lightning/setup/ObjectManager/"+(i?`${i}/FieldSets/${e}/view`:`page?address=%2F${e}`);case E.USER:return`/lightning/setup/ManageUsers/page?address=%2F${e}%3Fnoredirect%3D1%26isUserEntityOverride%3D1`;case E.PROFILE:return`/lightning/setup/EnhancedProfiles/page?address=%2F${e}`;case E.PERMISSION_SET:return`/lightning/setup/PermSets/page?address=%2F${e}`;case E.PERMISSION_SET_LICENSE:return`/lightning/setup/PermissionSetLicense/page?address=%2F${e}`;case E.PERMISSION_SET_GROUP:return`/lightning/setup/PermSetGroups/page?address=%2F${e}`;case E.ROLE:return`/lightning/setup/Roles/page?address=%2F${e}`;case E.PUBLIC_GROUP:return`/lightning/setup/PublicGroups/page?address=%2Fsetup%2Fown%2Fgroupdetail.jsp%3Fid%3D${e}`;case E.QUEUE:return`/lightning/setup/Queues/page?address=%2Fp%2Fown%2FQueue%2Fd%3Fid%3D${e}`;case E.TECHNICAL_GROUP:return"";case E.EMAIL_TEMPLATE:return`/lightning/r/EmailTemplate/${e}/view`;case E.CUSTOM_LABEL:return`/lightning/setup/ExternalStrings/page?address=%2F${e}`;case E.STATIC_RESOURCE:return`/lightning/setup/StaticResources/page?address=%2F${e}`;case E.CUSTOM_SITE:return`/servlet/networks/switch?networkId=${e}&startURL=%2FcommunitySetup%2FcwApp.app%23%2Fc%2Fhome&`;case E.CUSTOM_TAB:return`/lightning/setup/CustomTabs/page?address=%2F${e}`;case E.FLOW_VERSION:return`/builder_platform_interaction/flowBuilder.app?flowId=${e}`;case E.FLOW_DEFINITION:return`/${e}`;case E.WORKFLOW_RULE:return`/lightning/setup/WorkflowRules/page?address=%2F${e}&nodeId=WorkflowRules`;case E.VISUAL_FORCE_PAGE:return`/lightning/setup/ApexPages/page?address=%2F${e}`;case E.VISUAL_FORCE_COMPONENT:return`/lightning/setup/ApexComponent/page?address=%2F${e}`;case E.AURA_WEB_COMPONENT:case E.LIGHTNING_WEB_COMPONENT:return`/lightning/setup/LightningComponentBundles/page?address=%2F${e}`;case E.LIGHTNING_PAGE:return"/lightning/setup/ObjectManager/"+(i?`${i}/LightningPages/${e}/view`:`page?address=%2F${e}`);case E.APEX_CLASS:return`/lightning/setup/ApexClasses/page?address=%2F${e}`;case E.KNOWLEDGE_ARTICLE_VERSION:return`/${e}`;default:return console.warn(`Type <${t}> not supported yet. Returning "/id" as url. FYI, id was <${e}>, parentId was <${i}> and parentType was <${o}>`),`/${e}`}}getObjectType(e,t){return!0===t?Ge:(null==e?void 0:e.endsWith("__c"))?Ue:(null==e?void 0:e.endsWith("__x"))?xe:(null==e?void 0:e.endsWith("__mdt"))?Ve:(null==e?void 0:e.endsWith("__e"))?Be:(null==e?void 0:e.endsWith("__ka"))?$e:(null==e?void 0:e.endsWith("__b"))?We:Ne}get dailyApiRequestLimitInformation(){return this._watchDog.dailyApiRequestLimitInformation}_standardSOQLQuery(e,t,i,o){return I(this,void 0,void 0,function*(){var s,r;const n=!0===e?this._connection.tooling:this._connection,a=[],l=e=>I(this,void 0,void 0,function*(){var i,s,r;let d;null===(i=this._watchDog)||void 0===i||i.beforeRequest(),d=void 0===e?yield n.query(t,{autoFetch:!1,headers:{"Sforce-Query-Options":"batchSize=2000"}}):yield n.queryMore(e),o((null===(s=null==d?void 0:d.records)||void 0===s?void 0:s.length)||0),null===(r=this._watchDog)||void 0===r||r.afterRequest(),a.push(...d.records),!1===d.done&&(yield l(d.nextRecordsUrl))});try{return yield l(),a}catch(o){if(i&&i.includes&&i.includes(o.errorCode))return[];throw new y("There was an error while running a SOQL query with the standard queryMore",o.errorCode,{SoqlQuery:null!=t?t:"(empty)",Tooling:e,ByPasses:null!==(s=null==i?void 0:i.join(", "))&&void 0!==s?s:"(empty)",Cause:null!==(r=null==o?void 0:o.message)&&void 0!==r?r:"(empty)",Where:"SalesforceManagerImpl.soqlQuery/_standardSOQLQuery"})}})}_customSOQLQuery(e,t,i,o){return I(this,void 0,void 0,function*(){var s;const r=!0===e?this._connection.tooling:this._connection,n=[],a=t.indexOf(" FROM "),l=t.indexOf(" GROUP BY "),d=-1!==t.indexOf(" WHERE "),c=-1!==t.indexOf(" ORDER BY "),u=-1!==l;if(u&&i){if(-1!==t.toLowerCase().indexOf(i.toLowerCase(),l))throw new y(`The field <${i}> used for the custom queryMore cannot be used in the GROUP BY clause of the query <${t}>`,"CustomQueryMoreFieldInGroupBy",{SoqlQuery:null!=t?t:"(empty)",Tooling:e,Field:null!=i?i:"(empty)",Cause:"Field used in GROUP BY",Where:"SalesforceManagerImpl.soqlQuery/_customSOQLQuery"});if(c)throw new y(`The query <${t}> is using an ORDER BY statement, which is not supported when using a custom queryMore`,"CustomQueryMoreWithOrderBy",{SoqlQuery:null!=t?t:"(empty)",Tooling:e,Cause:"ORDER BY statement found",Where:"SalesforceManagerImpl.soqlQuery/_customSOQLQuery"})}const p=e=>I(this,void 0,void 0,function*(){var s,c,g,h;let m;e||!1!==u||(e="000000000000000000"),m=!1===u?`${t} ${d?"AND":"WHERE"} ${i} > '${e}' ORDER BY ${i} LIMIT 2000`:`${t.substring(0,a)}, MAX(${i}) qmField ${t.substring(a,l)} `+(e?`${d?"AND":"WHERE"} ${i} > ${e} `:"")+`${t.substring(l)} `+`ORDER BY MAX(${i}) LIMIT 2000`,null===(s=this._watchDog)||void 0===s||s.beforeRequest();const f=yield r.query(m,{autoFetch:!1,headers:{"Sforce-Query-Options":"batchSize=2000"}});if(o((null===(c=null==f?void 0:f.records)||void 0===c?void 0:c.length)||0),null===(g=this._watchDog)||void 0===g||g.afterRequest(),n.push(...f.records),(null===(h=f.records)||void 0===h?void 0:h.length)>=Ti){const e=n[(null==n?void 0:n.length)-1];!1===u?yield p(e[i]):yield p(e.qmField)}});try{return yield p(),n}catch(o){throw new y("There was an error while running a SOQL query with the custom queryMore",o.errorCode,{SoqlQuery:null!=t?t:"(empty)",Tooling:e,Field:null!=i?i:"(empty)",Cause:null!==(s=null==o?void 0:o.message)&&void 0!==s?s:"(empty)",Where:"SalesforceManagerImpl.soqlQuery/_customSOQLQuery"})}})}soqlQuery(e,t){return I(this,void 0,void 0,function*(){null==t||t.log(`Preparing ${null==e?void 0:e.length} SOQL ${(null==e?void 0:e.length)>1?"queries":"query"}...`);let i=0,o=0;const s=[],r=[],n=[],a=[],l=()=>{null==t||t.log(`Processing ${null==e?void 0:e.length} SOQL ${(null==e?void 0:e.length)>1?"queries":"query"}...  Records retrieved: ${i},  Number of QueryMore calls done: ${o},  Pending: (${null==s?void 0:s.length}) on [${s.join(", ")}],  Done: (${null==r?void 0:r.length}) on [${r.join(", ")}],  Error: (${null==n?void 0:n.length}) on [${n.join(", ")}]`)},d=e=>{o++,i+=e,l()},c=yield Promise.allSettled(e.map(e=>I(this,void 0,void 0,function*(){var t;const i=e.string.lastIndexOf("FROM ")+5,o=e.string.indexOf(" ",i),c=e.string.substring(i,-1===o?null===(t=e.string)||void 0===t?void 0:t.length:o);let u;s.push(c);try{u=e.queryMoreField?yield this._customSOQLQuery(e.tooling,e.string,e.queryMoreField,d):yield this._standardSOQLQuery(e.tooling,e.string,e.byPasses,d),r.push(c)}catch(e){throw n.push(c),a.push(e),e}finally{const e=s.indexOf(c);e>-1&&s.splice(e,1),l()}return u})));if(null==t||t.log(`Done running ${null==e?void 0:e.length} SOQL ${(null==e?void 0:e.length)>1?"queries":"query"}.`),(null==a?void 0:a.length)>0)return Promise.reject(a[0]);const u=c.filter(e=>"fulfilled"===e.status).map(e=>e.value);return Promise.resolve(u)})}soslQuery(e,t){return I(this,void 0,void 0,function*(){null==t||t.log(`Preparing ${null==e?void 0:e.length} SOSL ${(null==e?void 0:e.length)>1?"queries":"query"}...`);const i=yield Promise.allSettled(e.map(e=>I(this,void 0,void 0,function*(){var t,i,o,s;let r;try{r=yield this._connection.search(e.string)}catch(r){if(e.byPasses&&e.byPasses.includes&&e.byPasses.includes(r.errorCode))return[];throw new y("There was an error while running a SOSL query",r.errorCode,{SoslQuery:null!==(t=e.string)&&void 0!==t?t:"(empty)",ByPasses:null!==(o=null===(i=e.byPasses)||void 0===i?void 0:i.join(", "))&&void 0!==o?o:"(empty)",Cause:null!==(s=null==r?void 0:r.message)&&void 0!==s?s:"(empty)",Where:"SalesforceManagerImpl.soslQuery"})}return(null==r?void 0:r.searchRecords)||[]})));null==t||t.log(`Done running ${null==e?void 0:e.length} SOSL ${(null==e?void 0:e.length)>1?"queries":"query"}.`);const o=i.filter(e=>"fulfilled"===e.status).map(e=>e.value);return Promise.resolve(o)})}dependenciesQuery(e,t){return I(this,void 0,void 0,function*(){var i,o,s,r;if(null===(i=this._watchDog)||void 0===i||i.beforeRequest(),null==t||t.log(`Starting to call Tooling API for dependency API call of ${null!==(o=null==e?void 0:e.length)&&void 0!==o?o:0} item(s)...`),0===(null!==(s=null==e?void 0:e.length)&&void 0!==s?s:0))return{records:[],errors:[]};const n=[];let a;for(let t=0;t<(null==e?void 0:e.length);t+=100){a&&5!==(null===(r=a.compositeRequest)||void 0===r?void 0:r.length)||(a={allOrNone:!1,compositeRequest:[]},n.push(a));const i=`'${e.slice(t,t+100).join("','")}'`;a.compositeRequest.push({method:"GET",url:`/services/data/v${this.apiVersion}.0/tooling/query?q=SELECT MetadataComponentId, MetadataComponentName, MetadataComponentType, RefMetadataComponentId, RefMetadataComponentName, RefMetadataComponentType FROM MetadataComponentDependency WHERE RefMetadataComponentId IN (${i}) OR MetadataComponentId IN (${i}) `,referenceId:`chunk${t}`})}let l=null==n?void 0:n.length,d=0,c=0,u=0;const p=[];for(let e=0;e<(null==n?void 0:n.length);e+=500){const i=n.slice(e,e+500);u++;const o=yield Promise.all(i.map(e=>I(this,void 0,void 0,function*(){var i;try{const t=yield this._connection.tooling.request({url:"/tooling/composite",method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});return null===(i=this._watchDog)||void 0===i||i.afterRequest(),d++,t}catch(e){return t.log(`Error here: ${e}`),void c++}finally{l--,null==t||t.log(`Processing ${null==n?void 0:n.length} Tooling composite ${(null==n?void 0:n.length)>1?"queries":"query"}...  Number of batch done: ${u},  Pending: (${l}),  Done: (${d}),  Error: (${c})`)}})));p.push(...o.filter(e=>void 0!==e))}null==t||t.log("Got all the results");const g=[],h=[],m=new Set;return p.forEach(i=>{i.compositeResponse.forEach(i=>{var o,s,r;if(200===i.httpStatusCode)null==t||t.log(`This response had a code: 200 so we add the ${null===(s=null===(o=null==i?void 0:i.body)||void 0===o?void 0:o.records)||void 0===s?void 0:s.length} records`),g.push(...i.body.records.map(e=>{const t=this.caseSafeId(e.MetadataComponentId),i=this.caseSafeId(e.RefMetadataComponentId),o=`${t}-${i}`;return m.has(o)?null:(m.add(o),{id:t,name:e.MetadataComponentName,type:e.MetadataComponentType,url:this.setupUrl(t,e.MetadataComponentType),refId:i,refName:e.RefMetadataComponentName,refType:e.RefMetadataComponentType,refUrl:this.setupUrl(i,e.RefMetadataComponentType)})}).filter(e=>null!==e));else{const t=i.body[0].errorCode;if("UNKNOWN_EXCEPTION"!==t)throw new y("There was an error while calling Composite Tooling API to get dependencies. ",t,{AllIds:JSON.stringify(null!=e?e:[])||"[]",HttpStatusCode:i.httpStatusCode,HttpResponse:JSON.stringify(null!==(r=null==i?void 0:i.body)&&void 0!==r?r:{})||"N/A",Where:"SalesforceManagerImpl.dependenciesQuery"});h.push(...e)}})}),{records:g,errors:h}})}readMetadata(e,t){return I(this,void 0,void 0,function*(){var i;null===(i=this._watchDog)||void 0===i||i.beforeRequest(),null==t||t.log(`Starting to call Metadata API for ${null==e?void 0:e.length} types...`),yield Promise.all(e.filter(e=>{var t;return null===(t=e.members)||void 0===t?void 0:t.includes("*")}).map(e=>I(this,void 0,void 0,function*(){var i,o;try{const t=yield this._connection.metadata.list([{type:e.type}]);null===(i=this._watchDog)||void 0===i||i.afterRequest(),e.members=e.members.filter(e=>"*"!==e),wi(t).forEach(t=>{e.members.push(t.fullName)})}catch(i){throw null==t||t.log(`The method metadata.list returned an error: ${JSON.stringify(i)}`),new y("There was an error while calling Metadata API to get a list of metadata.","METADATA_LIST",{Type:null!==(o=e.type)&&void 0!==o?o:"(empty)",ApiVersion:this.apiVersion,Cause:JSON.stringify(null!=i?i:{})||"N/A",Where:"SalesforceManagerImpl.readMetadata"})}})));const o=[],s=new Map;return e.forEach(e=>{var i,r;for(null==t||t.log(`Init the response array for this type: ${e.type}`),s.set(e.type,[]),null==t||t.log(`Starting looping for type ${e.type} and metadata.members?.length=${null===(i=e.members)||void 0===i?void 0:i.length}`);(null===(r=e.members)||void 0===r?void 0:r.length)>0;){const i=e.members.splice(0,10);o.push(new Promise((o,r)=>{null==t||t.log(`Try to call metadata read for type ${e.type} and currentMembers=${i}`),this._connection.metadata.read(e.type,i).then(t=>{var i;null===(i=this._watchDog)||void 0===i||i.afterRequest(),s.get(e.type).push(...wi(t)),o()}).catch(o=>{var s,n;null==t||t.log(`The method metadata.read returned an error: ${JSON.stringify(o)}`),r(new y("There was an error while calling Metadata API to read a list of metadata.","METADATA_READ",{Type:null!==(s=e.type)&&void 0!==s?s:"(empty)",PendingMembers:JSON.stringify(null!==(n=null==e?void 0:e.members)&&void 0!==n?n:[])||"[]",MembersInProcess:JSON.stringify(null!=i?i:[])||"[]",Cause:JSON.stringify(null!=o?o:{})||"N/A",Where:"SalesforceManagerImpl.readMetadata"}))})}))}}),null==t||t.log(`Calling all promises: ${null==o?void 0:o.length}`),yield Promise.all(o),null==t||t.log(`All promises ended and response is like: ${JSON.stringify(Array.from(s.entries()))}`),s})}readMetadataAtScale(e,t,i,o){return I(this,void 0,void 0,function*(){var s,r,n,a;if(null===(s=this._watchDog)||void 0===s||s.beforeRequest(),null==o||o.log(`Reading metadata at scale for type=${e} and ${null!==(r=null==t?void 0:t.length)&&void 0!==r?r:0} id(s).`),0===(null!==(n=null==t?void 0:t.length)&&void 0!==n?n:0))return[];const l=[];let d;t.forEach((t,i)=>{var o;d&&5!==(null===(o=d.compositeRequest)||void 0===o?void 0:o.length)||(d={allOrNone:!1,compositeRequest:[]},l.push(d)),d.compositeRequest.push({method:"GET",url:`/services/data/v${this.apiVersion}.0/tooling/sobjects/${e}/${t}`,referenceId:`chunk${i}`})});let c=null==l?void 0:l.length,u=0,p=0,g=0;const h=[];for(let e=0;e<(null==l?void 0:l.length);e+=1e3){const t=l.slice(e,e+1e3);g++;const i=yield Promise.all(t.map(e=>I(this,void 0,void 0,function*(){var t;try{const i=yield this._connection.tooling.request({url:"/tooling/composite",method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});return null===(t=this._watchDog)||void 0===t||t.afterRequest(),u++,i}catch(e){return o.log(`Error here: ${e}`),void p++}finally{c--,null==o||o.log(`Processing ${null==l?void 0:l.length} Tooling composite ${(null==l?void 0:l.length)>1?"queries":"query"}...  Number of batch done: ${g},  Pending: (${c}),  Done: (${u}),  Error: (${p})`)}})));h.push(...i.filter(e=>void 0!==e))}const m=[];return h.forEach(o=>{o.compositeResponse.forEach(o=>{var s,r;if(200===o.httpStatusCode)m.push(o.body);else{const n=o.body[0].errorCode;if(i&&i.includes&&!1===i.includes(n))throw new y("There was an error while calling Composite Tooling API to get metadata at scale.",n,{Type:null!=e?e:"(empty)",AllIds:JSON.stringify(null!=t?t:[])||"[]",ByPasses:null!==(s=null==i?void 0:i.join(", "))&&void 0!==s?s:"(empty)",HttpStatusCode:o.httpStatusCode,HttpResponse:JSON.stringify(null!==(r=null==o?void 0:o.body)&&void 0!==r?r:{})||"N/A",Where:"SalesforceManagerImpl.readMetadataAtScale"})}})}),null==o||o.log(`Done reading metadata at scale for type=${e}, returning ${null!==(a=null==m?void 0:m.length)&&void 0!==a?a:0} record(s).`),m})}describeGlobal(e){return I(this,void 0,void 0,function*(){var t,i,o,s;null===(t=this._watchDog)||void 0===t||t.beforeRequest(),null==e||e.log("Describing globally all sobjects in the org.");const r=yield this._connection.describeGlobal();if(void 0===r||void 0===r.sobjects||!1===Array.isArray(r.sobjects))throw new Error("The describeGlobal response was incorrect");return r.sobjects.push(_i),null===(i=this._watchDog)||void 0===i||i.afterRequest(),null==e||e.log(`Done describing globally the org, returning ${null!==(s=null===(o=r.sobjects)||void 0===o?void 0:o.length)&&void 0!==s?s:0} record(s).`),r.sobjects})}describe(e,t){return I(this,void 0,void 0,function*(){var i,o;if("Activity"===e)return null==t||t.log('Describing the "activity" sobject :D'),_i;null===(i=this._watchDog)||void 0===i||i.beforeRequest(),null==t||t.log(`Describing the sobject: ${e}.`);const s=yield this._connection.describe(e);if(void 0===s)throw new Error("The describe response was incorrect");return null===(o=this._watchDog)||void 0===o||o.afterRequest(),null==t||t.log(`Done describing the sobject: ${e}.`),s})}recordCount(e,t){return I(this,void 0,void 0,function*(){var i,o,s;null===(i=this._watchDog)||void 0===i||i.beforeRequest(),null==t||t.log(`Counting the nb records for the sobject: ${e}.`);const r=yield this._connection.request({url:`/limits/recordCount?sObjects=${e}`,method:"GET"});return null===(o=this._watchDog)||void 0===o||o.afterRequest(),null==t||t.log(`Done counting for the sobject: ${e}.`),Array.isArray(null==r?void 0:r.sObjects)&&1===(null===(s=null==r?void 0:r.sObjects)||void 0===s?void 0:s.length)?null==r?void 0:r.sObjects[0].count:0})}runAllTests(e){return I(this,void 0,void 0,function*(){var t,i;null===(t=this._watchDog)||void 0===t||t.beforeRequest(),null==e||e.log("Asking to run asynchronously all tests in this org.");const o=yield this._connection.request({url:"/tooling/runTestsAsynchronous",method:"POST",body:'{ "testLevel": "RunAllTestsInOrg", "skipCodeCoverage": false }',headers:{"Content-Type":"application/json"}});return null===(i=this._watchDog)||void 0===i||i.afterRequest(),null==e||e.log("Done asking to run asynchronously all tests in this org."),o})}compileClasses(e,t){return I(this,void 0,void 0,function*(){var i,o,s;null===(i=this._watchDog)||void 0===i||i.beforeRequest(),null==t||t.log("Compiling all classes in this org.");const r=yield this.readMetadataAtScale(E.APEX_CLASS,e,[],t);null===(o=this._watchDog)||void 0===o||o.beforeRequest();const n=Date.now(),a=[];let l,d=0;r.filter(e=>e.Body).forEach(e=>{var t;l&&5!==(null===(t=l.compositeRequest)||void 0===t?void 0:t.length)||(d++,l={allOrNone:!1,compositeRequest:[{method:"POST",url:`/services/data/v${this.apiVersion}.0/tooling/sobjects/MetadataContainer`,referenceId:"container",body:{Name:`container-${n}-${d}`}},{method:"POST",url:`/services/data/v${this.apiVersion}.0/tooling/sobjects/ContainerAsyncRequest`,referenceId:"request",body:{MetadataContainerId:"@{container.id}",IsCheckOnly:!0}}]},a.push(l)),l.compositeRequest.push({method:"POST",url:`/services/data/v${this.apiVersion}.0/tooling/sobjects/ApexClassMember`,referenceId:e.Id,body:{MetadataContainerId:"@{container.id}",ContentEntityId:e.Id,Body:e.Body}})});const c=a.map(e=>I(this,void 0,void 0,function*(){var t;return null===(t=this._watchDog)||void 0===t||t.afterRequest(),this._connection.tooling.request({url:"/tooling/composite",method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})})),u=yield Promise.all(c);null===(s=this._watchDog)||void 0===s||s.afterRequest();const p=new Map;return null==u||u.forEach(e=>{var i;return null===(i=e.compositeResponse)||void 0===i?void 0:i.filter(e=>{var t;return null===(t=null==e?void 0:e.referenceId)||void 0===t?void 0:t.startsWith("01p")}).forEach(e=>{var i,o;const s=null===(i=null==e?void 0:e.referenceId)||void 0===i?void 0:i.substring(0,15);if(!0===(null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.success))null==t||t.log(`Recompilation requested for classId ${s}`),p.set(s,{isSuccess:!0});else{let i;i=(null==e?void 0:e.body)&&Array.isArray(null==e?void 0:e.body)?e.body:(null==e?void 0:e.errors)&&Array.isArray(null==e?void 0:e.errors)?e.errors:["Unknown error during recompilation"],null==t||t.log(`Errors for classId ${s}: ${null==i?void 0:i.map(e=>JSON.stringify(e)).join(", ")}`),p.set(s,{isSuccess:!1,reasons:i})}})}),null==t||t.log("Done compiling all classes in this org."),p})}}const wi=e=>e?Array.isArray(e)?e:[e]:[],_i={name:"Activity",label:"Activity",labelPlural:"Activities",customSetting:!1,custom:!1,keyPrefix:"00T"};class Li{constructor(e){this._storage=e}setItem(e,t){this._storage.setItem(e,t)}getItem(e){return this._storage.getItem(e)}removeItem(e){this._storage.removeItem(e)}keys(){var e;const t=[];for(let i=0;i<(null===(e=this._storage)||void 0===e?void 0:e.length);i++){const e=this._storage.key(i);e&&t.push(e)}return t}}class Oi{constructor(){var e;if(this._api="undefined"!=typeof window?null===window||void 0===window?void 0:window.fflate:null!==(e=null===globalThis||void 0===globalThis?void 0:globalThis.fflate)&&void 0!==e?e:null,!this._api)throw new Error("fflate library not found")}compress(e){var t,i;const o=null===(t=this._api)||void 0===t?void 0:t.strToU8(e),s=null===(i=this._api)||void 0===i?void 0:i.zlibSync(o,{level:9});return Fi(s)}decompress(e){var t,i;const o=Ni(e),s=null===(t=this._api)||void 0===t?void 0:t.unzlibSync(o);return null===(i=this._api)||void 0===i?void 0:i.strFromU8(s)}}const bi=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],Mi=new Array(256);for(let e=0;e<256;e++)Mi[e]=`${bi[e>>>4&15]}${bi[15&e]}`;const Fi=e=>{let t="";for(let i=0,o=null==e?void 0:e.length;i<o;i++)t+=Mi[e[i]];return t},Ni=e=>{const t=[];for(let i=0;i<(null==e?void 0:e.length);i+=2)t.push(parseInt(e.substring(i,i+2),16));return new Uint8Array(t)};class Ui{get salesforceApiVersion(){if(void 0===this._sfdcManager)throw new Error("The salesforce manager was not defined in method salesforceApiVersion");return this._sfdcManager.apiVersion}constructor(e){var t,i,o,s,r,n,a,l,d;if(this.version="Nitrogen [N,7]",!(null==e?void 0:e.logSettings))throw new Error("Setup is missing a logSettings property");if(this._logger=new ft(null==e?void 0:e.logSettings),!(null==e?void 0:e.salesforce))throw new Error("Setup is missing a salesforce property");if(this._sfdcManager=new Di(null==e?void 0:e.salesforce),!(null==e?void 0:e.storage))throw new Error("Setup is missing a storage property");if(!(null===(t=null==e?void 0:e.storage)||void 0===t?void 0:t.localImpl))throw new Error("Setup is missing a storage.localImpl property");const c=new Li(null===(i=null==e?void 0:e.storage)||void 0===i?void 0:i.localImpl);if(!(null===(o=null==e?void 0:e.storage)||void 0===o?void 0:o.compression))throw new Error("Setup is missing a storage.compression property");if(!0===(null===(r=null===(s=null==e?void 0:e.storage)||void 0===s?void 0:s.compression)||void 0===r?void 0:r.useFflate))this._cacheManager=new K(new Oi,c);else{if(!(null===(a=null===(n=null==e?void 0:e.storage)||void 0===n?void 0:n.compression)||void 0===a?void 0:a.mockImpl))throw new Error("Setup is missing a storage.compression.mockImpl property");this._cacheManager=new K(null===(d=null===(l=null==e?void 0:e.storage)||void 0===l?void 0:l.compression)||void 0===d?void 0:d.mockImpl,c)}this._datasetManager=new mt(this._sfdcManager,this._cacheManager,this._logger),this._recipeManager=new Ai(this._datasetManager,this._logger),this._usageTermsAcceptedManually=!1}removeAllFromCache(){this._cacheManager.clear()}getCacheInformation(){return this._cacheManager.details()}getCacheData(e){return this._cacheManager.get(e)}getAllScoreRulesAsDataMatrix(){const e=h.create();return $.AllScoreRules.forEach(t=>{e.setRowHeader(`${t.id}`,t),t.applicable.forEach(i=>{var o;e.addValueToProperty(`${t.id}`,null!==(o=null==i?void 0:i.toString())&&void 0!==o?o:"N/A","true")})}),e.toDataMatrix()}get dailyApiRequestLimitInformation(){return this._sfdcManager.dailyApiRequestLimitInformation}runAllTestsAsync(){return I(this,void 0,void 0,function*(){var e,t;if(void 0===this._logger)throw new Error("The logger was not defined in method runAllTestsAsync");const i=null===(e=this._logger)||void 0===e?void 0:e.toSimpleLogger("Run All Tests");if(void 0===i)throw new Error("The simple logger was not defined in method runAllTestsAsync");return null===(t=this._sfdcManager)||void 0===t?void 0:t.runAllTests(i)})}compileClasses(e){return I(this,void 0,void 0,function*(){var t,i;if(void 0===this._logger)throw new Error("The logger was not defined in method compileClasses");const o=null===(t=this._logger)||void 0===t?void 0:t.toSimpleLogger("Compile Classes");if(void 0===o)throw new Error("The simple logger was not defined in method compileClasses");return null===(i=this._sfdcManager)||void 0===i?void 0:i.compileClasses(e,o)})}getOrganizationInformation(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.ORGANIZATION)})}checkUsageTerms(){return I(this,void 0,void 0,function*(){return!0!==(yield this.getOrganizationInformation()).isProduction||!1!==this._usageTermsAcceptedManually})}wereUsageTermsAcceptedManually(){return this._usageTermsAcceptedManually}acceptUsageTermsManually(){this._usageTermsAcceptedManually=!0}checkCurrentUserPermissions(){return I(this,void 0,void 0,function*(){const e=yield this._recipeManager.run(v.CURRENT_USER_PERMISSIONS,new Map([[Y.SYSTEM_PERMISSIONS_LIST,["ModifyAllData","AuthorApex","ApiEnabled","InstallPackaging"]]]));if(void 0===e||!1===(null==e?void 0:e.get("ModifyAllData"))||!1===(null==e?void 0:e.get("AuthorApex"))||!1===(null==e?void 0:e.get("ApiEnabled"))||!1===(null==e?void 0:e.get("InstallPackaging")))throw new TypeError("Current User Permission Access is not enough to run the application. Please make sure to assign ALL the following permissions to the current user: Modify All Data, Author Apex, API Enabled and Download AppExchange Packages.");return!0})}getPackages(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.PACKAGES)})}removeAllPackagesFromCache(){this._recipeManager.clean(v.PACKAGES)}getPageLayouts(e,t,i){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.PAGE_LAYOUTS,new Map([[Y.SOBJECT_NAME,i],[Y.PACKAGE_NAME,e],[Y.SOBJECT_TYPE_NAME,t]]))})}removeAllPageLayoutsFromCache(){this._recipeManager.clean(v.PAGE_LAYOUTS)}getObjectTypes(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.OBJECT_TYPES)})}getObjects(e,t){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.OBJECTS,new Map([[Y.PACKAGE_NAME,e],[Y.SOBJECT_TYPE_NAME,t]]))})}removeAllObjectsFromCache(){this._recipeManager.clean(v.OBJECTS)}getObject(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.OBJECT,new Map([[Y.SOBJECT_NAME,e]]))})}removeObjectFromCache(e){this._recipeManager.clean(v.OBJECT,new Map([[Y.SOBJECT_NAME,e]]))}getObjectPermissionsPerParent(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.OBJECT_PERMISSIONS,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllObjectPermissionsFromCache(){this._recipeManager.clean(v.OBJECT_PERMISSIONS)}getApplicationPermissionsPerParent(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.APP_PERMISSIONS,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllAppPermissionsFromCache(){this._recipeManager.clean(v.APP_PERMISSIONS)}getKnowledgeArticles(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.KNOWLEDGE_ARTICLES)})}removeAllKnowledgeArticlesFromCache(){this._recipeManager.clean(v.KNOWLEDGE_ARTICLES)}getChatterGroups(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.COLLABORATION_GROUPS)})}removeAllChatterGroupsFromCache(){this._recipeManager.clean(v.COLLABORATION_GROUPS)}getCustomFields(e,t,i){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.CUSTOM_FIELDS,new Map([[Y.PACKAGE_NAME,e],[Y.SOBJECT_TYPE_NAME,t],[Y.SOBJECT_NAME,i]]))})}removeAllCustomFieldsFromCache(){this._recipeManager.clean(v.CUSTOM_FIELDS)}getPermissionSets(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.PERMISSION_SETS,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllPermSetsFromCache(){this._recipeManager.clean(v.PERMISSION_SETS)}getPermissionSetLicenses(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.PERMISSION_SET_LICENSES)})}removeAllPermSetLicensesFromCache(){this._recipeManager.clean(v.PERMISSION_SET_LICENSES)}getProfiles(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.PROFILES,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllProfilesFromCache(){this._recipeManager.clean(v.PROFILES)}getProfileRestrictions(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.PROFILE_RESTRICTIONS,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllProfileRestrictionsFromCache(){this._recipeManager.clean(v.PROFILE_RESTRICTIONS)}getProfilePasswordPolicies(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.PROFILE_PWD_POLICIES)})}removeAllProfilePasswordPoliciesFromCache(){this._recipeManager.clean(v.PROFILE_PWD_POLICIES)}getActiveUsers(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.INTERNAL_ACTIVE_USERS)})}removeAllActiveUsersFromCache(){this._recipeManager.clean(v.INTERNAL_ACTIVE_USERS)}getBrowsers(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.BROWSERS)})}removeAllBrowsersFromCache(){this._recipeManager.clean(v.BROWSERS)}getCustomLabels(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.CUSTOM_LABELS,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllCustomLabelsFromCache(){this._recipeManager.clean(v.CUSTOM_LABELS)}getCustomTabs(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.CUSTOM_TABS,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllCustomTabsFromCache(){this._recipeManager.clean(v.CUSTOM_TABS)}getDocuments(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.DOCUMENTS,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllDocumentsFromCache(){this._recipeManager.clean(v.DOCUMENTS)}getLightningWebComponents(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.LIGHTNING_WEB_COMPONENTS,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllLightningWebComponentsFromCache(){this._recipeManager.clean(v.LIGHTNING_WEB_COMPONENTS)}getLightningAuraComponents(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.LIGHTNING_AURA_COMPONENTS,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllLightningAuraComponentsFromCache(){this._recipeManager.clean(v.LIGHTNING_AURA_COMPONENTS)}getLightningPages(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.LIGHTNING_PAGES,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllLightningPagesFromCache(){this._recipeManager.clean(v.LIGHTNING_PAGES)}getVisualForceComponents(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.VISUALFORCE_COMPONENTS,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllVisualForceComponentsFromCache(){this._recipeManager.clean(v.VISUALFORCE_COMPONENTS)}getVisualForcePages(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.VISUALFORCE_PAGES,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllVisualForcePagesFromCache(){this._recipeManager.clean(v.VISUALFORCE_PAGES)}getPublicGroups(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.PUBLIC_GROUPS)})}removeAllPublicGroupsFromCache(){this._recipeManager.clean(v.PUBLIC_GROUPS)}getQueues(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.QUEUES)})}removeAllQueuesFromCache(){this._recipeManager.clean(v.QUEUES)}getApexClasses(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.APEX_CLASSES,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllApexClassesFromCache(){this._recipeManager.clean(v.APEX_CLASSES)}getApexTests(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.APEX_TESTS,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllApexTestsFromCache(){this._recipeManager.clean(v.APEX_TESTS)}getApexUncompiled(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.APEX_UNCOMPILED,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllApexUncompiledFromCache(){this._recipeManager.clean(v.APEX_UNCOMPILED)}getApexTriggers(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.APEX_TRIGGERS,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllApexTriggersFromCache(){this._recipeManager.clean(v.APEX_TRIGGERS)}getRoles(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.USER_ROLES)})}removeAllRolesFromCache(){this._recipeManager.clean(v.USER_ROLES)}getRolesTree(){return I(this,void 0,void 0,function*(){const e=yield this.getRoles(),t=new Map,i="__i am root__";return null==e||e.forEach(e=>{!1===t.has(e.id)&&t.set(e.id,{id:e.id});const o=t.get(e.id);o.record||(o.record=e);const s=!0===e.hasParent?e.parentId:i;!1===t.has(s)&&t.set(s,{id:s});const r=t.get(s);r.children||(r.children=[]),r.children.push(o)}),t.get(i)})}getStaticResources(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.STATIC_RESOURCES,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllStaticResourcesFromCache(){this._recipeManager.clean(v.STATIC_RESOURCES)}getWeblinks(e,t,i){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.WEBLINKS,new Map([[Y.SOBJECT_NAME,i],[Y.PACKAGE_NAME,e],[Y.SOBJECT_TYPE_NAME,t]]))})}removeAllWeblinksFromCache(){this._recipeManager.clean(v.WEBLINKS)}getWorkflows(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.WORKFLOWS)})}removeAllWorkflowsFromCache(){this._recipeManager.clean(v.WORKFLOWS)}getRecordTypes(e,t,i){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.RECORD_TYPES,new Map([[Y.SOBJECT_NAME,i],[Y.PACKAGE_NAME,e],[Y.SOBJECT_TYPE_NAME,t]]))})}removeAllRecordTypesFromCache(){this._recipeManager.clean(v.RECORD_TYPES)}getFieldPermissionsPerParent(e,t){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.FIELD_PERMISSIONS,new Map([[Y.SOBJECT_NAME,e],[Y.PACKAGE_NAME,t]]))})}removeAllFieldPermissionsFromCache(){this._recipeManager.clean(v.FIELD_PERMISSIONS)}getFlows(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.FLOWS)})}removeAllFlowsFromCache(){this._recipeManager.clean(v.FLOWS)}getEmailTemplates(e){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.EMAIL_TEMPLATES,new Map([[Y.PACKAGE_NAME,e]]))})}removeAllEmailTemplatesFromCache(){this._recipeManager.clean(v.EMAIL_TEMPLATES)}getHomePageComponents(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.HOME_PAGE_COMPONENTS)})}removeAllHomePageComponentsFromCache(){this._recipeManager.clean(v.HOME_PAGE_COMPONENTS)}getProcessBuilders(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.PROCESS_BUILDERS)})}removeAllProcessBuildersFromCache(){this._recipeManager.clean(v.PROCESS_BUILDERS)}getValidationRules(e,t,i){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.VALIDATION_RULES,new Map([[Y.SOBJECT_NAME,i],[Y.PACKAGE_NAME,e],[Y.SOBJECT_TYPE_NAME,t]]))})}removeAllValidationRulesFromCache(){this._recipeManager.clean(v.VALIDATION_RULES)}getDashboards(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.DASHBOARDS)})}removeAllDashboardsFromCache(){this._recipeManager.clean(v.DASHBOARDS)}getReports(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.REPORTS)})}removeAllReportsFromCache(){this._recipeManager.clean(v.REPORTS)}getGlobalView(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.GLOBAL_VIEW)})}removeGlobalViewFromCache(){this._recipeManager.clean(v.GLOBAL_VIEW)}getHardcodedURLsView(){return I(this,void 0,void 0,function*(){return yield this._recipeManager.run(v.HARDCODED_URLS_VIEW)})}removeHardcodedURLsFromCache(){this._recipeManager.clean(v.HARDCODED_URLS_VIEW)}}export{Ui as API,p as CodeScanner,g as DataDependenciesFactory,h as DataMatrixFactory,S as DatasetAliases,f as DatasetRunInformation,Y as OrgCheckGlobalParameter,C as Processor,v as RecipeAliases,E as SalesforceMetadataTypes,R as SalesforceWatchDog,$ as SecretSauce};
