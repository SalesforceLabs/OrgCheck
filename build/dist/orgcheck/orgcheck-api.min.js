var OrgCheckAPI=function(e){"use strict";class t{created}class s{has(e){throw new Error("Not implemented")}get(e){throw new Error("Not implemented")}set(e,t){throw new Error("Not implemented")}details(){throw new Error("Not implemented")}remove(e){throw new Error("Not implemented")}clear(){throw new Error("Not implemented")}}class a{static create(e,t){if(e.errors?.includes(t))return{hadError:!0};const s=e.records.filter((e=>e.id===t)).map((e=>({id:e.refId,name:e.refName,type:e.refType,url:e.refUrl}))),a={};return{using:s,referenced:e.records.filter((e=>e.refId===t)).map((e=>(void 0===a[e.type]?a[e.type]=1:a[e.type]++,{id:e.id,name:e.name,type:e.type,url:e.url}))),referencedByTypes:a}}}class r{static create(){return new i}}class i{constructor(){this._columnIds=new Set,this._columns=new Map,this._rows=new Map}toDataMatrix(){const e=[];return this._columnIds.forEach((t=>{e.push(this._columns.has(t)?this._columns.get(t):t)})),{columnHeaders:e,rows:Array.from(this._rows.values())}}addValueToProperty(e,t,s){!1===this._rows.has(e)&&this._rows.set(e,{header:{},data:{}}),this._rows.get(e).data[t]=s,this._columnIds.add(t)}hasColumnHeader(e){return this._columns.has(e)}setColumnHeader(e,t){this._columns.set(e,t)}hasRowHeader(e){return this._rows.has(e)&&this._rows.get(e).header}setRowHeader(e,t){!0===this._rows.has(e)?this._rows.get(e).header=t:this._rows.set(e,{header:t,data:{}})}_columnIds;_columns;_rows}class n{static get label(){return console.error("Need to implement static label() method for",this,JSON.stringify(this),this.name),this.name}score;badFields;badReasonIds}class o extends n{dependencies}class l{}class c{getScoreRule(e){throw new Error("Not implemented")}getAllScoreRules(){throw new Error("Not implemented")}getInstance(e){throw new Error("Not implemented")}}class d{create(e){throw new Error("Not implemented")}computeScore(e){throw new Error("Not implemented")}createWithScore(e){throw new Error("Not implemented")}}class p{alias;cacheKey;parameters;constructor(e,t){this.alias=e,this.cacheKey=t,this.parameters=new Map}}class g{log(e,t){throw new TypeError('You need to implement the method "log()"')}ended(e,t){throw new TypeError('You need to implement the method "ended()"')}failed(e,t){throw new TypeError('You need to implement the method "failed()"')}}class u extends g{toSimpleLogger(e){throw new TypeError('You need to implement the method "toSimpleLogger()"')}}class h{currentUsageRatio=0;currentUsagePercentage="";get yellowThresholdPercentage(){return.7}get redThresholdPercentage(){return.9}get isGreenZone(){return this.currentUsageRatio<.7}get isYellowZone(){return this.currentUsageRatio>=.7&&this.currentUsageRatio<.9}get isRedZone(){return this.currentUsageRatio>=.9}}class m{constructor(e){this._apiLimitExtractor=e,this._lastRequestToSalesforce=void 0,this._lastApiUsage=new h}_apiLimitExtractor;_lastRequestToSalesforce;_lastApiUsage;beforeRequest(e){if(this._lastRequestToSalesforce&&Date.now()-this._lastRequestToSalesforce<=6e4&&this._lastApiUsage.isRedZone){const t=new TypeError(`WATCH DOG: Daily API Request limit is ${f(this._lastApiUsage.currentUsageRatio)}%, and our internal threshold is ${f(this._lastApiUsage.redThresholdPercentage)}%. We stop there to keep your org safe.`);throw e&&e(t),t}}afterRequest(e){const t=this._apiLimitExtractor();t&&(this._lastApiUsage.currentUsageRatio=t.used/t.max,this._lastApiUsage.currentUsagePercentage=f(this._lastApiUsage.currentUsageRatio),this._lastRequestToSalesforce=Date.now(),this.beforeRequest(e))}get dailyApiRequestLimitInformation(){return this._lastApiUsage}}const f=(e,t=2)=>(100*e).toFixed(t);class S extends l{static get label(){return"Apex Test Result"}methodName;isSuccessful;runtime;stacktrace}class E extends o{static get label(){return"Apex Class"}id;name;url;apiVersion;package;isTest;isTestSeeAllData;nbSystemAsserts;isAbstract;isClass;isEnum;isInterface;innerClassesCount;isSchedulable;isScheduled;interfaces;extends;methodsCount;testPassedMethods;testFailedMethods;lastTestRunDate;testMethodsRunTime;annotations;specifiedSharing;specifiedAccess;length;sourceCode;needsRecompilation;coverage;relatedTestClassIds;relatedTestClassRefs;relatedClassIds;relatedClassRefs;createdDate;lastModifiedDate}class I{get apiVersion(){throw new Error("Not implemented")}caseSafeId(e){throw new Error("Not implemented")}setupUrl(e,t,s,a){throw new Error("Not implemented")}getObjectType(e,t){throw new Error("Not implemented")}get dailyApiRequestLimitInformation(){throw new Error("Not implemented")}async soqlQuery(e,t){throw new Error("Not implemented")}async dependenciesQuery(e,t){throw new Error("Not implemented")}async readMetadata(e,t){throw new Error("Not implemented")}async readMetadataAtScale(e,t,s,a){throw new Error("Not implemented")}async describeGlobal(e){throw new Error("Not implemented")}async describe(e,t){throw new Error("Not implemented")}async recordCount(e,t){throw new Error("Not implemented")}async runAllTests(e){throw new Error("Not implemented")}async compileClasses(e,t){throw new Error("Not implemented")}}class w{async run(e,t,s,a){throw new TypeError('You need to implement the method "run()"')}}class P{async run(e){throw new TypeError('You need to implement the method "run()"')}clean(e){throw new TypeError('You need to implement the method "clean()"')}getScoreRule(e){throw new TypeError('You need to implement the method "getScoreRule()"')}getAllScoreRules(){throw new TypeError('You need to implement the method "getAllScoreRules()"')}}const T={APEXCLASSES:"apex-classes",APEXTRIGGERS:"apex-triggers",APPLICATIONS:"applications",APPPERMISSIONS:"app-permisions",CURRENTUSERPERMISSIONS:"current-user-permissions",CUSTOMFIELDS:"custom-fields",CUSTOMLABELS:"custom-labels",FIELDPERMISSIONS:"field-permissions",FLOWS:"flows",GROUPS:"groups",LIGHTNINGAURACOMPONENTS:"lightning-aura-components",LIGHTNINGPAGES:"lightning-pages",LIGHTNINGWEBCOMPONENTS:"lightning-web-components",OBJECT:"object",OBJECTPERMISSIONS:"object-permissions",OBJECTS:"objects",OBJECTTYPES:"object-types",ORGANIZATION:"org-information",PACKAGES:"packages",PERMISSIONSETS:"permission-sets",PERMISSIONSETLICENSES:"permission-set-licenses",PROFILEPWDPOLICIES:"profile-password-policies",PROFILERESTRICTIONS:"profile-restrictions",PROFILES:"profiles",USERROLES:"user-roles",USERS:"users",VALIDATIONRULES:"validation-rules",VISUALFORCECOMPONENTS:"visual-force-components",VISUALFORCEPAGES:"visual-force-pages",WORKFLOWS:"workflows"};Object.seal(T);class y{static async forEach(e,t){if(!e)return Promise.resolve();if("function"!=typeof t)throw new TypeError("Given iteratee is not a proper Function.");if(!0===Array.isArray(e))return Promise.all(e.map((async e=>(await t(e),null))));if(e instanceof Map==!0){const s=[];return e.forEach(((e,a)=>s.push(new Promise((s=>{t(e,a),s()}))))),Promise.all(s)}throw new TypeError("Given iterable is not a proper Array nor Map.")}static async map(e,t,s){if(!e)return Promise.resolve([]);if(!1===Array.isArray(e))throw new TypeError("Given iterable is not a proper Array.");if("function"!=typeof t)throw new TypeError("Given iteratee is not a proper Function.");if(s&&"function"!=typeof s)throw new TypeError("Given filterIteratee is not a proper Function.");return Promise.all((s?e.filter((e=>s(e))):e).map((async e=>t(e))))}}class R{extract(e,...t){throw new TypeError('You need to implement the method "extract()"')}async transform(e,t,...s){throw new TypeError('You need to implement the method "transform()"')}}class C{async run(e,...t){throw new TypeError('You need to implement the method "run()"')}clean(e,...t){throw new TypeError('You need to implement the method "clean()"')}}const A={ACTIVE_USERS:"active-users",APEX_CLASSES:"apex-classes",APEX_TESTS:"apex-tests",APEX_TRIGGERS:"apex-triggers",APEX_UNCOMPILED:"apex-uncompiled",APP_PERMISSIONS:"app-permissions",CURRENT_USER_PERMISSIONS:"current-user-permissions",CUSTOM_FIELDS:"custom-fields",CUSTOM_LABELS:"custom-labels",FIELD_PERMISSIONS:"field-permissions",FLOWS:"flows",LIGHTNING_AURA_COMPONENTS:"lightning-aura-components",LIGHTNING_PAGES:"lightning-pages",LIGHTNING_WEB_COMPONENTS:"lightning-web-components",OBJECT:"object",OBJECT_PERMISSIONS:"object-permissions",OBJECTS:"objects",OBJECT_TYPES:"object-types",ORGANIZATION:"org-information",PACKAGES:"packages",PERMISSION_SETS:"permission-sets",PERMISSION_SET_LICENSES:"permission-set-licenses",PROCESS_BUILDERS:"process-builders",PROFILE_PWD_POLICIES:"profile-password-policies",PROFILE_RESTRICTIONS:"profile-restrictions",PROFILES:"profiles",PUBLIC_GROUPS:"public-groups",QUEUES:"queues",USER_ROLES:"user-roles",VALIDATION_RULES:"validation-rules",VISUALFORCE_COMPONENTS:"visualforce-components",VISUALFORCE_PAGES:"visualforce-pages",WORKFLOWS:"workflows"};Object.seal(A);const b={ANY_FIELD:"Field",APEX_CLASS:"ApexClass",APEX_TRIGGER:"ApexTrigger",AURA_WEB_COMPONENT:"AuraDefinitionBundle",CUSTOM_BIG_OBJECT:"CustomBigObject",CUSTOM_EVENT:"CustomEvent",CUSTOM_FIELD:"CustomField",CUSTOM_LABEL:"CustomLabel",CUSTOM_METADATA_TYPE:"CustomMetadataType",CUSTOM_OBJECT:"CustomObject",CUSTOM_SETTING:"CustomSetting",CUSTOM_SITE:"CustomSite",CUSTOM_TAB:"CustomTab",EXTERNAL_OBJECT:"ExternalObject",FIELD_SET:"FieldSet",FLOW_DEFINITION:"FlowDefinition",FLOW_VERSION:"Flow",KNOWLEDGE_ARTICLE:"KnowledgeArticle",LIGHTNING_PAGE:"FlexiPage",LIGHTNING_WEB_COMPONENT:"LightningComponentBundle",PAGE_LAYOUT:"Layout",PERMISSION_SET:"PermissionSet",PERMISSION_SET_GROUP:"PermissionSetGroup",PERMISSION_SET_LICENSE:"PermissionSetLicense",PROFILE:"Profile",PUBLIC_GROUP:"PublicGroup",QUEUE:"Queue",RECORD_TYPE:"RecordType",ROLE:"UserRole",TECHNICAL_GROUP:"TechnicalGroup",STANDARD_FIELD:"StandardField",STANDARD_OBJECT:"StandardEntity",STATIC_RESOURCE:"StaticResource",USER:"User",VALIDATION_RULE:"ValidationRule",VISUAL_FORCE_COMPONENT:"ApexComponent",VISUAL_FORCE_PAGE:"ApexPage",WEB_LINK:"WebLink",WORKFLOW_RULE:"WorkflowRule"};Object.seal(b);class O extends l{static get label(){return"SObject Types"}id;label}const M="StandardEntity",_="CustomObject",D="ExternalObject",L="CustomSetting",N="CustomMetadataType",F="CustomEvent",x="KnowledgeArticle",v="CustomBigObject";class U extends l{static get label(){return"SObject"}id;label;labelPlural;isCustom;isFeedEnabled;isMostRecentEnabled;isSearchable;keyPrefix;name;apiname;url;package;typeId;typeRef;description;externalSharingModel;internalSharingModel;apexTriggerIds;apexTriggerRefs;fieldSets;layouts;flexiPages;limits;validationRules;webLinks;standardFields;customFieldIds;customFieldRefs;recordTypes;relationships;recordCount}class G extends n{static get label(){return"Apex Trigger"}id;name;url;apiVersion;package;length;isActive;beforeInsert;afterInsert;beforeUpdate;afterUpdate;beforeDelete;afterDelete;afterUndelete;objectId;objectRef;hasSOQL;hasDML;createdDate;lastModifiedDate}class $ extends l{static get label(){return"Application"}id;name;label;package}class B extends n{static get label(){return"Profile"}id;url;name;description;license;isCustom;package;memberCounts;createdDate;lastModifiedDate;nbFieldPermissions;nbObjectPermissions;type;importantPermissions}class W extends B{static get label(){return"Permission Set or Permission Set Group"}isGroup;groupId;assigneeProfileIds;assigneeProfileRefs}class V extends l{static get label(){return"Application Permission from Profile or Permission Set"}parentId;parentRef;appId;appRef;isAccessible;isVisible}class k extends o{static get label(){return"Custom Label"}id;name;package;label;category;isProtected;language;value;url;createdDate;lastModifiedDate}class j extends o{static get label(){return"Standard or Custom Field"}id;url;name;label;package;description;createdDate;lastModifiedDate;objectId;objectRef;isCustom;tooltip;type;length;isUnique;isEncrypted;isExternalId;isIndexed;defaultValue;isRestrictedPicklist;formula}class Q extends l{static get label(){return"Field Level Security from Profile or Permission Set"}parentId;parentRef;fieldApiName;isRead;isEdit}class q extends n{static get label(){return"Field Set"}id;label;description;url}class H extends o{static get label(){return"Flow or Process Builder"}id;name;url;apiVersion;currentVersionId;currentVersionRef;isLatestCurrentVersion;isVersionActive;versionsCount;description;type;isProcessBuilder;createdDate;lastModifiedDate}class J extends l{id;name;url;version;apiVersion;totalNodeCount;dmlCreateNodeCount;dmlDeleteNodeCount;dmlUpdateNodeCount;screenNodeCount;isActive;description;type;runningMode;createdDate;lastModifiedDate;sobject;triggerType}class Y extends n{static get label(){return"Public Group or Queue"}id;url;name;developerName;includeBosses;includeSubordinates;relatedId;nbDirectMembers;directUserIds;directUserRefs;directGroupIds;directGroupRefs;isPublicGroup;isQueue;type}class X extends o{static get label(){return"Aura Component"}id;name;apiVersion;package;createdDate;lastModifiedDate;description;url}class K extends o{static get label(){return"Lightning Page"}id;name;type;package;createdDate;lastModifiedDate;objectId;objectRef;description;url}class z extends o{static get label(){return"Lightning Web Component"}id;name;apiVersion;package;createdDate;lastModifiedDate;description;url}class Z extends n{static get label(){return"SObject Limit"}id;label;remaining;max;used;usedPercentage;type}class ee extends n{static get label(){return"Object Permissions from Profile or Permission Set"}parentId;parentRef;objectType;isRead;isCreate;isEdit;isDelete;isViewAll;isModifyAll}class te extends n{static get label(){return"SObject Releationship"}name;childObject;fieldName;isCascadeDelete;isRestrictedDelete}class se extends l{static get label(){return"Organization"}id;name;type;isDeveloperEdition;isSandbox;isTrial;isProduction;localNamespace}class ae extends n{static get label(){return"Package"}id;name;namespace;type}class re extends n{static get label(){return"Page Layout"}id;name;type;url}class ie extends n{static get label(){return"Permission Set License"}id;name;totalCount;usedCount;usedPercentage;remainingCount;permissionSetIds;permissionSetRefs;distinctActiveAssigneeCount;status;expirationDate;isAvailableForIntegrations;createDate;lastModifiedDate;url}class ne extends n{static get label(){return"Password Policy from a Profile"}forgotPasswordRedirect;lockoutInterval;maxLoginAttempts;minimumPasswordLength;minimumPasswordLifetime;obscure;passwordComplexity;passwordExpiration;passwordHistory;passwordQuestion;profileName}class oe extends n{static get label(){return"Restrictions from Profile"}profileId;profileRef;ipRanges;loginHours}class le extends l{static get label(){return"IP Range Restriction from Profile"}startAddress;endAddress;description;difference}class ce extends l{static get label(){return"Login Hour Restriction from Profile"}fromTime;toTime;day;difference}class de extends n{static get label(){return"Record Type"}id;name;developerName;url;isActive;isAvailable;isDefaultRecordTypeMapping;isMaster}class pe extends n{static get label(){return"User"}id;url;photoUrl;name;lastLogin;numberFailedLogins;onLightningExperience;lastPasswordChange;profileId;profileRef;aggregateImportantPermissions;permissionSetIds;permissionSetRefs}class ge extends n{static get label(){return"Role"}id;name;apiname;url;parentId;parentRef;hasParent;activeMembersCount;activeMemberIds;activeMemberRefs;hasActiveMembers;inactiveMembersCount;hasInactiveMembers;isExternal}class ue extends n{static get label(){return"Validation Rule"}id;name;isActive;description;errorDisplayField;errorMessage;objectId;objectRef;url}class he extends o{static get label(){return"Visualforce Component"}id;name;apiVersion;package;createdDate;lastModifiedDate;description;url}class me extends o{static get label(){return"Visualforce Page"}id;name;apiVersion;isMobileReady;package;createdDate;lastModifiedDate;description;url}class fe extends n{static get label(){return"Web Link"}id;name;url}class Se extends n{static get label(){return"Workflow"}id;name;url;description;actions;futureActions;emptyTimeTriggers;isActive;createdDate;lastModifiedDate;hasAction}class Ee extends s{_compress;_decompress;_encode;_decode;_storageSetItem;_storageGetItem;_storageRemoveItem;_storageKey;_storageLength;constructor(e){super(),this._compress=e.compress,this._decompress=e.decompress,this._encode=e.encode,this._decode=e.decode,this._storageSetItem=e.storage.setItem,this._storageGetItem=e.storage.getItem,this._storageRemoveItem=e.storage.removeItem,this._storageKey=e.storage.key,this._storageLength=e.storage.length}has(e){const t=ye(e),s=Te(e),a=this._getEntryFromCache(t);if(null===a)this._storageRemoveItem(t),this._storageRemoveItem(s);else{let e=!1;for(let t=0;t<this._storageLength()&&!1===e;t++)this._storageKey(t)===s&&(e=!0);if(!1===e)return this._storageRemoveItem(t),!1}return null!==a}get(e){const t=ye(e),s=Te(e),a=this._getEntryFromCache(t);if(null===a)return this._storageRemoveItem(t),this._storageRemoveItem(s),null;const r=this._getEntryFromCache(s);if(null===r)return this._storageRemoveItem(t),null;if(a.length=r.content.length,this._setItemToCache(t,JSON.stringify(a)),"map"!==a.type)return r.content;try{return new Map(r.content)}catch(e){return this._storageRemoveItem(t),this._storageRemoveItem(s),null}}set(e,t){const s=ye(e),a=Te(e);if(null===t)this._storageRemoveItem(s),this._storageRemoveItem(a);else{const e=Date.now(),r=t instanceof Map?{type:"map",length:t.size,created:e}:{type:"array",length:t.length,created:e},i=t instanceof Map?{content:Array.from(t.entries().filter((([e])=>!1===e.endsWith("Ref")))),created:e}:{content:t,created:e};try{this._setItemToCache(s,JSON.stringify(r)),this._setItemToCache(a,JSON.stringify(i))}catch(e){console.warn("Not able to store in local store that amount of data.")}}}details(){return Object.keys(localStorage).filter((e=>e.startsWith(Pe))).map((e=>{const t=this._getEntryFromCache(e);return{name:Re(e),isEmpty:0===t.length,isMap:"map"===t.type,length:t.length,created:t.created}}))}remove(e){this._storageRemoveItem(Te(e)),this._storageRemoveItem(ye(e))}clear(){return Object.keys(localStorage).filter((e=>e.startsWith(Ie))).forEach((e=>this._storageRemoveItem(e)))}_setItemToCache=(e,t)=>{try{const s=this._encode(t),a=this._compress(s),r=Oe(a);this._storageSetItem(e,r)}catch(s){console.error(`Error occured when trying to save the value for key ${e} with value ${t}`,s,t,JSON.stringify(t))}};_getEntryFromCache=e=>{let t=null;try{const s=this._storageGetItem(e);if(s){const e=Me(s),a=this._decompress(e);t=this._decode(a)}}catch(t){console.error(`Error occured when trying to get the value for key ${e}`,t)}if(!t)return null;try{const e=JSON.parse(t);return e.created&&Date.now()-e.created>Ce?null:e}catch(e){return null}}}const Ie="",we=`${Ie}.`,Pe=`${Ie}_`,Te=e=>e.startsWith(we)?e:we+e,ye=e=>e.startsWith(Pe)?e:Pe+e,Re=e=>e.startsWith(Pe)?e.substring(Pe.length):e.startsWith(we)?e.substring(we.length):e,Ce=864e5,Ae=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],be=new Array(256);for(let e=0;e<256;e++)be[e]=`${Ae[e>>>4&15]}${Ae[15&e]}`;const Oe=e=>{let t="";for(let s=0,a=e.length;s<a;s++)t+=be[e[s]];return t},Me=e=>{const t=[];for(let s=0;s<e.length;s+=2)t.push(parseInt(e.substring(s,s+2),16));return new Uint8Array(t)};class _e extends w{async run(e,t,s,a){const r=a?.get("object");s?.log("Querying Tooling API about CustomField in the org...");const i=await e.soqlQuery([{tooling:!0,string:"SELECT Id, EntityDefinition.QualifiedApiName, EntityDefinition.IsCustomSetting FROM CustomField WHERE ManageableState IN ('installedEditable', 'unmanaged') "+(r?`AND EntityDefinition.QualifiedApiName = '${r}'`:"")}],s),n=t.getInstance(j),o=i[0];s?.log(`Parsing ${o.length} custom fields...`);const l=new Map(await y.map(o,(t=>[e.caseSafeId(t.Id),{qualifiedApiName:t.EntityDefinition.QualifiedApiName,isCustomSetting:t.EntityDefinition.IsCustomSetting}]),(e=>!!e.EntityDefinition)));s?.log(`Retrieving dependencies of ${o.length} custom fields...`);const c=await e.dependenciesQuery(await y.map(o,(t=>e.caseSafeId(t.Id))),s);s?.log(`Calling Tooling API Composite to get more information about these ${l.size} custom fields...`);const d=await e.readMetadataAtScale("CustomField",Array.from(l.keys()),[],s);s?.log(`Parsing ${d.length} custom fields...`);const p=new Map(await y.map(d,(t=>{const s=e.caseSafeId(t.Id),a=l.get(s),r=n.createWithScore({properties:{id:s,name:t.DeveloperName,label:t.Metadata.label,package:t.NamespacePrefix||"",description:t.Description,isCustom:!0,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,objectId:a.qualifiedApiName,tooltip:t.InlineHelpText,type:t.Metadata.type,length:t.Metadata.length,isUnique:!0===t.Metadata.unique,isEncrypted:null!==t.Metadata.encryptionScheme&&"None"!==t.Metadata.encryptionScheme,isExternalId:!0===t.Metadata.externalId,isIndexed:!0===t.Metadata.unique||!0===t.Metadata.externalId,defaultValue:t.Metadata.defaultValue,isRestrictedPicklist:t.Metadata.valueSet&&!0===t.Metadata.valueSet.restricted,formula:t.Metadata.formula,url:e.setupUrl(s,b.CUSTOM_FIELD,a.qualifiedApiName,e.getObjectType(a.qualifiedApiName,a.isCustomSetting))},dependencies:{data:c}});return[r.id,r]})));return s?.log("Done"),p}}class De extends w{async run(e,t,s){s?.log("Querying Tooling API about ExternalString in the org...");const a=await e.soqlQuery([{tooling:!0,string:"SELECT Id, Name, NamespacePrefix, Category, IsProtected, Language, MasterLabel, Value, CreatedDate, LastModifiedDate FROM ExternalString WHERE ManageableState IN ('installedEditable', 'unmanaged') "}],s),r=t.getInstance(k),i=a[0];s?.log(`Retrieving dependencies of ${i.length} custom labels...`);const n=await e.dependenciesQuery(await y.map(i,(t=>e.caseSafeId(t.Id))),s);s?.log(`Parsing ${i.length} custom labels...`);const o=new Map(await y.map(i,(t=>{const s=e.caseSafeId(t.Id),a=r.createWithScore({properties:{id:s,name:t.Name,package:t.NamespacePrefix||"",category:t.Category,isProtected:!0===t.IsProtected,language:t.Language,label:t.MasterLabel,value:t.Value,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(s,b.CUSTOM_LABEL)},dependencies:{data:n}});return[a.id,a]})));return s?.log("Done"),o}}class Le extends w{async run(e,t,s,a){const r=t.getInstance(j),i=t.getInstance(q),n=t.getInstance(re),o=t.getInstance(Z),l=t.getInstance(ue),c=t.getInstance(fe),d=t.getInstance(de),p=t.getInstance(te),g=t.getInstance(U),u=a?.get("object"),h=u.split("__"),m=3===h.length?h[0]:"",f=await Promise.all([e.describe(u,s),e.soqlQuery([{tooling:!0,string:`SELECT Id, DurableId, DeveloperName, Description, NamespacePrefix, ExternalSharingModel, InternalSharingModel, (SELECT DurableId, QualifiedApiName, Description, IsIndexed FROM Fields), (SELECT Id FROM ApexTriggers), (SELECT Id, MasterLabel, Description FROM FieldSets), (SELECT Id, Name, LayoutType FROM Layouts), (SELECT DurableId, Label, Max, Remaining, Type FROM Limits), (SELECT Id, Active, Description, ErrorDisplayField, ErrorMessage, ValidationName FROM ValidationRules), (SELECT Id, Name FROM WebLinks) FROM EntityDefinition WHERE QualifiedApiName = '${u}' `+(m?`AND NamespacePrefix = '${m}' `:"")+"LIMIT 1"}],s),e.recordCount(u,s)]),S=f[0],E=e.getObjectType(S.name,S.customSetting),I=f[1][0][0];if(!I)throw new TypeError(`No entity definition record found for: ${u}`);const w=f[2],P=[],T=new Map;await y.forEach(I.Fields?.records,(t=>{if(t&&t.DurableId&&t.DurableId.split&&t.DurableId.includes){const s=e.caseSafeId(t.DurableId.split(".")[1]);t.DurableId?.includes(".00N")?P.push(s):T.set(t.QualifiedApiName,{id:s,description:t.Description,isIndexed:t.IsIndexed})}}));const R=await y.map(S.fields,(t=>{const s=T.get(t.name);return r.createWithScore({properties:{id:s.id,name:t.label,label:t.label,description:s.description,tooltip:t.inlineHelpText,type:t.type,length:t.length,isUnique:t.unique,isEncrypted:t.encrypted,isExternalId:t.externalId,isIndexed:s.isIndexed,defaultValue:t.defaultValue,formula:t.calculatedFormula,url:e.setupUrl(s.id,b.STANDARD_FIELD,I.DurableId,E)}})}),(e=>T.has(e.name))),C=await y.map(I.ApexTriggers?.records,(t=>e.caseSafeId(t.Id))),A=await y.map(I.FieldSets?.records,(t=>i.createWithScore({properties:{id:e.caseSafeId(t.Id),label:t.MasterLabel,description:t.Description,url:e.setupUrl(t.Id,b.FIELD_SET,I.DurableId)}}))),O=await y.map(I.Layouts?.records,(t=>n.createWithScore({properties:{id:e.caseSafeId(t.Id),name:t.Name,type:t.LayoutType,url:e.setupUrl(t.Id,b.PAGE_LAYOUT,I.DurableId)}}))),M=await y.map(I.Limits?.records,(t=>o.createWithScore({properties:{id:e.caseSafeId(t.DurableId),label:t.Label,max:t.Max,remaining:t.Remaining,used:t.Max-t.Remaining,usedPercentage:(t.Max-t.Remaining)/t.Max,type:t.Type}}))),_=await y.map(I.ValidationRules?.records,(t=>l.createWithScore({properties:{id:e.caseSafeId(t.Id),name:t.ValidationName,isActive:t.Active,description:t.Description,errorDisplayField:t.ErrorDisplayField,errorMessage:t.ErrorMessage,url:e.setupUrl(t.Id,b.VALIDATION_RULE)}}))),D=await y.map(I.WebLinks?.records,(t=>c.createWithScore({properties:{id:e.caseSafeId(t.Id),name:t.Name,url:e.setupUrl(t.Id,b.WEB_LINK,I.DurableId)}}))),L=await y.map(S.recordTypeInfos,(t=>d.createWithScore({properties:{id:e.caseSafeId(t.recordTypeId),name:t.name,developerName:t.developerName,isActive:t.active,isAvailable:t.available,isDefaultRecordTypeMapping:t.defaultRecordTypeMapping,isMaster:t.master,url:e.setupUrl(t.recordTypeId,b.RECORD_TYPE,I.DurableId)}}))),N=await y.map(S.childRelationships,(e=>p.createWithScore({properties:{name:e.relationshipName,childObject:e.childSObject,fieldName:e.field,isCascadeDelete:e.cascadeDelete,isRestrictedDelete:e.restrictedDelete}})),(e=>null!==e.relationshipName)),F=g.createWithScore({properties:{id:I.DurableId,label:S.label,labelPlural:S.labelPlural,isCustom:S.custom,isFeedEnabled:S.feedEnabled,isMostRecentEnabled:S.mruEnabled,isSearchable:S.searchable,keyPrefix:S.keyPrefix,name:I.DeveloperName,apiname:S.name,package:I.NamespacePrefix||"",typeId:E,description:I.Description,externalSharingModel:I.ExternalSharingModel,internalSharingModel:I.InternalSharingModel,apexTriggerIds:C,fieldSets:A,limits:M,layouts:O,validationRules:_,webLinks:D,standardFields:R,customFieldIds:P,recordTypes:L,relationships:N,recordCount:w,url:e.setupUrl(I.Id,E)}});return s?.log("Done"),F}}class Ne extends w{async run(e,t,s){s?.log("Querying REST API about ObjectPermissions in the org...");const a=await e.soqlQuery([{string:"SELECT ParentId, Parent.IsOwnedByProfile, Parent.ProfileId, SobjectType, CreatedDate, LastModifiedDate,PermissionsRead, PermissionsCreate, PermissionsEdit, PermissionsDelete, PermissionsViewAllRecords, PermissionsModifyAllRecords FROM ObjectPermissions"}],s),r=t.getInstance(ee),i=a[0];s?.log(`Parsing ${i.length} object permissions...`);const n=new Map(await y.map(i,(t=>{const s=r.create({properties:{parentId:e.caseSafeId(!0===t.Parent.IsOwnedByProfile?t.Parent.ProfileId:t.ParentId),objectType:t.SobjectType,isRead:t.PermissionsRead,isCreate:t.PermissionsCreate,isEdit:t.PermissionsEdit,isDelete:t.PermissionsDelete,isViewAll:t.PermissionsViewAllRecords,isModifyAll:t.PermissionsModifyAllRecords,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate}});return[`${s.parentId}_${s.objectType}`,s]}),(e=>null!==e.Parent)));return s?.log("Done"),n}}class Fe extends w{async run(e,t,s){s?.log("Querying REST API about SetupEntityAccess for TabSet in the org...");const a=await e.soqlQuery([{string:"SELECT ApplicationId, IsAccessible, IsVisible FROM AppMenuItem WHERE Type = 'TabSet' "},{string:"SELECT SetupEntityId, ParentId, Parent.IsOwnedByProfile, Parent.ProfileId FROM SetupEntityAccess WHERE SetupEntityType = 'TabSet' "}],s),r=t.getInstance(V),i=a[0],n=a[1];s?.log(`Parsing ${i.length} Application Menu Items...`);const o=new Map(await y.map(i,(t=>[e.caseSafeId(t.ApplicationId),{a:t.IsAccessible,v:t.IsVisible}])));s?.log(`Parsing ${n.length} Application Menu Items...`);const l=new Map(await y.map(n,(t=>{const s=e.caseSafeId(t.SetupEntityId),a=e.caseSafeId(t.Parent.IsOwnedByProfile?t.Parent.ProfileId:t.ParentId),i=o.get(s);return[`${s}-${a}`,r.create({properties:{appId:s,parentId:a,isAccessible:i.a,isVisible:i.v}})]}),(t=>o.has(e.caseSafeId(t.SetupEntityId)))));return s?.log("Done"),l}}class xe extends w{async run(e,t,s){const a=t.getInstance(U);s?.log("Performing a global describe and in parallel a SOQL query to EntityDefinition...");const r=await Promise.all([e.describeGlobal(s),e.soqlQuery([{string:"SELECT DurableId, NamespacePrefix, DeveloperName, QualifiedApiName, ExternalSharingModel, InternalSharingModel FROM EntityDefinition WHERE keyPrefix <> null AND DeveloperName <> null AND (NOT(keyPrefix IN ('00a', '017', '02c', '0D5', '1CE')))",tooling:!0,queryMoreField:"DurableId"}],s)]),i=r[0],n=r[1][0],o={},l=await y.map(n,(e=>(o[e.QualifiedApiName]=e,e.QualifiedApiName)));s?.log(`Parsing ${i.length} objects...`);const c=new Map(await y.map(i,(t=>{const s=e.getObjectType(t.name,t.customSetting),r=o[t.name],i=a.create({properties:{id:t.name,label:t.label,name:r.DeveloperName,apiname:t.name,package:r.NamespacePrefix||"",typeId:s,externalSharingModel:r.ExternalSharingModel,internalSharingModel:r.InternalSharingModel,url:e.setupUrl(r.DurableId,s)}});return[i.id,i]}),(e=>!!l?.includes(e.name))));return s?.log("Done"),c}}const ve=[{id:M,label:"Standard Object"},{id:_,label:"Custom Object"},{id:D,label:"External Object"},{id:L,label:"Custom Setting"},{id:N,label:"Custom Metadata Type"},{id:F,label:"Platform Event"},{id:x,label:"Knowledge Article"},{id:v,label:"Big Object"}];class Ue extends w{async run(e,t,s){const a=t.getInstance(O);return new Map(ve.map((e=>[e.id,a.create({properties:{id:e.id,label:e.label}})])))}}const Ge="Production",$e="Developer Edition",Be="Sandbox",We="Trial";class Ve extends w{async run(e,t,s){s?.log("Querying REST API about Organization in the org...");const a=await e.soqlQuery([{string:"SELECT Id, Name, IsSandbox, OrganizationType, TrialExpirationDate, NamespacePrefix FROM Organization LIMIT 1"}],s);s?.log(`Received result=${JSON.stringify(a)}`),s?.log("We need to get the first result and from there the first record...");const r=a[0][0];s?.log("Parsing the result...");const i=t.getInstance(se);let n;n="Developer Edition"===r.OrganizationType?$e:!0===r.IsSandbox?Be:!1===r.IsSandbox&&r.TrialExpirationDate?We:Ge;const o=i.create({properties:{id:e.caseSafeId(r.Id),name:r.Name,type:n,isDeveloperEdition:n===$e,isSandbox:n===Be,isTrial:n===We,isProduction:n===Ge,localNamespace:r.NamespacePrefix||""}});return s?.log("Done"),o}}class ke extends w{async run(e,t,s,a){const r=a?.get("permissions");s?.log("Querying REST API about UserPermissionAccess in the org...");const i=(await e.soqlQuery([{string:`SELECT ${r.map((e=>`Permissions${e}`)).join(", ")} FROM UserPermissionAccess LIMIT 1`}],s))[0][0];return s?.log("Parsing the results..."),new Map(await y.map(Object.keys(i),(e=>[e,i[e]]),(e=>e.startsWith("Permissions"))))}}class je extends w{async run(e,t,s){s?.log("Querying Tooling API about InstalledSubscriberPackage and REST API about Organization in the org...");const a=await e.soqlQuery([{tooling:!0,string:"SELECT Id, SubscriberPackage.NamespacePrefix, SubscriberPackage.Name FROM InstalledSubscriberPackage "},{string:"SELECT NamespacePrefix FROM Organization LIMIT 1 "}],s),r=t.getInstance(ae),i=a[0];s?.log(`Parsing ${i.length} installed packages...`);const n=new Map(await y.map(i,(t=>{const s=e.caseSafeId(t.Id),a=r.create({properties:{id:s,name:t.SubscriberPackage.Name,namespace:t.SubscriberPackage.NamespacePrefix,type:"Installed"}});return[a.id,a]}))),o=a[1][0].NamespacePrefix;return o&&(s?.log(`Adding your local package ${o}...`),n.set(o,r.create({properties:{id:o,name:o,namespace:o,type:"Local"}}))),s?.log("Done"),n}}class Qe extends w{async run(e,t,s){s?.log("Querying REST API about PermissionSet, PermissionSetAssignment and PermissionSet (with a PermissionSetGroupId populated) in the org...");const a=await e.soqlQuery([{string:"SELECT Id, Name, Description, IsCustom, License.Name, NamespacePrefix, Type, PermissionsApiEnabled, PermissionsViewSetup, PermissionsModifyAllData, PermissionsViewAllData, CreatedDate, LastModifiedDate, (SELECT Id FROM FieldPerms LIMIT 51), (SELECT Id FROM ObjectPerms LIMIT 51)FROM PermissionSet WHERE IsOwnedByProfile = FALSE"},{string:"SELECT Id, AssigneeId, Assignee.ProfileId, PermissionSetId FROM PermissionSetAssignment WHERE Assignee.IsActive = TRUE AND PermissionSet.IsOwnedByProfile = FALSE ORDER BY PermissionSetId "},{byPasses:["INVALID_TYPE"],string:"SELECT Id, PermissionSetGroupId, PermissionSetGroup.Description FROM PermissionSet WHERE PermissionSetGroupId != null "}],s),r=t.getInstance(W),i=a[0];s?.log(`Parsing ${i.length} permission sets...`);const n=new Map(await y.map(i,(t=>{const s=e.caseSafeId(t.Id),a="Group"===t.Type,i=r.create({properties:{id:s,name:t.Name,description:t.Description,license:t.License?t.License.Name:"",isCustom:t.IsCustom,package:t.NamespacePrefix||"",memberCounts:0,isGroup:a,type:a?"Permission Set Group":"Permission Set",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,nbFieldPermissions:t.FieldPerms?.records.length||0,nbObjectPermissions:t.ObjectPerms?.records.length||0,importantPermissions:{apiEnabled:!0===t.PermissionsApiEnabled,viewSetup:!0===t.PermissionsViewSetup,modifyAllData:!0===t.PermissionsModifyAllData,viewAllData:!0===t.PermissionsViewAllData},url:!1===a?e.setupUrl(s,b.PERMISSION_SET):""}});return[i.id,i]}))),o=a[1];s?.log(`Parsing ${o.length} Permission Set Assignments...`);const l=new Map;await y.forEach(o,(t=>{const s=e.caseSafeId(t.PermissionSetId),a=e.caseSafeId(t.Assignee.ProfileId);n.has(s)&&(!1===l.has(s)&&l.set(s,new Set),l.get(s).add(a),n.get(s).memberCounts++)})),await y.forEach(l,((e,t)=>{n.get(t).assigneeProfileIds=Array.from(e)}));const c=a[2];return s?.log(`Parsing ${c.length} Permission Set Groups...`),await y.forEach(c,(t=>{const s=e.caseSafeId(t.Id),a=e.caseSafeId(t.PermissionSetGroupId);if(n.has(s)){const t=n.get(s);t.isGroup=!0,t.groupId=a,t.url=e.setupUrl(a,b.PERMISSION_SET_GROUP)}})),s?.log(`Computing the score for ${n.size} permission sets...`),await y.forEach(n,(e=>{r.computeScore(e)})),s?.log("Done"),n}}class qe extends w{async run(e,t,s){s?.log("Querying REST API about PermissionSet with IsOwnedByProfile=true in the org...");const a=await e.soqlQuery([{string:"SELECT ProfileId, Profile.Name, Profile.Description, IsCustom, License.Name, NamespacePrefix, PermissionsApiEnabled, PermissionsViewSetup, PermissionsModifyAllData, PermissionsViewAllData, CreatedDate, LastModifiedDate, (SELECT Id FROM FieldPerms LIMIT 51), (SELECT Id FROM ObjectPerms LIMIT 51), (SELECT Id FROM Assignments WHERE Assignee.IsActive = TRUE LIMIT 51) FROM PermissionSet WHERE isOwnedByProfile = TRUE"}],s),r=t.getInstance(B),i=a[0];s?.log(`Parsing ${i.length} profiles...`);const n=new Map(await y.map(i,(t=>{const s=e.caseSafeId(t.ProfileId),a=r.create({properties:{id:s,name:t.Profile.Name,description:t.Profile.Description,license:t.License?t.License.Name:"",isCustom:t.IsCustom,package:t.NamespacePrefix||"",memberCounts:t.Assignments?.records.length||0,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,nbFieldPermissions:t.FieldPerms?.records.length||0,nbObjectPermissions:t.ObjectPerms?.records.length||0,type:"Profile",importantPermissions:{apiEnabled:!0===t.PermissionsApiEnabled,viewSetup:!0===t.PermissionsViewSetup,modifyAllData:!0===t.PermissionsModifyAllData,viewAllData:!0===t.PermissionsViewAllData},url:e.setupUrl(s,b.PROFILE)}});return[a.id,a]})));return s?.log(`Computing the score for ${n.size} profiles...`),await y.forEach(n,(e=>{r.computeScore(e)})),s?.log("Done"),n}}const He=e=>e?.split(".").reduce(((e,t,s,a)=>e+Number(t)*Math.pow(255,a.length-1-s)),0),Je=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];class Ye extends w{async run(e,t,s){s?.log("Querying REST API about Profile in the org...");const a=(await e.soqlQuery([{string:"SELECT Id FROM Profile"}],s))[0];s?.log(`Parsing ${a.length} Profiles...`);const r=await y.map(a,(e=>e.Id)),i=t.getInstance(oe),n=t.getInstance(le),o=t.getInstance(ce);s?.log(`Calling Tooling API Composite to get more information about these ${r.length} profiles...`);const l=await e.readMetadataAtScale("Profile",r,["UNKNOWN_EXCEPTION"],s);s?.log(`Parsing ${l.length} profile restrictions...`);const c=new Map(await y.map(l,(async t=>{const s=e.caseSafeId(t.Id);let a,r;a=t.Metadata.loginHours?await y.map(Je,(e=>{const s=t.Metadata.loginHours[e+"Start"],a=t.Metadata.loginHours[e+"End"];return o.create({properties:{day:e,fromTime:("0"+Math.floor(s/60)).slice(-2)+":"+("0"+s%60).slice(-2),toTime:("0"+Math.floor(a/60)).slice(-2)+":"+("0"+a%60).slice(-2),difference:a-s}})})):[],r=t.Metadata.loginIpRanges&&t.Metadata.loginIpRanges.length>0?await y.map(t.Metadata.loginIpRanges,(e=>{const t=He(e.startAddress),s=He(e.endAddress);return n.create({properties:{startAddress:e.startAddress,endAddress:e.endAddress,description:e.description||"(empty)",difference:s-t+1}})})):[];const l=i.createWithScore({properties:{profileId:s,ipRanges:r,loginHours:a}});return[l.profileId,l]})));return s?.log("Done"),c}}class Xe extends w{async run(e,t,s){s?.log("Querying Metadata API about ProfilePasswordPolicy...");const a=await e.readMetadata([{type:"ProfilePasswordPolicy",members:["*"]}],s),r=a?.get("ProfilePasswordPolicy")||[];if(!r)return new Map;const i=t.getInstance(ne);s?.log(`Parsing ${r.length} profile password policies...`);const n=new Map(await y.map(r,(e=>{const t=i.createWithScore({properties:{forgotPasswordRedirect:"true"===e.forgotPasswordRedirect,lockoutInterval:parseInt(e.lockoutInterval,10),maxLoginAttempts:parseInt(e.maxLoginAttempts,10),minimumPasswordLength:parseInt(e.minimumPasswordLength,10),minimumPasswordLifetime:"true"===e.minimumPasswordLifetime,obscure:"true"===e.obscure,passwordComplexity:parseInt(e.passwordComplexity,10),passwordExpiration:parseInt(e.passwordExpiration,10),passwordHistory:parseInt(e.passwordHistory,10),passwordQuestion:"1"===e.passwordQuestion,profileName:e.profile}});return[t.profileName,t]}),(e=>"string"==typeof e.profile&&""!==e.profile)));return s?.log("Done"),n}}class Ke extends w{async run(e,t,s){s?.log("Querying REST API about internal active User in the org...");const a=await e.soqlQuery([{string:"SELECT Id, Name, SmallPhotoUrl, ProfileId, LastLoginDate, LastPasswordChangeDate, NumberOfFailedLogins, UserPreferencesLightningExperiencePreferred, (SELECT PermissionSetId FROM PermissionSetAssignments WHERE PermissionSet.IsOwnedByProfile = false) FROM User WHERE IsActive = true AND ContactId = NULL AND Profile.Id != NULL "}],s),r=t.getInstance(pe),i=a[0];s?.log(`Parsing ${i.length} users...`);const n=new Map(await y.map(i,(async t=>{const s=e.caseSafeId(t.Id),a=await y.map(t?.PermissionSetAssignments?.records,(t=>e.caseSafeId(t.PermissionSetId))),i=r.createWithScore({properties:{id:s,photoUrl:t.SmallPhotoUrl,name:t.Name,lastLogin:t.LastLoginDate,numberFailedLogins:t.NumberOfFailedLogins,onLightningExperience:t.UserPreferencesLightningExperiencePreferred,lastPasswordChange:t.LastPasswordChangeDate,profileId:e.caseSafeId(t.ProfileId),permissionSetIds:a,url:e.setupUrl(s,b.USER)}});return[i.id,i]})));return s?.log("Done"),n}}class ze extends w{async run(e,t,s){s?.log("Querying Tooling API about ApexPage in the org...");const a=await e.soqlQuery([{tooling:!0,string:"SELECT Id, Name, ApiVersion, NamespacePrefix, Description, IsAvailableInTouch, CreatedDate, LastModifiedDate FROM ApexPage WHERE ManageableState IN ('installedEditable', 'unmanaged')"}],s),r=t.getInstance(me),i=a[0];s?.log(`Retrieving dependencies of ${i.length} visualforce pages...`);const n=await e.dependenciesQuery(await y.map(i,(t=>e.caseSafeId(t.Id))),s);s?.log(`Parsing ${i.length} visualforce pages...`);const o=new Map(await y.map(i,(t=>{const s=e.caseSafeId(t.Id),a=r.createWithScore({properties:{id:s,name:t.Name,apiVersion:t.ApiVersion,isMobileReady:t.IsAvailableInTouch,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,url:e.setupUrl(s,b.VISUAL_FORCE_PAGE)},dependencies:{data:n}});return[a.id,a]})));return s?.log("Done"),o}}class Ze extends w{async run(e,t,s){s?.log("Querying Tooling API about ApexComponent in the org...");const a=await e.soqlQuery([{tooling:!0,string:"SELECT Id, Name, ApiVersion, NamespacePrefix, Description, CreatedDate, LastModifiedDate FROM ApexComponent WHERE ManageableState IN ('installedEditable', 'unmanaged') "}],s),r=t.getInstance(he),i=a[0];s?.log(`Retrieving dependencies of ${i.length} visualforce components...`);const n=await e.dependenciesQuery(await y.map(i,(t=>e.caseSafeId(t.Id))),s);s?.log(`Parsing ${i.length} visualforce components...`);const o=new Map(await y.map(i,(t=>{const s=e.caseSafeId(t.Id),a=r.createWithScore({properties:{id:s,name:t.Name,apiVersion:t.ApiVersion,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,url:e.setupUrl(s,b.VISUAL_FORCE_COMPONENT)},_dependencies:{data:n},get dependencies(){return this._dependencies},set dependencies(e){this._dependencies=e}});return[a.id,a]})));return s?.log("Done"),o}}class et extends w{async run(e,t,s){s?.log("Querying Tooling API about AuraDefinitionBundle in the org...");const a=await e.soqlQuery([{tooling:!0,string:"SELECT Id, MasterLabel, ApiVersion, NamespacePrefix, Description, CreatedDate, LastModifiedDate FROM AuraDefinitionBundle WHERE ManageableState IN ('installedEditable', 'unmanaged') "}],s),r=t.getInstance(X),i=a[0];s?.log(`Retrieving dependencies of ${i.length} lightning aura components...`);const n=await e.dependenciesQuery(await y.map(i,(t=>e.caseSafeId(t.Id))),s);s?.log(`Parsing ${i.length} lightning aura components...`);const o=new Map(await y.map(i,(t=>{const s=e.caseSafeId(t.Id),a=r.createWithScore({properties:{id:s,name:t.MasterLabel,apiVersion:t.ApiVersion,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,url:e.setupUrl(s,b.AURA_WEB_COMPONENT)},dependencies:{data:n}});return[a.id,a]})));return s?.log("Done"),o}}class tt extends w{async run(e,t,s){s?.log("Querying Tooling API about LightningComponentBundle in the org...");const a=await e.soqlQuery([{tooling:!0,string:"SELECT Id, MasterLabel, ApiVersion, NamespacePrefix, Description, CreatedDate, LastModifiedDate FROM LightningComponentBundle WHERE ManageableState IN ('installedEditable', 'unmanaged') "}],s),r=t.getInstance(z),i=a[0];s?.log(`Retrieving dependencies of ${i.length} lightning web components...`);const n=await e.dependenciesQuery(await y.map(i,(t=>e.caseSafeId(t.Id))),s);s?.log(`Parsing ${i.length} lightning web components...`);const o=new Map(await y.map(i,(t=>{const s=e.caseSafeId(t.Id),a=r.createWithScore({properties:{id:s,name:t.MasterLabel,apiVersion:t.ApiVersion,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,url:e.setupUrl(s,b.LIGHTNING_WEB_COMPONENT)},dependencies:{data:n}});return[a.id,a]})));return s?.log("Done"),o}}class st extends w{async run(e,t,s){s?.log("Querying Tooling API about FlexiPage in the org...");const a=await e.soqlQuery([{tooling:!0,string:"SELECT Id, MasterLabel, EntityDefinition.QualifiedApiName, Type, NamespacePrefix, Description, CreatedDate, LastModifiedDate FROM FlexiPage WHERE ManageableState IN ('installedEditable', 'unmanaged') "}],s),r=t.getInstance(K),i=a[0];s?.log(`Retrieving dependencies of ${i.length} lightning pages...`);const n=await e.dependenciesQuery(await y.map(i,(t=>e.caseSafeId(t.Id))),s);s?.log(`Parsing ${i.length} lightning pages...`);const o=new Map(await y.map(i,(t=>{const s=e.caseSafeId(t.Id),a=r.createWithScore({properties:{id:s,name:t.MasterLabel,type:t.Type,package:t.NamespacePrefix||"",createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,description:t.Description,objectId:t.EntityDefinition?.QualifiedApiName||"",url:e.setupUrl(s,b.LIGHTNING_PAGE)},dependencies:{data:n}});return[a.id,a]})));return s?.log("Done"),o}}class at extends w{async run(e,t,s){s?.log("Querying REST API about Group in the org...");const a=await e.soqlQuery([{string:"SELECT Id, Name, DeveloperName, DoesIncludeBosses, Type, RelatedId, Related.Name, (SELECT UserOrGroupId From GroupMembers)FROM Group "}],s),r=t.getInstance(Y),i=a[0];s?.log(`Parsing ${i.length} groups...`);const n=new Map(await y.map(i,(async t=>{const s=e.caseSafeId(t.Id);let a,i,n,o,l,c;switch(t.Type){case"Regular":case"Queue":a="Regular"===t.Type?b.PUBLIC_GROUP:b.QUEUE,i=t.Name,n=t.DeveloperName,o=t.DoesIncludeBosses;break;case"Role":case"RoleAndSubordinates":case"RoleAndSubordinatesInternal":a=b.ROLE,i=t.Related.Name,l="Role"!==t.Type,c=e.caseSafeId(t.RelatedId);break;default:i=t.Type,a=b.TECHNICAL_GROUP}const d=[],p=[];t.GroupMembers&&t.GroupMembers.records&&t.GroupMembers.records.length>0&&await y.forEach(t.GroupMembers.records,(t=>{const s=e.caseSafeId(t.UserOrGroupId);(s.startsWith("005")?d:p).push(s)}));const g=r.createWithScore({properties:{id:s,name:i,developerName:n,type:a,isPublicGroup:"Regular"===t.Type,isQueue:"Queue"===t.Type,nbDirectMembers:d.length+p.length,directUserIds:d,directGroupIds:p,includeBosses:!0===o,includeSubordinates:!0===l,relatedId:c,url:e.setupUrl(c??s,a)}});return[g.id,g]})));return s?.log("Done"),n}}const rt=new RegExp("(\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*\\n|\\n)","gi"),it=new RegExp("(?:public|global)\\s+(?:interface)\\s+\\w+(\\s+(?:extends)\\s+\\w+)?\\s*\\{","i"),nt=new RegExp("(?:public|global)\\s+(?:enum)\\s+\\w+\\s*\\{","i"),ot=new RegExp("@IsTest\\s*\\(.*SeeAllData=true.*\\)","i"),lt=new RegExp("(System.assert(Equals|NotEquals|)\\s*\\(|Assert\\.[a-zA-Z]*\\s*\\()","ig");class ct extends w{async run(e,t,s){s?.log("Querying Tooling API about ApexClass, ApexCodeCoverage, ApexCodeCoverageAggregate and AsyncApexJob in the org...");const a=await e.soqlQuery([{string:"SELECT Id, Name, ApiVersion, NamespacePrefix, Body, LengthWithoutComments, SymbolTable, CreatedDate, LastModifiedDate FROM ApexClass WHERE ManageableState IN ('installedEditable', 'unmanaged') ",tooling:!0},{string:"SELECT ApexClassOrTriggerId, ApexTestClassId FROM ApexCodeCoverage",tooling:!0},{string:"SELECT ApexClassorTriggerId, NumLinesCovered, NumLinesUncovered, Coverage FROM ApexCodeCoverageAggregate",tooling:!0},{string:"SELECT ApexClassId FROM AsyncApexJob WHERE JobType = 'ScheduledApex' "},{string:"SELECT id, ApexClassId, MethodName, ApexTestRunResult.CreatedDate, RunTime, Outcome, StackTrace FROM ApexTestResult WHERE ApexTestRunResult.Status = 'Completed' AND ApexClass.ManageableState IN ('installedEditable', 'unmanaged') ORDER BY ApexClassId, ApexTestRunResult.CreatedDate desc, MethodName ",tooling:!0}],s),r=t.getInstance(E),i=t.getInstance(S),n=a[0],o=a[1],l=a[2],c=a[3],d=a[4];s?.log(`Retrieving dependencies of ${n.length} apex classes...`);const p=await e.dependenciesQuery(await y.map(n,(t=>e.caseSafeId(t.Id))),s);s?.log(`Parsing ${n.length} apex classes...`);const g=new Map(await y.map(n,(async t=>{const s=e.caseSafeId(t.Id),a=r.create({properties:{id:s,name:t.Name,apiVersion:t.ApiVersion,package:t.NamespacePrefix||"",isTest:!1,isAbstract:!1,isClass:!0,isEnum:!1,isInterface:!1,isSchedulable:!1,isScheduled:!1,length:t.LengthWithoutComments,sourceCode:t.Body,needsRecompilation:!t.SymbolTable,coverage:0,relatedTestClasses:[],relatedClasses:[],createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(s,b.APEX_CLASS)},dependencies:{data:p}});if(t.SymbolTable&&(a.innerClassesCount=t.SymbolTable.innerClasses?.length||0,a.interfaces=t.SymbolTable.interfaces,a.isSchedulable=t.SymbolTable.interfaces?.includes("System.Schedulable")??!1,a.methodsCount=t.SymbolTable.methods?.length||0,a.extends=t.SymbolTable.parentClass,t.SymbolTable.tableDeclaration&&(a.annotations=t.SymbolTable.tableDeclaration.annotations,await y.forEach(t.SymbolTable.tableDeclaration.modifiers,(e=>{switch(e){case"with sharing":a.specifiedSharing="with";break;case"without sharing":a.specifiedSharing="without";break;case"inherited sharing":a.specifiedSharing="inherited";break;case"public":a.specifiedAccess="public";break;case"private":a.specifiedAccess="private";break;case"global":a.specifiedAccess="global";break;case"virtual":a.specifiedAccess="virtual";break;case"abstract":a.isAbstract=!0;break;case"testMethod":a.isTest=!0;break;default:console.error(`Unsupported modifier in SymbolTable.tableDeclaration: ${e} (ApexClassId=${a.id})`)}})))),t.Body){const e=t.Body.replaceAll(rt," ");a.isInterface=null!==e.match(it),a.isEnum=null!==e.match(nt),a.isClass=!1===a.isInterface&&!1===a.isEnum,!0===a.isTest&&(a.isTestSeeAllData=null!==e.match(ot),a.nbSystemAsserts=e.match(lt)?.length||0)}return!0!==a.isEnum&&!0!==a.isInterface||(a.specifiedSharing="Not applicable"),[a.id,a]})));s?.log(`Parsing ${o.length} apex code coverages...`);const u=new Map,h=new Map;return await y.forEach(o,(t=>{const s=e.caseSafeId(t.ApexClassOrTriggerId),a=e.caseSafeId(t.ApexTestClassId);g.has(s)&&(!1===u.has(s)&&u.set(s,new Set),!1===h.has(a)&&h.set(a,new Set),u.get(s).add(a),h.get(a).add(s))})),await y.forEach(u,((e,t)=>{g.has(t)&&(g.get(t).relatedTestClassIds=Array.from(e))})),await y.forEach(h,((e,t)=>{g.has(t)&&(g.get(t).relatedClassIds=Array.from(e))})),s?.log(`Parsing ${l.length} apex code coverage aggregates...`),await y.forEach(l,(t=>{const s=e.caseSafeId(t.ApexClassOrTriggerId);g.has(s)&&(g.get(s).coverage=t.NumLinesCovered/(t.NumLinesCovered+t.NumLinesUncovered))})),s?.log(`Parsing ${c.length} schedule apex classes...`),await y.forEach(c,(t=>{const s=e.caseSafeId(t.ApexClassId);g.has(s)&&(g.get(s).isScheduled=!0)})),s?.log(`Parsing ${d.length} test results...`),await y.forEach(d,(t=>{const s=e.caseSafeId(t.ApexClassId);if(g.has(s)){const e=g.get(s);if(!0===e.isTest&&(e.lastTestRunDate||(e.lastTestRunDate=t.ApexTestRunResult?.CreatedDate,e.testMethodsRunTime=0,e.testPassedMethods=[],e.testFailedMethods=[]),e.lastTestRunDate===t.ApexTestRunResult?.CreatedDate)){const s=i.create({properties:{methodName:t.MethodName,isSuccessful:"Pass"===t.Outcome,runtime:t.RunTime,stacktrace:t.StackTrace}});e.testMethodsRunTime+=s.runtime,(s.isSuccessful?e.testPassedMethods:e.testFailedMethods).push(s)}}})),await y.forEach(g,(e=>{r.computeScore(e)})),s?.log("Done"),g}}const dt=new RegExp("(\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*\\n|\\n)","gi"),pt=new RegExp("\\[\\s*(?:SELECT|FIND)"),gt=new RegExp("(?:insert|update|delete)\\s*(?:\\s\\w+|\\(|\\[)");class ut extends w{async run(e,t,s){s?.log("Querying Tooling API about ApexTrigger in the org...");const a=await e.soqlQuery([{string:"SELECT Id, Name, ApiVersion, Status, NamespacePrefix, Body, UsageBeforeInsert, UsageAfterInsert, UsageBeforeUpdate, UsageAfterUpdate, UsageBeforeDelete, UsageAfterDelete, UsageAfterUndelete, UsageIsBulk, LengthWithoutComments, EntityDefinition.QualifiedApiName, CreatedDate, LastModifiedDate FROM ApexTrigger WHERE ManageableState IN ('installedEditable', 'unmanaged') ",tooling:!0}],s),r=t.getInstance(G),i=a[0];s?.log(`Retrieving dependencies of ${i.length} apex triggers...`);const n=await e.dependenciesQuery(await y.map(i,(t=>e.caseSafeId(t.Id))),s);s?.log(`Parsing ${i.length} apex triggers...`);const o=new Map(await y.map(i,(t=>{const s=e.caseSafeId(t.Id),a=r.create({properties:{id:s,name:t.Name,apiVersion:t.ApiVersion,package:t.NamespacePrefix||"",length:t.LengthWithoutComments,isActive:"Active"===t.Status,beforeInsert:t.UsageBeforeInsert,afterInsert:t.UsageAfterInsert,beforeUpdate:t.UsageBeforeUpdate,afterUpdate:t.UsageAfterUpdate,beforeDelete:t.UsageBeforeDelete,afterDelete:t.UsageAfterDelete,afterUndelete:t.UsageAfterUndelete,objectId:e.caseSafeId(t.EntityDefinition?.QualifiedApiName),hasSOQL:!1,hasDML:!1,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(s,b.APEX_TRIGGER,t.EntityDefinition?.QualifiedApiName)},dependencies:{data:n}});if(t.Body){const e=t.Body.replaceAll(dt," ");a.hasSOQL=null!==e.match(pt),a.hasDML=null!==e.match(gt)}return r.computeScore(a),[a.id,a]}),(e=>!!e.EntityDefinition)));return s?.log("Done"),o}}class ht extends w{async run(e,t,s){s?.log("Querying REST API about UserRole in the org...");const a=await e.soqlQuery([{string:"SELECT Id, DeveloperName, Name, ParentRoleId, PortalType, (SELECT Id, IsActive FROM Users) FROM UserRole "}],s),r=t.getInstance(ge),i=a[0];s?.log(`Parsing ${i.length} user roles...`);const n=new Map(await y.map(i,(async t=>{const s=e.caseSafeId(t.Id),a=r.create({properties:{id:s,name:t.Name,apiname:t.DeveloperName,parentId:t.ParentRoleId?e.caseSafeId(t.ParentRoleId):void 0,hasParent:!!t.ParentRoleId,activeMembersCount:0,activeMemberIds:[],hasActiveMembers:!1,inactiveMembersCount:0,hasInactiveMembers:!1,isExternal:"None"!==t.PortalType,url:e.setupUrl(s,b.ROLE)}});return await y.forEach(t?.Users?.records,(t=>{!0===t.IsActive?a.activeMemberIds.push(e.caseSafeId(t.Id)):a.inactiveMembersCount++})),a.activeMembersCount=a.activeMemberIds.length,a.hasActiveMembers=a.activeMemberIds.length>0,a.hasInactiveMembers=a.inactiveMembersCount>0,r.computeScore(a),[a.id,a]})));return s?.log("Done"),n}}class mt extends w{async run(e,t,s){s?.log("Querying Tooling API about FlowDefinition in the org...");const a=await e.soqlQuery([{string:"SELECT Id, MasterLabel, DeveloperName, ApiVersion, Description, ActiveVersionId, LatestVersionId, CreatedDate, LastModifiedDate FROM FlowDefinition",tooling:!0},{string:"SELECT Id, DefinitionId, Status, ProcessType FROM Flow where DefinitionId <> null",tooling:!0}],s),r=t.getInstance(H),i=t.getInstance(J),n=a[0],o=a[1];s?.log(`Retrieving dependencies of ${n.length} flow versions...`);const l=await e.dependenciesQuery(await y.map(n,(t=>e.caseSafeId(t.ActiveVersionId??t.LatestVersionId))),s),c=[];s?.log(`Parsing ${n.length} flow definitions...`);const d=new Map(await y.map(n,(t=>{const s=e.caseSafeId(t.Id),a=e.caseSafeId(t.ActiveVersionId),i=e.caseSafeId(t.LatestVersionId),n=r.create({properties:{id:s,name:t.DeveloperName,apiVersion:t.ApiVersion,currentVersionId:a??i,isLatestCurrentVersion:a===i,isVersionActive:!!a,versionsCount:0,description:t.Description,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(s,b.FLOW_DEFINITION)},dependencies:{data:l,idField:"currentVersionId"}});return c.push(n.currentVersionId),[n.id,n]})));s?.log(`Parsing ${o.length} flow versions...`),await y.forEach(o,(t=>{const s=e.caseSafeId(t.DefinitionId),a=d.get(s);a.versionsCount++,a.type=t.ProcessType})),s?.log(`Calling Tooling API Composite to get more information about these ${c.length} flow versions...`);const p=await e.readMetadataAtScale("Flow",c,["UNKNOWN_EXCEPTION"],s);return s?.log(`Parsing ${p.length} flow versions...`),await y.forEach(p,(async t=>{const s=e.caseSafeId(t.Id),a=e.caseSafeId(t.DefinitionId),r=i.create({properties:{id:s,name:t.FullName,version:t.VersionNumber,apiVersion:t.ApiVersion,totalNodeCount:["actionCalls","apexPluginCalls","assignments","collectionProcessors","decisions","loops","orchestratedStages","recordCreates","recordDeletes","recordLookups","recordRollbacks","recordUpdates","screens","steps","waits"].reduce(((e,s)=>e+t.Metadata[s]?.length||0),0),dmlCreateNodeCount:t.Metadata.recordCreates?.length||0,dmlDeleteNodeCount:t.Metadata.recordDeletes?.length||0,dmlUpdateNodeCount:t.Metadata.recordUpdates?.length||0,screenNodeCount:t.Metadata.screens?.length||0,isActive:"Active"===t.Status,description:t.Description,type:t.ProcessType,runningMode:t.RunInMode,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,url:e.setupUrl(s,b.FLOW_VERSION)}});await y.forEach(t.Metadata.processMetadataValues,(e=>{"ObjectType"===e.name&&(r.sobject=e.value.stringValue),"TriggerType"===e.name&&(r.triggerType=e.value.stringValue)}));d.get(a).currentVersionRef=r})),await y.forEach(d,(e=>r.computeScore(e))),s?.log("Done"),d}}class ft extends w{async run(e,t,s){s?.log("Querying Tooling API about WorkflowRule in the org...");const a=(await e.soqlQuery([{string:"SELECT Id FROM WorkflowRule",tooling:!0}],s))[0];s?.log(`Parsing ${a.length} Workflow Rules...`);const r=await y.map(a,(e=>e.Id)),i=t.getInstance(Se);s?.log(`Calling Tooling API Composite to get more information about these ${r.length} workflow rules...`);const n=await e.readMetadataAtScale("WorkflowRule",r,["UNKNOWN_EXCEPTION"],s);s?.log(`Parsing ${n.length} workflows...`);const o=new Map(await y.map(n,(async t=>{const s=e.caseSafeId(t.Id),a=i.create({properties:{id:s,name:t.FullName,description:t.Metadata.description,isActive:t.Metadata.active,createdDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,hasAction:!0,futureActions:[],emptyTimeTriggers:[],url:e.setupUrl(s,b.WORKFLOW_RULE)}}),r=t.Metadata.actions;a.actions=await y.map(r,(e=>({name:e.name,type:e.type})));const n=t.Metadata.workflowTimeTriggers;return await y.forEach(n,(async e=>{const t=e.offsetFromField||"TriggerDate";0===e.actions.length?a.emptyTimeTriggers.push({field:t,delay:`${e.timeLength} ${e.workflowTimeTriggerUnit}`}):await y.forEach(e.actions,(s=>{a.futureActions.push({name:s.name,type:s.type,field:t,delay:`${e.timeLength} ${e.workflowTimeTriggerUnit}`})}))})),a.hasAction=a.actions.length+a.futureActions.length>0,i.computeScore(a),[a.id,a]})));return s?.log("Done"),o}}const St=(e,t)=>Object.prototype.isPrototypeOf.call(t,e),Et=(e,t,s=3)=>!!(t&&e&&s)&&(e-t)/3>=s,It=e=>("number"!=typeof e||0!==e)&&(!e||(0===e.length||"string"==typeof e&&0===e.trim().length));class wt extends c{_allScoreRules;_instances;constructor(e){super();const t=e.apiVersion;let s=0;this._allScoreRules=[{id:s++,description:"Not referenced anywhere",formula:e=>!1===e.dependencies?.hadError&&It(e.dependencies?.referenced),errorMessage:"This component is not referenced anywhere (as we were told by the Dependency API). Please review the need to keep it in your org.",badField:"dependencies.referenced.length",applicable:[k,H,K,X,z,he,me]},{id:s++,description:"No reference anywhere for custom field",formula:e=>!0===e.isCustom&&!1===e.dependencies?.hadError&&It(e.dependencies?.referenced),errorMessage:"This custom field is not referenced anywhere (as we were told by the Dependency API). Please review the need to keep it in your org.",badField:"dependencies.referenced.length",applicable:[j]},{id:s++,description:"No reference anywhere for apex class",formula:e=>!1===e.isTest&&!1===e.dependencies?.hadError&&It(e.dependencies?.referenced),errorMessage:"This apex class is not referenced anywhere (as we were told by the Dependency API). Please review the need to keep it in your org.",badField:"dependencies.referenced.length",applicable:[E]},{id:s++,description:"Sorry, we had an issue with the Dependency API to gather the dependencies of this item",formula:e=>e.dependencies&&!0===e.dependencies.hadError,errorMessage:"Sorry, we had an issue with the Dependency API to gather the dependencies of this item.",badField:"dependencies.referenced.length",applicable:[j,E,k,H,K,X,z,he,me]},{id:s++,description:"API Version too old",formula:e=>Et(t,e.apiVersion),errorMessage:"The API version of this component is too old. Please update it to a newest version.",badField:"apiVersion",applicable:[E,G,H,X,z,me,he]},{id:s++,description:"No assert in this Apex Test",formula:e=>!0===e.isTest&&0===e.nbSystemAsserts,errorMessage:"This apex test does not contain any assert! Best practices force you to define asserts in tests.",badField:"nbSystemAsserts",applicable:[E]},{id:s++,description:"No description",formula:e=>It(e.description),errorMessage:"This component does not have a description. Best practices force you to use the Description field to give some informative context about why and how it is used/set/govern.",badField:"description",applicable:[H,K,X,z,me,he,Se,q,ue]},{id:s++,description:"No description for custom component",formula:e=>!0===e.isCustom&&It(e.description),errorMessage:"This custom component does not have a description. Best practices force you to use the Description field to give some informative context about why and how it is used/set/govern.",badField:"description",applicable:[j,W,B]},{id:s++,description:"No explicit sharing in apex class",formula:e=>!1===e.isTest&&!0===e.isClass&&!e.specifiedSharing,errorMessage:"This Apex Class does not specify a sharing model. Best practices force you to specify with, without or inherit sharing to better control the visibility of the data you process in Apex.",badField:"specifiedSharing",applicable:[E]},{id:s++,description:"Schedulable should be scheduled",formula:e=>!1===e.isScheduled&&!0===e.isSchedulable,errorMessage:"This Apex Class implements Schedulable but is not scheduled. What is the point? Is this class still necessary?",badField:"isScheduled",applicable:[E]},{id:s++,description:"Not able to compile class",formula:e=>!0===e.needsRecompilation,errorMessage:"This Apex Class can not be compiled for some reason. You should try to recompile it. If the issue remains you need to consider refactorying this class or the classes that it is using.",badField:"name",applicable:[E]},{id:s++,description:"No coverage for this class",formula:e=>!1===e.isTest&&(isNaN(e.coverage)||!e.coverage),errorMessage:"This Apex Class does not have any code coverage. Consider launching the corresponding tests that will bring some coverage. If you do not know which test to launch just run them all!",badField:"coverage",applicable:[E]},{id:s++,description:"Coverage not enough",formula:e=>e.coverage>0&&e.coverage<.75,errorMessage:"This Apex Class does not have enough code coverage (less than 75% of lines are covered by successful unit tests). Maybe you ran not all the unit tests to cover this class entirely? If you did, then consider augmenting that coverage with new test methods.",badField:"coverage",applicable:[E]},{id:s++,description:"At least one testing method failed",formula:e=>!0===e.isTest&&e.testFailedMethods&&e.testFailedMethods.length>0,errorMessage:"This Apex Test Class has at least one failed method.",badField:"testFailedMethods",applicable:[E]},{id:s++,description:"Apex trigger should not contain SOQL statement",formula:e=>!0===e.hasSOQL,errorMessage:"This Apex Trigger contains at least one SOQL statement. Best practices force you to move any SOQL statement in dedicated Apex Classes that you would call from the trigger. Please update the code accordingly.",badField:"hasSOQL",applicable:[G]},{id:s++,description:"Apex trigger should not contain DML action",formula:e=>!0===e.hasDML,errorMessage:"This Apex Trigger contains at least one DML action. Best practices force you to move any DML action in dedicated Apex Classes that you would call from the trigger. Please update the code accordingly.",badField:"hasDML",applicable:[G]},{id:s++,description:"Apex Trigger should not contain logic",formula:e=>e.length>5e3,errorMessage:"Due to the massive number of source code (more than 5000 characters) in this Apex Trigger, we suspect that it contains logic. Best practices force you to move any logic in dedicated Apex Classes that you would call from the trigger. Please update the code accordingly.",badField:"length",applicable:[G]},{id:s++,description:"No direct member for this group",formula:e=>!e.nbDirectMembers||0===e.nbDirectMembers,errorMessage:"This public group (or queue) does not contain any direct members (users or sub groups). Is it empty on purpose? Maybe you should review its use in your org...",badField:"nbDirectMembers",applicable:[Y]},{id:s++,description:"Custom permset or profile with no member",formula:e=>!0===e.isCustom&&0===e.memberCounts,errorMessage:"This custom permission set (or custom profile) has no members. Is it empty on purpose? Maybe you should review its use in your org...",badField:"memberCounts",applicable:[W,B]},{id:s++,description:"Role with no active users",formula:e=>0===e.activeMembersCount,errorMessage:"This role has no active users assigned to it. Is it on purpose? Maybe you should review its use in your org...",badField:"activeMembersCount",applicable:[ge]},{id:s++,description:"Active user not under LEX",formula:e=>!1===e.onLightningExperience,errorMessage:"This user is still using Classic. Time to switch to Lightning for all your users, don't you think?",badField:"onLightningExperience",applicable:[pe]},{id:s++,description:"Active user never logged",formula:e=>null===e.lastLogin,errorMessage:"This active user never logged yet. Time to optimize your licence cost!",badField:"lastLogin",applicable:[pe]},{id:s++,description:"Workflow with no action",formula:e=>!1===e.hasAction,errorMessage:"This workflow has no action, please review it and potentially remove it.",badField:"hasAction",applicable:[Se]},{id:s++,description:"Workflow with empty time triggered list",formula:e=>e.emptyTimeTriggers.length>0,errorMessage:"This workflow is time triggered but with no time triggered action, please review it.",badField:"emptyTimeTriggers",applicable:[Se]},{id:s++,description:"Password policy with question containing password!",formula:e=>!0===e.passwordQuestion,errorMessage:"This profile password policy allows to have password in the question! Please change that setting as it is clearly a lack of security in your org!",badField:"passwordQuestion",applicable:[ne]},{id:s++,description:"Password policy with too big expiration",formula:e=>e.passwordExpiration>90,errorMessage:"This profile password policy allows to have password that expires after 90 days. Please consider having a shorter period of time for expiration if you policy.",badField:"passwordExpiration",applicable:[ne]},{id:s++,description:"Password policy with no expiration",formula:e=>0===e.passwordExpiration,errorMessage:"This profile password policy allows to have password that never expires. Why is that? Do you have this profile for technical users? Please reconsider this setting and use JWT authentication instead for technical users.",badField:"passwordExpiration",applicable:[ne]},{id:s++,description:"Password history too small",formula:e=>e.passwordHistory<3,errorMessage:"This profile password policy allows users to set their password with a too-short memory. For example, they can keep on using the same different password everytime you ask them to change it. Please increase this setting.",badField:"passwordHistory",applicable:[ne]},{id:s++,description:"Password minimum size too small",formula:e=>e.minimumPasswordLength<8,errorMessage:"This profile password policy allows users to set passwords with less than 8 charcaters. That minimum length is not strong enough. Please increase this setting.",badField:"minimumPasswordLength",applicable:[ne]},{id:s++,description:"Password complexity too weak",formula:e=>e.passwordComplexity<3,errorMessage:"This profile password policy allows users to set too-easy passwords. The complexity you choose is not storng enough. Please increase this setting.",badField:"passwordComplexity",applicable:[ne]},{id:s++,description:"No max login attempts set",formula:e=>void 0===e.maxLoginAttempts,errorMessage:"This profile password policy allows users to try infinitely to log in without locking the access. Please review this setting.",badField:"passwordExpiration",applicable:[ne]},{id:s++,description:"No lockout period set",formula:e=>void 0===e.lockoutInterval,errorMessage:"This profile password policy does not set a value for any locked out period. Please review this setting.",badField:"lockoutInterval",applicable:[ne]},{id:s++,description:"IP Range too large",formula:e=>e.ipRanges.filter((e=>e.difference>1e5)).length>0,errorMessage:"This profile includes an IP range that is to wide (more than 100.000 IP addresses!). If you set an IP Range it should be not that large. You could split that range into multiple ones. The risk is that you include an IP that is not part of your company. Please review this setting.",badField:"ipRanges",applicable:[oe]},{id:s++,description:"Login hours too large",formula:e=>e.loginHours.filter((e=>e.difference>1200)).length>0,errorMessage:"This profile includes a login hour that is to wide (more than 20 hours a day!). If you set a login hour it should reflect the reality. Please review this setting.",badField:"loginHours",applicable:[oe]},{id:s++,description:"Inactive component",formula:e=>!1===e.isActive,errorMessage:"This component is inactive, so why do not you just remove it from your org?",badField:"isActive",applicable:[ue,de,G,Se]},{id:s++,description:"No active version for this flow",formula:e=>!1===e.isVersionActive,errorMessage:"This flow does not have an active version, did you forgot to activate its latest version? or you do not need that flow anymore?",badField:"isVersionActive",applicable:[H]},{id:s++,description:"Too many versions under this flow",formula:e=>e.versionsCount>7,errorMessage:"This flow has more than seven versions. Maybe it is time to do some cleaning in this flow!",badField:"versionsCount",applicable:[H]},{id:s++,description:"Migrate this process builder",formula:e=>"Workflow"===e.currentVersionRef?.type,errorMessage:"Time to migrate this process builder to flow!",badField:"name",applicable:[H]},{id:s++,description:"No description for the current version of a flow",formula:e=>It(e.currentVersionRef?.description),errorMessage:"This flow's current version does not have a description. Best practices force you to use the Description field to give some informative context about why and how it is used/set/govern.",badField:"currentVersionRef.description",applicable:[H]},{id:s++,description:"API Version too old for the current version of a flow",formula:e=>Et(t,e.currentVersionRef?.apiVersion),errorMessage:"The API version of this flow's current version is too old. Please update it to a newest version.",badField:"currentVersionRef.apiVersion",applicable:[H]},{id:s++,description:"This flow is running without sharing",formula:e=>"SystemModeWithoutSharing"===e.currentVersionRef?.runningMode,errorMessage:"The running mode of this version without sharing. With great power comes great responsabilities. Please check if this is REALLY needed.",badField:"currentVersionRef.runningMode",applicable:[H]},{id:s++,description:"Too many nodes in this version",formula:e=>e.currentVersionRef?.totalNodeCount>100,errorMessage:"There are more than one hundred of nodes in this flow. Please consider using Apex? or cut it into multiple sub flows?",badField:"currentVersionRef.totalNodeCount",applicable:[H]},{id:s++,description:"Near the limit",formula:e=>e.usedPercentage>=.8,errorMessage:"This limit is almost reached (>80%). Please review this.",badField:"usedPercentage",applicable:[Z]},{id:s++,description:"Almost all licenses are used",formula:e=>e.usedPercentage>=.8,errorMessage:"The number of seats for this license is almost reached (>80%). Please review this.",badField:"usedPercentage",applicable:[ie]},{id:s++,description:"You could have licenses to free up",formula:e=>e.distinctActiveAssigneeCount!==e.usedCount,errorMessage:"The Used count from that permission set license does not match the number of disctinct active user assigned to the same license. Please check if you could free up some licenses!",badField:"distinctActiveAssigneeCount",applicable:[ie]}],Object.freeze(this._allScoreRules),this._instances=new Map}getScoreRule(e){return this._allScoreRules[e]}getAllScoreRules(){return this._allScoreRules}getInstance(e){const t=St(e,n),s=St(e,o),a=St(e,l);if(!1===t&&!1===a&&!1===s)throw new TypeError("Given dataClass does not extends Data nor DataWithDependencies nor DataWithoutScoring");return!1===this._instances.has(e)&&this._instances.set(e,new Pt(e,t?this._allScoreRules.filter((t=>t.applicable?.includes(e))):[],s)),this._instances.get(e)}}class Pt extends d{_dataClass;_scoreRules;_isDependenciesNeeded;constructor(e,t,s){super(),this._dataClass=e,this._scoreRules=t,this._isDependenciesNeeded=s}create(e){if(!e)throw new TypeError("Configuration can't be null.");if(!e.properties)throw new TypeError("Configuration.properties can't be null.");const t=new this._dataClass;return Object.keys(t).forEach((s=>{t[s]=e.properties[s]})),Object.seal(t),this._scoreRules.length>0&&(t.score=0,t.badFields=[],t.badReasonIds=[]),!0===this._isDependenciesNeeded&&e.dependencies&&(t.dependencies=a.create(e.dependencies.data,t[e.dependencies.idField||"id"])),t}computeScore(e){return this._scoreRules.filter((t=>{try{if(!0===t.formula(e))return!0}catch(t){console.error("COMPUTE SCORE",t,e)}return!1})).forEach((t=>{e.score++,e.badFields.push(t.badField),e.badReasonIds.push(t.id)})),e}createWithScore(e){return this.computeScore(this.create(e))}}class Tt extends w{async run(e,t,s){s?.log("Querying REST API about Applications (tab set typed) in the org...");const a=await e.soqlQuery([{string:"SELECT ApplicationId, Name, Label, NamespacePrefix FROM AppMenuItem WHERE Type = 'TabSet' "}],s),r=t.getInstance($),i=a[0];s?.log(`Parsing ${i.length} applications...`);const n=new Map(await y.map(i,(t=>{const s=e.caseSafeId(t.ApplicationId);return[s,r.create({properties:{id:s,name:t.Name,label:t.Label,package:t.NamespacePrefix||""}})]})));return s?.log("Done"),n}}class yt extends w{async run(e,t,s,a){const r=a?.get("object");s?.log("Querying REST API about SetupEntityAccess for TabSet in the org...");const i=await e.soqlQuery([{string:`SELECT Field, PermissionsRead, PermissionsEdit, ParentId, Parent.IsOwnedByProfile, Parent.ProfileId FROM FieldPermissions WHERE SObjectType = '${r}' `}],s),n=t.getInstance(Q),o=i[0];s?.log(`Parsing ${o.length} Field Permissions...`);const l=new Map(await y.map(o,(t=>{const s=e.caseSafeId(t.Parent.IsOwnedByProfile?t.Parent.ProfileId:t.ParentId),a=t.Field.indexOf("."),r=-1===a?t.Field:t.Field.substring(a+1),i=n.create({properties:{fieldApiName:r,parentId:s,isRead:t.PermissionsRead,isEdit:t.PermissionsEdit}});return[`${t.Field}-${s}`,i]})));return s?.log("Done"),l}}class Rt extends w{async run(e,t,s){s?.log("Querying Tooling API about Validaiton Rules in the org...");const a=await e.soqlQuery([{string:"SELECT Id, Active, Description, ErrorDisplayField, ErrorMessage, ValidationName, EntityDefinition.QualifiedApiName FROM ValidationRule",tooling:!0}],s),r=t.getInstance(ue),i=a[0];s?.log(`Parsing ${i.length} validation rules...`);const n=new Map(await y.map(i,(async t=>{const s=e.caseSafeId(t.Id),a=r.createWithScore({properties:{id:e.caseSafeId(s),name:t.ValidationName,isActive:t.Active,description:t.Description,errorDisplayField:t.ErrorDisplayField,errorMessage:t.ErrorMessage,objectId:t.EntityDefinition?.QualifiedApiName,url:e.setupUrl(s,b.VALIDATION_RULE)}});return[a.id,a]})));return s?.log("Done"),n}}class Ct extends w{async run(e,t,s){s?.log("Querying REST API about PermissionSetLicenses in the org...");const a=await e.soqlQuery([{string:"SELECT Id, MasterLabel, CreatedDate, LastModifiedDate, TotalLicenses, Status, ExpirationDate, UsedLicenses, IsAvailableForIntegrations FROM PermissionSetLicense "},{string:"SELECT Id, LicenseId FROM PermissionSet WHERE IsOwnedByProfile = false AND LicenseId <> NULL "},{string:"SELECT AssigneeId, PermissionSet.LicenseId FROM PermissionSetAssignment WHERE Assignee.IsActive = TRUE AND PermissionSet.LicenseId <> NULL AND PermissionSet.IsOwnedByProfile = FALSE ORDER BY PermissionSetId "}],s),r=t.getInstance(ie),i=a[0],n=a[1],o=a[2];s?.log(`Parsing ${i.length} permission sets licenses...`);const l=new Map(await y.map(i,(t=>{const s=e.caseSafeId(t.Id),a=r.create({properties:{id:s,name:t.MasterLabel,createDate:t.CreatedDate,lastModifiedDate:t.LastModifiedDate,totalCount:t.TotalLicenses,usedCount:t.UsedLicenses,usedPercentage:t.UsedLicenses/t.TotalLicenses,remainingCount:t.TotalLicenses-t.UsedLicenses,permissionSetIds:[],distinctActiveAssigneeCount:0,status:t.Status,expirationDate:t.ExpirationDate,isAvailableForIntegrations:t.IsAvailableForIntegrations,url:e.setupUrl(s,b.PERMISSION_SET_LICENSE)}});return[a.id,a]})));s?.log(`Parsing ${o.length} Permission Sets with a link to a License...`);const c=new Map;return await y.forEach(o,(t=>{if(t.PermissionSet&&t.PermissionSet.LicenseId&&t.PermissionSet.LicenseId.startsWith("0PL")){const s=e.caseSafeId(t.PermissionSet.LicenseId),a=e.caseSafeId(t.AssigneeId);!1===c.has(s)&&c.set(s,new Set),c.get(s).add(a),l.get(s).distinctActiveAssigneeCount=c.get(s).size}})),s?.log(`Parsing ${n.length} Permission Sets with a link to a License...`),await y.forEach(n,(t=>{const s=e.caseSafeId(t.Id),a=e.caseSafeId(t.LicenseId);l.has(a)&&l.get(a).permissionSetIds.push(s)})),s?.log(`Computing the score for ${l.size} permission set licenses...`),await y.forEach(l,(e=>{r.computeScore(e)})),s?.log("Done"),l}}class At extends P{_datasets;_datasetPromisesCache;_dataCache;_sfdcManager;_logger;_dataFactory;constructor(e,t,s){if(super(),e instanceof I==!1)throw new TypeError("The given sfdcManager is not an instance of SalesforceManagerIntf.");if(s instanceof u==!1)throw new TypeError("The given logger is not an instance of LoggerIntf.");this._sfdcManager=e,this._logger=s,this._dataCache=t,this._datasets=new Map,this._datasetPromisesCache=new Map,this._dataFactory=new wt(e),this._datasets.set(T.APEXCLASSES,new ct),this._datasets.set(T.APEXTRIGGERS,new ut),this._datasets.set(T.APPLICATIONS,new Tt),this._datasets.set(T.APPPERMISSIONS,new Fe),this._datasets.set(T.CURRENTUSERPERMISSIONS,new ke),this._datasets.set(T.CUSTOMFIELDS,new _e),this._datasets.set(T.CUSTOMLABELS,new De),this._datasets.set(T.FIELDPERMISSIONS,new yt),this._datasets.set(T.FLOWS,new mt),this._datasets.set(T.GROUPS,new at),this._datasets.set(T.LIGHTNINGAURACOMPONENTS,new et),this._datasets.set(T.LIGHTNINGPAGES,new st),this._datasets.set(T.LIGHTNINGWEBCOMPONENTS,new tt),this._datasets.set(T.OBJECT,new Le),this._datasets.set(T.OBJECTPERMISSIONS,new Ne),this._datasets.set(T.OBJECTS,new xe),this._datasets.set(T.OBJECTTYPES,new Ue),this._datasets.set(T.ORGANIZATION,new Ve),this._datasets.set(T.PACKAGES,new je),this._datasets.set(T.PERMISSIONSETS,new Qe),this._datasets.set(T.PERMISSIONSETLICENSES,new Ct),this._datasets.set(T.PROFILEPWDPOLICIES,new Xe),this._datasets.set(T.PROFILERESTRICTIONS,new Ye),this._datasets.set(T.PROFILES,new qe),this._datasets.set(T.USERROLES,new ht),this._datasets.set(T.USERS,new Ke),this._datasets.set(T.VALIDATIONRULES,new Rt),this._datasets.set(T.VISUALFORCECOMPONENTS,new Ze),this._datasets.set(T.VISUALFORCEPAGES,new ze),this._datasets.set(T.WORKFLOWS,new ft)}async run(e){if(e instanceof Array==!1)throw new TypeError("The given datasets is not an instance of Array.");return new Map(await Promise.all(e.map((e=>{const t="string"==typeof e?e:e.alias,s="string"==typeof e?e:e.cacheKey,a="string"==typeof e?void 0:e.parameters,r=`DATASET ${t}`;return!1===this._datasetPromisesCache.has(s)&&this._datasetPromisesCache.set(s,new Promise(((e,i)=>{this._logger.log(r,`Checking the data cache for key=${s}...`),!0===this._dataCache.has(s)?(this._logger.ended(r,"There was data in data cache, we use it!"),e([t,this._dataCache.get(s)])):(this._logger.log(r,"There was no data in data cache. Let's retrieve data."),this._datasets.get(t).run(this._sfdcManager,this._dataFactory,this._logger.toSimpleLogger(r),a).then((a=>{this._dataCache.set(s,a),this._logger.ended(r,`Data retrieved and saved in cache with key=${s}`),e([t,a])})).catch((e=>{this._logger.failed(r,e),i(e)})))}))),this._datasetPromisesCache.get(s)}))))}clean(e){if(e instanceof Array==!1)throw new TypeError("The given datasets is not an instance of Array.");e.forEach((e=>{const t="string"==typeof e?e:e.cacheKey;this._dataCache.remove(t),this._datasetPromisesCache.delete(t)}))}getScoreRule(e){return this._dataFactory.getScoreRule(e)}getAllScoreRules(){return this._dataFactory.getAllScoreRules()}}class bt extends u{_logger;_operationNames;_countSuccesses;_countFailures;constructor(e){super(),this._logger=e,this._countSuccesses=0,this._countFailures=0,this._operationNames=new Map}log(e,t){Ot(e,"LOG",t),this._logger?.log(e,t),this._operationNames.set(e,0)}ended(e,t){Ot(e,"ENDED",t),this._countSuccesses++,this._logger?.ended(e,t),this._operationNames.set(e,1)}failed(e,t){Ot(e,"FAILED",t),this._countFailures++,this._logger?.failed(e,t),this._operationNames.set(e,2)}toSimpleLogger(e){const t=this._logger;return{log:s=>{Ot(e,"LOG",s),t?.log(e,s)},debug:t=>{Ot(e,"DEBUG",t)}}}}const Ot=(e,t,s="...")=>{console.error(`${(new Date).toISOString()} - ${e} - ${t} - ${s}`)};class Mt extends R{extract(e){return[T.USERS,T.PROFILES,T.PERMISSIONSETS]}async transform(e,t){const s=e.get(T.USERS),a=e.get(T.PROFILES),r=e.get(T.PERMISSIONSETS);if(!s)throw new Error("Data from dataset alias 'USERS' was undefined.");if(!a)throw new Error("Data from dataset alias 'PROFILES' was undefined.");if(!r)throw new Error("Data from dataset alias 'PERMISSIONSETS' was undefined.");return await y.forEach(s,(async e=>{e.profileRef=a.get(e.profileId),e.permissionSetRefs=await y.map(e.permissionSetIds,(e=>r.get(e)),(e=>r.has(e))),e.aggregateImportantPermissions={},e.profileRef?.importantPermissions&&Object.keys(e.profileRef.importantPermissions).filter((t=>!0===e.profileRef.importantPermissions[t])).forEach((t=>{e.aggregateImportantPermissions[t]=[e.profileRef]})),await y.forEach(e.permissionSetRefs,(t=>{Object.keys(t.importantPermissions).filter((e=>!0===t.importantPermissions[e])).forEach((s=>{e.aggregateImportantPermissions[s]||(e.aggregateImportantPermissions[s]=[]),e.aggregateImportantPermissions[s].push(t)}))}))})),[...s.values()]}}class _t extends R{extract(e){return[T.APEXCLASSES]}async transform(e,t,s){const a=e.get(T.APEXCLASSES);if(!a)throw new Error("Data from dataset alias 'APEXCLASSES' was undefined.");const r=[];return await y.forEach(a,(async e=>{const t=await Promise.all([y.map(e.relatedTestClassIds,(e=>a.get(e))),y.map(e.relatedClassIds,(e=>a.get(e)))]);e.relatedTestClassRefs=t[0],e.relatedClassRefs=t[1],"*"!==s&&e.package!==s||!1!==e.isTest||!1!==e.needsRecompilation||r.push(e)})),r}}class Dt extends R{extract(e){return[T.APEXTRIGGERS,T.OBJECTS]}async transform(e,t,s){const a=e.get(T.APEXTRIGGERS),r=e.get(T.OBJECTS);if(!a)throw new Error("Data from dataset alias 'APEXTRIGGERS' was undefined.");if(!r)throw new Error("Data from dataset alias 'OBJECTS' was undefined.");const i=[];return await y.forEach(a,(e=>{e.objectRef=r.get(e.objectId),"*"!==s&&e.package!==s||i.push(e)})),i}}class Lt extends R{extract(e){return[T.APPLICATIONS,T.APPPERMISSIONS,T.PROFILES,T.PERMISSIONSETS]}async transform(e,t,s){const a=e.get(T.APPLICATIONS),i=e.get(T.APPPERMISSIONS),n=e.get(T.PROFILES),o=e.get(T.PERMISSIONSETS);if(!a)throw new Error("Data from dataset alias 'APPLICATIONS' was undefined.");if(!i)throw new Error("Data from dataset alias 'APPPERMISSIONS' was undefined.");if(!n)throw new Error("Data from dataset alias 'PROFILES' was undefined.");if(!o)throw new Error("Data from dataset alias 'PERMISSIONSETS' was undefined.");const l=r.create();return await y.forEach(i,(e=>{e.appRef=a.get(e.appId),!0===e.parentId.startsWith("0PS")?e.parentRef=o.get(e.parentId):e.parentRef=n.get(e.parentId),"*"!==s&&e.parentRef.package!==s&&e.appRef.appPackage!==s||(!1===l.hasRowHeader(e.parentId)&&l.setRowHeader(e.parentId,e.parentRef),!1===l.hasColumnHeader(e.appId)&&l.setColumnHeader(e.appId,e.appRef),l.addValueToProperty(e.parentId,e.appId,(e.isAccessible?"A":"")+(e.isVisible?"V":"")))})),l.toDataMatrix()}}class Nt extends R{extract(e,t){const s=new p(T.CURRENTUSERPERMISSIONS,T.CURRENTUSERPERMISSIONS);return s.parameters.set("permissions",t),[s]}async transform(e,t){const s=e.get(T.CURRENTUSERPERMISSIONS);if(!s)throw new Error("Data from dataset alias 'CURRENTUSERPERMISSIONS' was undefined.");return s}}class Ft extends R{extract(e){return[T.CUSTOMFIELDS,T.OBJECTTYPES,T.OBJECTS]}async transform(e,t,s,a,r){const i=e.get(T.OBJECTTYPES),n=e.get(T.OBJECTS),o=e.get(T.CUSTOMFIELDS);if(!i)throw new Error("Data from dataset alias 'OBJECTTYPES' was undefined.");if(!n)throw new Error("Data from dataset alias 'OBJECTS' was undefined.");if(!o)throw new Error("Data from dataset alias 'CUSTOMFIELDS' was undefined.");await y.forEach(o,(e=>{const t=n.get(e.objectId);t&&!t.typeRef&&(t.typeRef=i.get(t.typeId)),e.objectRef=t}));const l=[];return await y.forEach(o,(e=>{"*"!==s&&e.package!==s||"*"!==a&&e.objectRef?.typeRef?.id!==a||"*"!==r&&e.objectRef?.apiname!==r||l.push(e)})),l}}class xt extends R{extract(e){return[T.CUSTOMLABELS]}async transform(e,t,s){const a=e.get(T.CUSTOMLABELS);if(!a)throw new Error("Data from dataset alias 'CUSTOMLABELS' was undefined.");const r=[];return await y.forEach(a,(e=>{"*"!==s&&e.package!==s||r.push(e)})),r}}class vt extends R{extract(e){return[T.FLOWS]}async transform(e,t){const s=e.get(T.FLOWS);if(!s)throw new Error("Data from dataset alias 'FLOWS' was undefined.");const a=[];return await y.forEach(s,(e=>{"Workflow"!==e.type&&a.push(e)})),a}}class Ut extends R{extract(e){return[T.LIGHTNINGAURACOMPONENTS]}async transform(e,t,s){const a=e.get(T.LIGHTNINGAURACOMPONENTS);if(!a)throw new Error("Data from dataset alias 'LIGHTNINGAURACOMPONENTS' was undefined.");const r=[];return await y.forEach(a,(e=>{"*"!==s&&e.package!==s||r.push(e)})),r}}class Gt extends R{extract(e){return[T.LIGHTNINGPAGES,T.OBJECTS]}async transform(e,t,s){const a=e.get(T.LIGHTNINGPAGES),r=e.get(T.OBJECTS);if(!a)throw new Error("Data from dataset alias 'LIGHTNINGPAGES' was undefined.");if(!r)throw new Error("Data from dataset alias 'OBJECTS' was undefined.");const i=[];return await y.forEach(a,(e=>{e.objectId&&(e.objectRef=r.get(e.objectId)),"*"!==s&&e.package!==s||i.push(e)})),i}}class $t extends R{extract(e){return[T.LIGHTNINGWEBCOMPONENTS]}async transform(e,t,s){const a=e.get(T.LIGHTNINGWEBCOMPONENTS);if(!a)throw new Error("Data from dataset alias 'LIGHTNINGWEBCOMPONENTS' was undefined.");const r=[];return await y.forEach(a,(e=>{"*"!==s&&e.package!==s||r.push(e)})),r}}class Bt extends R{extract(e,t){const s=new p(T.OBJECT,`${T.OBJECT}_${t}`),a=new p(T.CUSTOMFIELDS,`${T.CUSTOMFIELDS}_${t}`);return s.parameters.set("object",t),a.parameters.set("object",t),[s,T.OBJECTTYPES,T.APEXTRIGGERS,T.LIGHTNINGPAGES,a]}async transform(e,t){const s=e.get(T.OBJECTTYPES),a=e.get(T.OBJECT),r=e.get(T.APEXTRIGGERS),i=e.get(T.LIGHTNINGPAGES),n=e.get(T.CUSTOMFIELDS);if(!s)throw new Error("Data from dataset alias 'OBJECTTYPES' was undefined.");if(!a)throw new Error("Data from dataset alias 'OBJECT' was undefined.");if(!r)throw new Error("Data from dataset alias 'APEXTRIGGERS' was undefined.");if(!i)throw new Error("Data from dataset alias 'LIGHTNINGPAGES' was undefined.");if(!n)throw new Error("Data from dataset alias 'CUSTOMFIELDS' was undefined.");a.typeRef=s.get(a.typeId),a.flexiPages=[];const o=await Promise.all([y.map(a.apexTriggerIds,(e=>{const t=r.get(e);return t.objectRef=a,t}),(e=>r.has(e))),y.forEach(i,(e=>{e.objectId===a.id&&a.flexiPages.push(e)})),y.map(a.customFieldIds,(e=>{const t=n.get(e);return t.objectRef=a,t}),(e=>n.has(e)))]);return a.apexTriggerRefs=o[0],a.customFieldRefs=o[2],a}}class Wt extends R{extract(e){return[T.OBJECTPERMISSIONS,T.PROFILES,T.PERMISSIONSETS]}async transform(e,t,s){const a=e.get(T.OBJECTPERMISSIONS),i=e.get(T.PROFILES),n=e.get(T.PERMISSIONSETS);if(!a)throw new Error("Data from dataset alias 'OBJECTPERMISSIONS' was undefined.");if(!i)throw new Error("Data from dataset alias 'PROFILES' was undefined.");if(!n)throw new Error("Data from dataset alias 'PERMISSIONSETS' was undefined.");const o=r.create();return await y.forEach(a,(e=>{!0===e.parentId.startsWith("0PS")?e.parentRef=n.get(e.parentId):e.parentRef=i.get(e.parentId),"*"!==s&&e.parentRef.package!==s||(!1===o.hasRowHeader(e.parentId)&&o.setRowHeader(e.parentId,e.parentRef),o.addValueToProperty(e.parentId,e.objectType,(e.isCreate?"C":"")+(e.isRead?"R":"")+(e.isEdit?"U":"")+(e.isDelete?"D":"")+(e.isViewAll?"v":"")+(e.isModifyAll?"m":"")))})),o.toDataMatrix()}}class Vt extends R{extract(e){return[T.OBJECTTYPES,T.OBJECTS]}async transform(e,t,s,a){const r=e.get(T.OBJECTTYPES),i=e.get(T.OBJECTS);if(!r)throw new Error("Data from dataset alias 'OBJECTTYPES' was undefined.");if(!i)throw new Error("Data from dataset alias 'OBJECTS' was undefined.");const n=[];return await y.forEach(i,(e=>{e.typeRef=r.get(e.typeId),"*"!==s&&e.package!==s||"*"!==a&&e.typeRef?.id!==a||n.push(e)})),n.sort(((e,t)=>e.label<t.label?-1:1))}}class kt extends R{extract(e){return[T.OBJECTTYPES]}async transform(e,t){const s=e.get(T.OBJECTTYPES);if(!s)throw new Error("Data from dataset alias 'OBJECTTYPES' was undefined.");return[...s.values()]}}class jt extends R{extract(e){return[T.ORGANIZATION]}async transform(e,t){const s=e.get(T.ORGANIZATION);if(!s)throw new Error("Data from dataset alias 'ORGANIZATION' was undefined.");return s}}class Qt extends R{extract(e){return[T.PACKAGES]}async transform(e,t){const s=e.get(T.PACKAGES);if(!s)throw new Error("Data from dataset alias 'PACKAGES' was undefined.");return[...s.values()]}}class qt extends R{extract(e){return[T.PERMISSIONSETS,T.PROFILES]}async transform(e,t,s){const a=e.get(T.PERMISSIONSETS),r=e.get(T.PROFILES);if(!a)throw new Error("Data from dataset alias 'PERMISSIONSETS' was undefined.");if(!r)throw new Error("Data from dataset alias 'PROFILES' was undefined.");const i=[];return await y.forEach(a,(async e=>{e.assigneeProfileRefs=await y.map(e.assigneeProfileIds,(e=>r.get(e)),(e=>r.has(e))),"*"!==s&&e.package!==s||i.push(e)})),i}}class Ht extends R{extract(e){return[T.FLOWS]}async transform(e,t){const s=e.get(T.FLOWS);if(!s)throw new Error("Data from dataset alias 'FLOWS' was undefined.");const a=[];return await y.forEach(s,(e=>{"Workflow"===e.type&&a.push(e)})),a}}class Jt extends R{extract(e){return[T.PROFILEPWDPOLICIES]}async transform(e,t){const s=e.get(T.PROFILEPWDPOLICIES);if(!s)throw new Error("Data from dataset alias 'PROFILEPWDPOLICIES' was undefined.");return[...s.values()]}}class Yt extends R{extract(e){return[T.PROFILES,T.PROFILERESTRICTIONS]}async transform(e,t,s){const a=e.get(T.PROFILES),r=e.get(T.PROFILERESTRICTIONS);if(!a)throw new Error("Data from dataset alias 'PROFILES' was undefined.");if(!r)throw new Error("Data from dataset alias 'PROFILERESTRICTIONS' was undefined.");const i=[];return await y.forEach(r,(e=>{e.profileRef=a.get(e.profileId),"*"!==s&&e.profileRef?.package!==s||i.push(e)})),i}}class Xt extends R{extract(e){return[T.PROFILES]}async transform(e,t,s){const a=e.get(T.PROFILES);if(!a)throw new Error("Data from dataset alias 'PROFILES' was undefined.");const r=[];return await y.forEach(a,(e=>{"*"!==s&&e.package!==s||r.push(e)})),r}}class Kt extends R{extract(e){return[T.USERS,T.GROUPS]}async transform(e,t){const s=e.get(T.GROUPS),a=e.get(T.USERS);if(!s)throw new Error("Data from dataset alias 'GROUPS' was undefined.");if(!a)throw new Error("Data from dataset alias 'USERS' was undefined.");const r=[];return await y.forEach(s,(async e=>{e.directUserRefs=await y.map(e.directUserIds,(e=>a.get(e)),(e=>a.has(e))),e.directGroupRefs=await y.map(e.directGroupIds,(e=>s.get(e)),(e=>s.has(e))),!0===e.isPublicGroup&&r.push(e)})),r}}class zt extends R{extract(e){return[T.USERS,T.GROUPS]}async transform(e,t){const s=e.get(T.GROUPS),a=e.get(T.USERS);if(!s)throw new Error("Data from dataset alias 'GROUPS' was undefined.");if(!a)throw new Error("Data from dataset alias 'USERS' was undefined.");const r=[];return await y.forEach(s,(async e=>{e.directUserRefs=await y.map(e.directUserIds,(e=>a.get(e)),(e=>a.has(e))),e.directGroupRefs=await y.map(e.directGroupIds,(e=>s.get(e)),(e=>s.has(e))),!0===e.isQueue&&r.push(e)})),r}}class Zt extends R{extract(e){return[T.USERROLES,T.USERS]}async transform(e,t,s=!1){const a=e.get(T.USERROLES),r=e.get(T.USERS);if(!a)throw new Error("Data from dataset alias 'USERROLES' was undefined.");if(!r)throw new Error("Data from dataset alias 'USERS' was undefined.");const i=[];return await y.forEach(a,(async e=>{!0===e.hasActiveMembers&&(e.activeMemberRefs=await y.map(e.activeMemberIds,(e=>r.get(e)))),!0===e.hasParent&&(e.parentRef=a.get(e.parentId)),!0!==s&&!1!==e.isExternal||i.push(e)})),i}}class es extends R{extract(e){return[T.VISUALFORCECOMPONENTS]}async transform(e,t,s){const a=e.get(T.VISUALFORCECOMPONENTS);if(!a)throw new Error("Data from dataset alias 'VISUALFORCECOMPONENTS' was undefined.");const r=[];return await y.forEach(a,(e=>{"*"!==s&&e.package!==s||r.push(e)})),r}}class ts extends R{extract(e){return[T.VISUALFORCEPAGES]}async transform(e,t,s){const a=e.get(T.VISUALFORCEPAGES);if(!a)throw new Error("Data from dataset alias 'VISUALFORCEPAGES' was undefined.");const r=[];return await y.forEach(a,(e=>{"*"!==s&&e.package!==s||r.push(e)})),r}}class ss extends R{extract(e){return[T.WORKFLOWS]}async transform(e,t){const s=e.get(T.WORKFLOWS);if(!s)throw new Error("Data from dataset alias 'WORKFLOWS' was undefined.");return[...s.values()]}}class as extends R{extract(e){return[T.APEXCLASSES]}async transform(e,t,s){const a=e.get(T.APEXCLASSES);if(!a)throw new Error("Data from dataset alias 'APEXCLASSES' was undefined.");const r=[];return await y.forEach(a,(async e=>{const t=await Promise.all([y.map(e.relatedTestClassIds,(e=>a.get(e))),y.map(e.relatedClassIds,(e=>a.get(e)))]);e.relatedTestClassRefs=t[0],e.relatedClassRefs=t[1],"*"!==s&&e.package!==s||!0!==e.isTest||!1!==e.needsRecompilation||r.push(e)})),r}}class rs extends R{extract(e){return[T.APEXCLASSES]}async transform(e,t,s){const a=e.get(T.APEXCLASSES);if(!a)throw new Error("Data from dataset alias 'APEXCLASSES' was undefined.");const r=[];return await y.forEach(a,(async e=>{const t=await Promise.all([y.map(e.relatedTestClassIds,(e=>a.get(e))),y.map(e.relatedClassIds,(e=>a.get(e)))]);e.relatedTestClassRefs=t[0],e.relatedClassRefs=t[1],"*"!==s&&e.package!==s||!0!==e.needsRecompilation||r.push(e)})),r}}class is extends R{extract(e,t){const s=new p(T.FIELDPERMISSIONS,`${T.FIELDPERMISSIONS}_${t}`);return s.parameters.set("object",t),[s,T.PROFILES,T.PERMISSIONSETS]}async transform(e,t,s,a){const i=e.get(T.FIELDPERMISSIONS),n=e.get(T.PROFILES),o=e.get(T.PERMISSIONSETS);if(!i)throw new Error("Data from dataset alias 'FIELDPERMISSIONS' was undefined.");if(!n)throw new Error("Data from dataset alias 'PROFILES' was undefined.");if(!o)throw new Error("Data from dataset alias 'PERMISSIONSETS' was undefined.");const l=r.create();return await y.forEach(i,(e=>{!0===e.parentId.startsWith("0PS")?e.parentRef=o.get(e.parentId):e.parentRef=n.get(e.parentId),"*"!==a&&e.parentRef.package!==a||(!1===l.hasRowHeader(e.parentId)&&l.setRowHeader(e.parentId,e.parentRef),l.addValueToProperty(e.parentId,e.fieldApiName,(e.isRead?"R":"")+(e.isEdit?"U":"")))})),l.toDataMatrix()}}class ns extends R{extract(e){return[T.VALIDATIONRULES,T.OBJECTTYPES,T.OBJECTS]}async transform(e,t){const s=e.get(T.OBJECTTYPES),a=e.get(T.OBJECTS),r=e.get(T.VALIDATIONRULES);if(!s)throw new Error("Data from dataset alias 'OBJECTTYPES' was undefined.");if(!a)throw new Error("Data from dataset alias 'OBJECTS' was undefined.");if(!r)throw new Error("Data from dataset alias 'VALIDATIONRULES' was undefined.");return await y.forEach(r,(e=>{const t=a.get(e.objectId);t&&!t.typeRef&&(t.typeRef=s.get(t.typeId)),e.objectRef=t})),[...r.values()]}}class os extends R{extract(e){return[T.PERMISSIONSETLICENSES,T.PERMISSIONSETS]}async transform(e,t){const s=e.get(T.PERMISSIONSETLICENSES),a=e.get(T.PERMISSIONSETS);if(!s)throw new Error("Data from dataset alias 'PERMISSIONSETLICENSES' was undefined.");if(!a)throw new Error("Data from dataset alias 'PERMISSIONSETS' was undefined.");return await y.forEach(s,(async e=>{e.permissionSetRefs=await y.map(e.permissionSetIds,(e=>a.get(e)),(e=>a.has(e)))})),[...s.values()]}}class ls extends C{_logger;_recipes;_datasetManager;constructor(e,t){if(super(),e instanceof P==!1)throw new TypeError("The given datasetManager is not an instance of DatasetManagerIntf.");if(t instanceof u==!1)throw new TypeError("The given logger is not an instance of LoggerIntf.");this._datasetManager=e,this._logger=t,this._recipes=new Map,this._recipes.set(A.ACTIVE_USERS,new Mt),this._recipes.set(A.APEX_CLASSES,new _t),this._recipes.set(A.APEX_TESTS,new as),this._recipes.set(A.APEX_TRIGGERS,new Dt),this._recipes.set(A.APEX_UNCOMPILED,new rs),this._recipes.set(A.APP_PERMISSIONS,new Lt),this._recipes.set(A.CURRENT_USER_PERMISSIONS,new Nt),this._recipes.set(A.CUSTOM_FIELDS,new Ft),this._recipes.set(A.CUSTOM_LABELS,new xt),this._recipes.set(A.FIELD_PERMISSIONS,new is),this._recipes.set(A.FLOWS,new vt),this._recipes.set(A.LIGHTNING_AURA_COMPONENTS,new Ut),this._recipes.set(A.LIGHTNING_PAGES,new Gt),this._recipes.set(A.LIGHTNING_WEB_COMPONENTS,new $t),this._recipes.set(A.OBJECT,new Bt),this._recipes.set(A.OBJECT_PERMISSIONS,new Wt),this._recipes.set(A.OBJECTS,new Vt),this._recipes.set(A.OBJECT_TYPES,new kt),this._recipes.set(A.ORGANIZATION,new jt),this._recipes.set(A.PACKAGES,new Qt),this._recipes.set(A.PERMISSION_SETS,new qt),this._recipes.set(A.PERMISSION_SET_LICENSES,new os),this._recipes.set(A.PROCESS_BUILDERS,new Ht),this._recipes.set(A.PROFILE_PWD_POLICIES,new Jt),this._recipes.set(A.PROFILE_RESTRICTIONS,new Yt),this._recipes.set(A.PROFILES,new Xt),this._recipes.set(A.PUBLIC_GROUPS,new Kt),this._recipes.set(A.QUEUES,new zt),this._recipes.set(A.USER_ROLES,new Zt),this._recipes.set(A.VALIDATION_RULES,new ns),this._recipes.set(A.VISUALFORCE_COMPONENTS,new es),this._recipes.set(A.VISUALFORCE_PAGES,new ts),this._recipes.set(A.WORKFLOWS,new ss)}async run(e,...t){if(!1===this._recipes.has(e))throw new TypeError(`The given alias (${e}) does not correspond to a registered recipe.`);const s=`RECIPE ${e}`,a=this._recipes.get(e);let r,i,n;this._logger.log(s,"How many datasets this recipe has?");try{r=a.extract(this._logger.toSimpleLogger(s),...t)}catch(e){throw this._logger.failed(s,e),e}this._logger.log(s,`This recipe has ${r?.length} ${r?.length>1?"datasets":"dataset"}: ${r.map((e=>e instanceof p?e.alias:e)).join(", ")}...`);try{i=await this._datasetManager.run(r)}catch(e){throw this._logger.failed(s,e),e}this._logger.log(s,"Datasets information successfuly retrieved!"),this._logger.log(s,"This recipe will now transform all this information...");try{n=await a.transform(i,this._logger.toSimpleLogger(s),...t)}catch(e){throw this._logger.failed(s,e),e}return this._logger.ended(s,"Transformation successfuly done!"),n}clean(e,...t){if(!1===this._recipes.has(e))throw new TypeError(`The given alias (${e}) does not correspond to a registered recipe.`);const s=`RECIPE ${e}`,a=this._recipes.get(e);let r;this._logger.log(s,"How many datasets this recipe has?");try{r=a.extract(this._logger.toSimpleLogger(s),...t)}catch(e){throw this._logger.failed(s,e),e}this._logger.log(s,`This recipe has ${r?.length} ${r?.length>1?"datasets":"dataset"}: ${r.map((e=>e instanceof p?e.alias:e)).join(", ")}...`),this._logger.log(s,"Clean all datasets...");try{this._datasetManager.clean(r)}catch(e){throw this._logger.failed(s,e),e}this._logger.ended(s,"Datasets succesfully cleaned!")}}const cs=2e3;class ds extends I{_apiVersion;_watchDog;_connection;constructor(e,t){super();const s=(new Date).getFullYear(),a=(new Date).getMonth()+1,r=3*(s-2022)+53+(a<=2?0:a<=6?1:a<=10?2:3);this._apiVersion=r;const i=new e.Connection({accessToken:t,version:r+".0",maxRequest:15});this._watchDog=new m((()=>({used:i.limitInfo?.apiUsage?.used,max:i.limitInfo?.apiUsage?.limit}))),this._connection=i}get apiVersion(){return this._apiVersion}caseSafeId(e){return e&&18===e.length?e.substr(0,15):e}setupUrl(e,t,s,a){if(!e)return"";switch(t){case b.STANDARD_FIELD:case b.CUSTOM_FIELD:case b.ANY_FIELD:switch(a){case b.STANDARD_OBJECT:case b.CUSTOM_OBJECT:case b.KNOWLEDGE_ARTICLE:return"/lightning/setup/ObjectManager/"+(s?`${s}/FieldsAndRelationships/${e}/view`:`page?address=%2F${e}`);case b.CUSTOM_BIG_OBJECT:return`/lightning/setup/BigObjects/page?address=%2F${e}%3Fsetupid%3DBigObjects`;case b.CUSTOM_EVENT:return`/lightning/setup/EventObjects/page?address=%2F${e}%3Fsetupid%3DEventObjects`;case b.CUSTOM_SETTING:return`/lightning/setup/CustomSettings/page?address=%2F${e}%3Fsetupid%3DCustomSettings`;case b.CUSTOM_METADATA_TYPE:return`/lightning/setup/CustomMetadata/page?address=%2F${e}%3Fsetupid%3DCustomMetadata`;case b.EXTERNAL_OBJECT:return`/lightning/setup/ExternalObjects/page?address=%2F${e}%3Fsetupid%3DExternalObjects`;default:return`/lightning/setup/ObjectManager/page?address=%2F${e}`}case b.STANDARD_OBJECT:case b.CUSTOM_OBJECT:case b.KNOWLEDGE_ARTICLE:return`/lightning/setup/ObjectManager/${e}/Details/view`;case b.CUSTOM_BIG_OBJECT:return`/lightning/setup/BigObjects/page?address=%2F${e}%3Fsetupid%3DBigObjects`;case b.CUSTOM_EVENT:return`/lightning/setup/EventObjects/page?address=%2F${e}%3Fsetupid%3DEventObjects`;case b.CUSTOM_SETTING:return`/lightning/setup/CustomSettings/page?address=%2F${e}%3Fsetupid%3DCustomSettings`;case b.CUSTOM_METADATA_TYPE:return`/lightning/setup/CustomMetadata/page?address=%2F${e}%3Fsetupid%3DCustomMetadata`;case b.EXTERNAL_OBJECT:return`/lightning/setup/ExternalObjects/page?address=%2F${e}%3Fsetupid%3DExternalObjects`;case b.PAGE_LAYOUT:return"/lightning/setup/ObjectManager/"+(s?`${s}/PageLayouts/${e}/view`:`page?address=%2F${e}`);case b.VALIDATION_RULE:return`/lightning/setup/ObjectManager/page?address=%2F${e}`;case b.WEB_LINK:return"/lightning/setup/ObjectManager/"+(s?`${s}/ButtonsLinksActions/${e}/view`:`page?address=%2F${e}`);case b.RECORD_TYPE:return"/lightning/setup/ObjectManager/"+(s?`${s}/RecordTypes/${e}/view`:`page?address=%2F${e}`);case b.APEX_TRIGGER:return"/lightning/setup/ObjectManager/"+(s?`${s}/ApexTriggers/${e}/view`:`page?address=%2F${e}`);case b.FIELD_SET:return"/lightning/setup/ObjectManager/"+(s?`${s}/FieldSets/${e}/view`:`page?address=%2F${e}`);case b.USER:return`/lightning/setup/ManageUsers/page?address=%2F${e}%3Fnoredirect%3D1%26isUserEntityOverride%3D1`;case b.PROFILE:return`/lightning/setup/EnhancedProfiles/page?address=%2F${e}`;case b.PERMISSION_SET:return`/lightning/setup/PermSets/page?address=%2F${e}`;case b.PERMISSION_SET_LICENSE:return`/lightning/setup/PermissionSetLicense/page?address=%2F${e}`;case b.PERMISSION_SET_GROUP:return`/lightning/setup/PermSetGroups/page?address=%2F${e}`;case b.ROLE:return`/lightning/setup/Roles/page?address=%2F${e}`;case b.PUBLIC_GROUP:return`/lightning/setup/PublicGroups/page?address=%2Fsetup%2Fown%2Fgroupdetail.jsp%3Fid%3D${e}`;case b.QUEUE:return`/lightning/setup/Queues/page?address=%2Fp%2Fown%2FQueue%2Fd%3Fid%3D${e}`;case b.TECHNICAL_GROUP:return"";case b.CUSTOM_LABEL:return`/lightning/setup/ExternalStrings/page?address=%2F${e}`;case b.STATIC_RESOURCE:return`/lightning/setup/StaticResources/page?address=%2F${e}`;case b.CUSTOM_SITE:return`/servlet/networks/switch?networkId=${e}&startURL=%2FcommunitySetup%2FcwApp.app%23%2Fc%2Fhome&`;case b.CUSTOM_TAB:return`/lightning/setup/CustomTabs/page?address=%2F${e}`;case b.FLOW_VERSION:return`/builder_platform_interaction/flowBuilder.app?flowId=${e}`;case b.FLOW_DEFINITION:return`/${e}`;case b.WORKFLOW_RULE:return`/lightning/setup/WorkflowRules/page?address=%2F${e}&nodeId=WorkflowRules`;case b.VISUAL_FORCE_PAGE:return`/lightning/setup/ApexPages/page?address=%2F${e}`;case b.VISUAL_FORCE_COMPONENT:return`/lightning/setup/ApexComponent/page?address=%2F${e}`;case b.AURA_WEB_COMPONENT:case b.LIGHTNING_WEB_COMPONENT:return`/lightning/setup/LightningComponentBundles/page?address=%2F${e}`;case b.LIGHTNING_PAGE:return"/lightning/setup/ObjectManager/"+(s?`${s}/LightningPages/${e}/view`:`page?address=%2F${e}`);case b.APEX_CLASS:return`/lightning/setup/ApexClasses/page?address=%2F${e}`;default:return console.error(`Type <${t}> not supported yet. Returning "/id" as url. FYI, id was <${e}>, parentId was <${s}> and parentType was <${a}>`),`/${e}`}}getObjectType(e,t){return!0===t?L:e.endsWith("__c")?_:e.endsWith("__x")?D:e.endsWith("__mdt")?N:e.endsWith("__e")?F:e.endsWith("__ka")?x:e.endsWith("__b")?v:M}get dailyApiRequestLimitInformation(){return this._watchDog.dailyApiRequestLimitInformation}async _standardSOQLQuery(e,t,s){const a=!0===e?this._connection.tooling:this._connection;try{this._watchDog?.beforeRequest();const e=await a.query(t,{autoFetch:!0,maxFetch:1e12,headers:{"Sforce-Query-Options":"batchSize=2000"}});return this._watchDog?.afterRequest(),e.records}catch(e){if(s&&s.includes&&s.includes(e.errorCode))return[];throw Object.assign(e,{context:{when:"While running a SOQL query with the standard queryMore",what:t}})}}async _customSOQLQuery(e,t,s){const a=!0===e?this._connection.tooling:this._connection,r=[],i=async e=>{const n=`${t} AND ${s}>'${e}' ORDER BY ${s} LIMIT 2000`;this._watchDog?.beforeRequest();const o=await a.query(n,{autoFetch:!1,headers:{"Sforce-Query-Options":"batchSize=2000"}});if(this._watchDog?.afterRequest(),r.push(...o.records),o.records.length>=cs){const e=r[r.length-1][s];await i(e)}};try{return await i("000000000000000000"),r}catch(e){throw Object.assign(e,{context:{when:"While running a SOQL query with the custom queryMore",what:t}})}}async soqlQuery(e,t){t?.log(`Preparing ${e.length} SOQL ${e.length>1?"queries":"query"}...`);let s=0;const a=[],r=[],i=[],n=await Promise.all(e.map((async n=>{const o=n.string.lastIndexOf("FROM ")+5,l=n.string.indexOf(" ",o),c=n.string.substring(o,-1===l?n.string.length:l);let d;a.push(c);try{d=n.queryMoreField?await this._customSOQLQuery(n.tooling,n.string,n.queryMoreField):await this._standardSOQLQuery(n.tooling,n.string,n.byPasses),r.push(c),s+=d.length}catch(e){throw i.push(c),e}finally{const e=a.indexOf(c);e>-1&&a.splice(e,1)}return t?.log(`Processing ${e.length} SOQL ${e.length>1?"queries":"query"}... Records retrieved: ${s}, Pending: (${a.length}) on [${a.join(", ")}], Done: (${r.length}) on [${r.join(", ")}], Error: (${i.length}) on [${i.join(", ")}]`),d})));return t?.log(`Done running ${e.length} SOQL ${e.length>1?"queries":"query"}.`),n}async dependenciesQuery(e,t){this._watchDog?.beforeRequest(),t?.log(`Starting to call Tooling API for dependency API call of ${e.length} item(s)...`);const s=[];let a;for(let t=0;t<e.length;t+=100){a&&5!==a.compositeRequest.length||(a={allOrNone:!1,compositeRequest:[]},s.push(a));const r=`'${e.slice(t,t+100).join("','")}'`;a.compositeRequest.push({method:"GET",url:`/services/data/v${this._apiVersion}.0/tooling/query?q=SELECT MetadataComponentId, MetadataComponentName, MetadataComponentType, RefMetadataComponentId, RefMetadataComponentName, RefMetadataComponentType FROM MetadataComponentDependency WHERE RefMetadataComponentId IN (${r}) OR MetadataComponentId IN (${r}) `,referenceId:`chunk${t}`})}let r=s.length,i=0,n=0;const o=await Promise.all(s.map((async e=>{try{const t=await this._connection.tooling.request({url:"/tooling/composite",method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});return this._watchDog?.afterRequest(),i++,t}catch(e){n++}finally{r--,t?.log(`Processing ${s.length} Tooling composite queries... Pending: ${r}, Done: ${i}, Error: ${n}`)}})));t?.log("Got all the results");const l=[],c=[],d=new Set;return o.forEach((s=>{s.compositeResponse.forEach((s=>{if(200===s.httpStatusCode)t?.log(`This response had a code: 200 so we add the ${s?.body?.records?.length} records`),l.push(...s.body.records.map((e=>{const t=this.caseSafeId(e.MetadataComponentId),s=this.caseSafeId(e.RefMetadataComponentId),a=`${t}-${s}`;return d.has(a)?null:(d.add(a),{id:t,name:e.MetadataComponentName,type:e.MetadataComponentType,url:this.setupUrl(t,e.MetadataComponentType),refId:s,refName:e.RefMetadataComponentName,refType:e.RefMetadataComponentType,refUrl:this.setupUrl(s,e.RefMetadataComponentType)})})).filter((e=>null!==e)));else{const a=s.body[0].errorCode;if("UNKNOWN_EXCEPTION"!==a){t?.log(`This response had a code: ${a}`);const r=new TypeError(`One of the request had an issue with HTTP errorCode=${a}`);throw Object.assign(r,{context:{when:"Calling Composite Tooling API to get dependencies.",what:{ids:e,body:s.body}}})}t?.log(`This response had a code: ${a}`),c.push(...e)}}))})),{records:l,errors:c}}async readMetadata(e,t){this._watchDog?.beforeRequest(),t?.log(`Starting to call Metadata API for ${e.length} types...`),await Promise.all(e.filter((e=>e.members?.includes("*"))).map((async e=>{try{const t=await this._connection.metadata.list([{type:e.type}],this._apiVersion);this._watchDog?.afterRequest(),e.members=e.members.filter((e=>"*"!==e)),ps(t).forEach((t=>{e.members.push(t.fullName)}))}catch(s){throw t?.log(`The method metadata.list returned an error: ${JSON.stringify(s)}`),Object.assign(s,{context:{when:"Calling Metadata API to get a list of metadata.",what:{type:e.type,apiVersion:this._apiVersion}}})}})));const s=[],a=new Map;return e.forEach((e=>{for(t?.log(`Init the response array for this type: ${e.type}`),a.set(e.type,[]),t?.log(`Starting looping for type ${e.type} and metadata.members.length=${e.members.length}`);e.members.length>0;){const r=e.members.splice(0,10);s.push(new Promise((async(s,i)=>{t?.log(`Try to call metadata read for type ${e.type} and currentMembers=${r}`);try{const t=await this._connection.metadata.read(e.type,r);this._watchDog?.afterRequest(),a.get(e.type).push(...ps(t)),s()}catch(s){t?.log(`The method metadata.read returned an error: ${JSON.stringify(s)}`),i(Object.assign(s,{context:{when:"Calling Metadata API to read a list of metadata.",what:{type:e.type,pendingMembers:e.members,membersInProcess:r}}}))}})))}})),t?.log(`Calling all promises: ${s.length}`),await Promise.all(s),t?.log(`All promises ended and response is like: ${JSON.stringify(Array.from(a.entries()))}`),a}async readMetadataAtScale(e,t,s,a){this._watchDog?.beforeRequest();const r=[];let i;t.forEach(((t,s)=>{i&&5!==i.compositeRequest.length||(i={allOrNone:!1,compositeRequest:[]},r.push(i)),i.compositeRequest.push({method:"GET",url:`/services/data/v${this._apiVersion}.0/tooling/sobjects/${e}/${t}`,referenceId:`chunk${s}`})}));const n=await Promise.all(r.map((e=>(this._watchDog?.afterRequest(),this._connection.tooling.request({url:"/tooling/composite",method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}))))),o=[];return n.forEach((a=>{a.compositeResponse.forEach((a=>{if(200===a.httpStatusCode)o.push(a.body);else{const r=a.body[0].errorCode;if(s&&s.includes&&!1===s.includes(r)){const s=new TypeError(`One of the request for type=${e} had an issue with HTTP errorCode=${r}`);throw Object.assign(s,{context:{when:"Calling Composite Tooling API to get metadata at scale.",what:{type:e,ids:t,body:a.body}}})}}}))})),o}async describeGlobal(e){this._watchDog?.beforeRequest();const t=await this._connection.describeGlobal();return t.sobjects.push(gs),this._watchDog?.afterRequest(),t.sobjects}async describe(e,t){if("Activity"===e)return gs;this._watchDog?.beforeRequest();const s=await this._connection.describe(e);return this._watchDog?.afterRequest(),s}async recordCount(e,t){this._watchDog?.beforeRequest();const s=await this._connection.request({url:`/limits/recordCount?sObjects=${e}`,method:"GET"});return this._watchDog?.afterRequest(),Array.isArray(s?.sObjects)&&1===s?.sObjects.length?s?.sObjects[0].count:0}async runAllTests(e){this._watchDog?.beforeRequest();const t=await this._connection.request({url:"/tooling/runTestsAsynchronous",method:"POST",body:'{ "testLevel": "RunLocalTests", "skipCodeCoverage": false }',headers:{"Content-Type":"application/json"}});return this._watchDog?.afterRequest(),t}async compileClasses(e,t){this._watchDog?.beforeRequest();const s=Date.now(),a=[];let r,i=0;e.forEach((e=>{r&&5!==r.compositeRequest.length||(i++,r={allOrNone:!1,compositeRequest:[{method:"POST",url:`/services/data/v${this._apiVersion}.0/tooling/sobjects/MetadataContainer`,referenceId:"container",body:{Name:`container-${s}-${i}`}},{method:"POST",url:`/services/data/v${this._apiVersion}.0/tooling/sobjects/ContainerAsyncRequest`,referenceId:"request",body:{MetadataContainerId:"@{container.id}",IsCheckOnly:!0}}]},a.push(r)),r.compositeRequest.push({method:"POST",url:`/services/data/v${this._apiVersion}.0/tooling/sobjects/ApexClassMember`,referenceId:e.id,body:{MetadataContainerId:"@{container.id}",ContentEntityId:e.id,Body:e.sourceCode}})}));const n=a.map((e=>(this._watchDog?.afterRequest(),this._connection.tooling.request({url:"/tooling/composite",method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})))),o=await Promise.all(n);return this._watchDog?.afterRequest(),o}}const ps=e=>e?Array.isArray(e)?e:[e]:[],gs={name:"Activity",label:"Activity",labelPlural:"Activities",customSetting:!1,custom:!1,keyPrefix:"00T"};return e.API=class{get version(){return"Boron [B,5]"}get salesforceApiVersion(){return this._sfdcManager.apiVersion}_recipeManager;_datasetManager;_sfdcManager;_cacheManager;_logger;_usageTermsAccepted;constructor(e,t,s,a,r,i){this._logger=new bt(i),this._sfdcManager=new ds(t,e),this._cacheManager=new Ee({compress:r.compress,decompress:r.decompress,encode:a.encode,decode:a.decode,storage:s}),this._datasetManager=new At(this._sfdcManager,this._cacheManager,this._logger),this._recipeManager=new ls(this._datasetManager,this._logger),this._usageTermsAccepted=!1}removeAllFromCache(){this._cacheManager.clear()}getCacheInformation(){return this._cacheManager.details()}getScoreRule(e){return this._datasetManager.getScoreRule(e)}getAllScoreRules(){return this._datasetManager.getAllScoreRules()}getAllScoreRulesAsDataMatrix(){const e=this._datasetManager.getAllScoreRules(),t=r.create();return e.forEach((e=>{t.setRowHeader(`${e.id}`,e),e.applicable.forEach((s=>{t.addValueToProperty(`${e.id}`,s.label,"true")}))})),t.toDataMatrix()}get dailyApiRequestLimitInformation(){return this._sfdcManager.dailyApiRequestLimitInformation}async runAllTestsAsync(){return this._sfdcManager.runAllTests(this._logger.toSimpleLogger("Run All Tests"))}async compileClasses(e){return this._sfdcManager.compileClasses(e,this._logger.toSimpleLogger(`Compile ${e.length} classe(s)`))}async getOrganizationInformation(){return await this._recipeManager.run(A.ORGANIZATION)}async checkUsageTerms(){return!0!==(await this.getOrganizationInformation()).isProduction||!1!==this._usageTermsAccepted}acceptUsageTerms(){this._usageTermsAccepted=!0}async checkCurrentUserPermissions(){const e=await this._recipeManager.run(A.CURRENT_USER_PERMISSIONS,["ModifyAllData","AuthorApex","ApiEnabled","InstallPackaging"]);if(!1===e.get("ModifyAllData")||!1===e.get("AuthorApex")||!1===e.get("ApiEnabled")||!1===e.get("InstallPackaging"))throw new TypeError(`Current User Permission Access is not enough to run the application <br /><br />- <b>Modify All Data</b> (Create, edit, and delete all organization data, regardless of sharing settings) [PermissionsModifyAllData] is set to ${e.get("PermissionsModifyAllData")} <br />- <b>Author Apex</b> (Create Apex classes and triggers) [PermissionsAuthorApex] is set to ${e.get("PermissionsAuthorApex")} <br />- <b>API Enabled</b> (Access any Salesforce.com API) [PermissionsApiEnabled] is set to ${e.get("PermissionsApiEnabled")} <br />- <b>Download AppExchange Packages</b> (Install or uninstall AppExchange packages as system administrators) [PermissionsInstallPackaging] is set to ${e.get("PermissionsInstallPackaging")} <br />`);return!0}async getPackages(){return await this._recipeManager.run(A.PACKAGES)}removeAllPackagesFromCache(){this._recipeManager.clean(A.PACKAGES)}async getObjectTypes(){return await this._recipeManager.run(A.OBJECT_TYPES)}async getObjects(e,t){return await this._recipeManager.run(A.OBJECTS,e,t)}removeAllObjectsFromCache(){this._recipeManager.clean(A.OBJECTS)}async getObject(e){return await this._recipeManager.run(A.OBJECT,e)}removeObjectFromCache(e){this._recipeManager.clean(A.OBJECT,e)}async getObjectPermissionsPerParent(e){return await this._recipeManager.run(A.OBJECT_PERMISSIONS,e)}removeAllObjectPermissionsFromCache(){this._recipeManager.clean(A.OBJECT_PERMISSIONS)}async getApplicationPermissionsPerParent(e){return await this._recipeManager.run(A.APP_PERMISSIONS,e)}removeAllAppPermissionsFromCache(){this._recipeManager.clean(A.APP_PERMISSIONS)}async getCustomFields(e,t,s){return await this._recipeManager.run(A.CUSTOM_FIELDS,e,t,s)}removeAllCustomFieldsFromCache(){this._recipeManager.clean(A.CUSTOM_FIELDS)}async getPermissionSets(e){return await this._recipeManager.run(A.PERMISSION_SETS,e)}removeAllPermSetsFromCache(){this._recipeManager.clean(A.PERMISSION_SETS)}async getPermissionSetLicenses(){return await this._recipeManager.run(A.PERMISSION_SET_LICENSES)}removeAllPermSetLicensesFromCache(){this._recipeManager.clean(A.PERMISSION_SET_LICENSES)}async getProfiles(e){return await this._recipeManager.run(A.PROFILES,e)}removeAllProfilesFromCache(){this._recipeManager.clean(A.PROFILES)}async getProfileRestrictions(e){return await this._recipeManager.run(A.PROFILE_RESTRICTIONS,e)}removeAllProfileRestrictionsFromCache(){this._recipeManager.clean(A.PROFILE_RESTRICTIONS)}async getProfilePasswordPolicies(){return await this._recipeManager.run(A.PROFILE_PWD_POLICIES)}removeAllProfilePasswordPoliciesFromCache(){this._recipeManager.clean(A.PROFILE_PWD_POLICIES)}async getActiveUsers(){return await this._recipeManager.run(A.ACTIVE_USERS)}removeAllActiveUsersFromCache(){this._recipeManager.clean(A.ACTIVE_USERS)}async getCustomLabels(e){return await this._recipeManager.run(A.CUSTOM_LABELS,e)}removeAllCustomLabelsFromCache(){this._recipeManager.clean(A.CUSTOM_LABELS)}async getLightningWebComponents(e){return await this._recipeManager.run(A.LIGHTNING_WEB_COMPONENTS,e)}removeAllLightningWebComponentsFromCache(){this._recipeManager.clean(A.LIGHTNING_WEB_COMPONENTS)}async getLightningAuraComponents(e){return await this._recipeManager.run(A.LIGHTNING_AURA_COMPONENTS,e)}removeAllLightningAuraComponentsFromCache(){this._recipeManager.clean(A.LIGHTNING_AURA_COMPONENTS)}async getLightningPages(e){return await this._recipeManager.run(A.LIGHTNING_PAGES,e)}removeAllLightningPagesFromCache(){this._recipeManager.clean(A.LIGHTNING_PAGES)}async getVisualForceComponents(e){return await this._recipeManager.run(A.VISUALFORCE_COMPONENTS,e)}removeAllVisualForceComponentsFromCache(){this._recipeManager.clean(A.VISUALFORCE_COMPONENTS)}async getVisualForcePages(e){return await this._recipeManager.run(A.VISUALFORCE_PAGES,e)}removeAllVisualForcePagesFromCache(){this._recipeManager.clean(A.VISUALFORCE_PAGES)}async getPublicGroups(){return await this._recipeManager.run(A.PUBLIC_GROUPS)}removeAllPublicGroupsFromCache(){this._recipeManager.clean(A.PUBLIC_GROUPS)}async getQueues(){return await this._recipeManager.run(A.QUEUES)}removeAllQueuesFromCache(){this._recipeManager.clean(A.QUEUES)}async getApexClasses(e){return await this._recipeManager.run(A.APEX_CLASSES,e)}removeAllApexClassesFromCache(){this._recipeManager.clean(A.APEX_CLASSES)}async getApexTests(e){return await this._recipeManager.run(A.APEX_TESTS,e)}removeAllApexTestsFromCache(){this._recipeManager.clean(A.APEX_TESTS)}async getApexTriggers(e){return await this._recipeManager.run(A.APEX_TRIGGERS,e)}removeAllApexTriggersFromCache(){this._recipeManager.clean(A.APEX_TRIGGERS)}async getApexUncompiled(e){return await this._recipeManager.run(A.APEX_UNCOMPILED,e)}removeAllApexUncompiledFromCache(){this._recipeManager.clean(A.APEX_UNCOMPILED)}async getRoles(){return await this._recipeManager.run(A.USER_ROLES)}removeAllRolesFromCache(){this._recipeManager.clean(A.USER_ROLES)}async getRolesTree(){const e=await this.getRoles(),t=new Map,s="__i am root__";return e.forEach((e=>{!1===t.has(e.id)&&t.set(e.id,{id:e.id});const a=t.get(e.id);a.record||(a.record=e);const r=!0===e.hasParent?e.parentId:s;!1===t.has(r)&&t.set(r,{id:r});const i=t.get(r);i.children||(i.children=[]),i.children.push(a)})),t.get(s)}async getWorkflows(){return await this._recipeManager.run(A.WORKFLOWS)}removeAllWorkflowsFromCache(){this._recipeManager.clean(A.WORKFLOWS)}async getFieldPermissionsPerParent(e,t){return await this._recipeManager.run(A.FIELD_PERMISSIONS,e,t)}removeAllFieldPermissionsFromCache(){this._recipeManager.clean(A.FIELD_PERMISSIONS)}async getFlows(){return await this._recipeManager.run(A.FLOWS)}removeAllFlowsFromCache(){this._recipeManager.clean(A.FLOWS)}async getProcessBuilders(){return await this._recipeManager.run(A.PROCESS_BUILDERS)}removeAllProcessBuildersFromCache(){this._recipeManager.clean(A.PROCESS_BUILDERS)}async getValidationRules(){return await this._recipeManager.run(A.VALIDATION_RULES)}removeAllValidationRulesFromCache(){this._recipeManager.clean(A.VALIDATION_RULES)}},e.BasicLoggerIntf=g,e.Data=n,e.DataCacheItem=class{name;isEmpty;isMap;length;created},e.DataCacheManagerIntf=s,e.DataDependencies=class{hadError;using;referenced;referencedByTypes},e.DataDependenciesFactory=a,e.DataFactoryInstanceIntf=d,e.DataFactoryIntf=c,e.DataItemInCache=class extends t{content},e.DataMatrix=class{columnHeaders;rows},e.DataMatrixColumnHeader=class{id;ref},e.DataMatrixFactory=r,e.DataMatrixRow=class{header;data},e.DataMatrixWorking=i,e.DataWithDependencies=o,e.DataWithoutScoring=l,e.Dataset=w,e.DatasetAliases=T,e.DatasetManagerIntf=P,e.DatasetRunInformation=p,e.ItemInCache=t,e.LoggerIntf=u,e.MetadataItemInCache=class extends t{type;length},e.OBJECTTYPE_ID_CUSTOM_BIG_OBJECT=v,e.OBJECTTYPE_ID_CUSTOM_EVENT=F,e.OBJECTTYPE_ID_CUSTOM_EXTERNAL_SOBJECT=D,e.OBJECTTYPE_ID_CUSTOM_METADATA_TYPE=N,e.OBJECTTYPE_ID_CUSTOM_SETTING=L,e.OBJECTTYPE_ID_CUSTOM_SOBJECT=_,e.OBJECTTYPE_ID_KNOWLEDGE_ARTICLE=x,e.OBJECTTYPE_ID_STANDARD_SOBJECT=M,e.Processor=y,e.Recipe=R,e.RecipeAliases=A,e.RecipeManagerIntf=C,e.SFDC_ApexClass=E,e.SFDC_ApexTestMethodResult=S,e.SFDC_ApexTrigger=G,e.SFDC_AppPermission=V,e.SFDC_Application=$,e.SFDC_CustomLabel=k,e.SFDC_Field=j,e.SFDC_FieldPermission=Q,e.SFDC_FieldSet=q,e.SFDC_Flow=H,e.SFDC_FlowVersion=J,e.SFDC_Group=Y,e.SFDC_LightningAuraComponent=X,e.SFDC_LightningPage=K,e.SFDC_LightningWebComponent=z,e.SFDC_Limit=Z,e.SFDC_Object=U,e.SFDC_ObjectPermission=ee,e.SFDC_ObjectRelationShip=te,e.SFDC_ObjectType=O,e.SFDC_Organization=se,e.SFDC_Package=ae,e.SFDC_PageLayout=re,e.SFDC_PermissionSet=W,e.SFDC_PermissionSetLicense=ie,e.SFDC_Profile=B,e.SFDC_ProfileIpRangeRestriction=le,e.SFDC_ProfileLoginHourRestriction=ce,e.SFDC_ProfilePasswordPolicy=ne,e.SFDC_ProfileRestrictions=oe,e.SFDC_RecordType=de,e.SFDC_User=pe,e.SFDC_UserRole=ge,e.SFDC_ValidationRule=ue,e.SFDC_VisualForceComponent=he,e.SFDC_VisualForcePage=me,e.SFDC_WebLink=fe,e.SFDC_Workflow=Se,e.SalesforceManagerIntf=I,e.SalesforceMetadataRequest=class{type;members},e.SalesforceMetadataTypes=b,e.SalesforceQueryRequest=class{string;tooling;byPasses;queryMoreField},e.SalesforceUsageInformation=h,e.SalesforceWatchDog=m,e.ScoreRule=class{id;description;formula;errorMessage;badField;applicable},e.SimpleLoggerIntf=class{log(e){throw new TypeError('You need to implement the method "log()"')}debug(e){throw new TypeError('You need to implement the method "debug()"')}},e}({});
